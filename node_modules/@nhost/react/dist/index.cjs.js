"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("@nhost/nhost-js"),E=require("react"),t=require("@xstate/react"),C=require("jwt-decode"),y=p.NhostClient;class O extends y{constructor(e){super({...e,start:!1})}}const x=E.createContext({}),T=({nhost:s,initial:e,...n})=>{const u=t.useInterpret(s.auth.client.machine,{devTools:s.devTools});s.auth.client.start({interpreter:u,initialSession:e,devTools:s.devTools});const S=E.useRef(!0);return E.useEffect(()=>{S.current?S.current=!1:e&&u.send("SESSION_UPDATE",{data:{session:e}})},[e,u]),E.createElement(x.Provider,{value:s},n.children)},N=T,f=()=>{var n;const e=(n=E.useContext(x).auth)==null?void 0:n.client.interpreter;if(!e)throw Error("Could not find the Nhost auth client. Did you wrap your app in <NhostProvider />?");return e},I=()=>{const s=f();return t.useSelector(s,e=>({isAuthenticated:e.matches({authentication:"signedIn"}),isLoading:e.hasTag("loading"),error:e.context.errors.authentication||null,isError:e.matches({authentication:{signedOut:"failed"}}),connectionAttempts:e.context.importTokenAttempts}),(e,n)=>e.isAuthenticated===n.isAuthenticated&&e.isLoading===n.isLoading&&e.connectionAttempts===n.connectionAttempts)};function M({children:s}){const{isAuthenticated:e}=I();return e?E.createElement(E.Fragment,null,s):null}function R({children:s}){const{isAuthenticated:e}=I();return e?null:E.createElement(E.Fragment,null,s)}const A=()=>{const s=f();return t.useSelector(s,e=>e.context.accessToken.value)},P=()=>E.useContext(x),L=()=>{const s=P(),[e,n]=E.useState(null),u=!e,S=!!e,[d,g]=E.useState(!1);return{add:async a=>{g(!0);const o=await p.addSecurityKeyPromise(s.auth.client,a),{error:c}=o;return c&&n(c),g(!1),o},isLoading:d,isSuccess:u,isError:S,error:e}},D=()=>{const s=f(),[e,n]=E.useState(!!s.status&&s.getSnapshot().matches({authentication:"signedIn"}));return E.useEffect(()=>s.subscribe(S=>{const d=S.matches({authentication:"signedIn"});n(d)}).unsubscribe,[s]),e};function K(s){const e=P(),n=E.useMemo(()=>p.createChangeEmailMachine(e.auth.client),[e]),u=t.useInterpret(n),S=t.useSelector(u,o=>o.matches("requesting")),d=t.useSelector(u,o=>o.context.error),g=t.useSelector(u,o=>o.matches("idle.error")),h=t.useSelector(u,o=>o.matches("idle.success"));return{changeEmail:E.useCallback(async(o,c=s)=>p.changeEmailPromise(u,o,c),[u,s]),isLoading:S,needsEmailVerification:h,isError:g,error:d}}const V=()=>{const s=P(),e=E.useMemo(()=>p.createChangePasswordMachine(s.auth.client),[s]),n=t.useInterpret(e),u=t.useSelector(n,a=>a.matches({idle:"error"})),S=t.useSelector(n,a=>a.matches({idle:"success"})),d=t.useSelector(n,a=>a.context.error),g=t.useSelector(n,a=>a.matches("requesting"));return{changePassword:a=>p.changePasswordPromise(n,a),isLoading:g,isSuccess:S,isError:u,error:d}},F=()=>{const s=P(),e=E.useMemo(()=>p.createEnableMfaMachine(s.auth.client),[s]),n=t.useInterpret(e),u=t.useSelector(n,l=>l.matches({idle:"error"})||l.matches({generated:{idle:"error"}})),S=t.useSelector(n,l=>l.matches("generating")),d=t.useSelector(n,l=>l.matches("generated")),g=t.useSelector(n,l=>l.matches({generated:"activating"})),h=t.useSelector(n,l=>l.matches({generated:"activated"})),a=t.useSelector(n,l=>l.context.error),o=t.useSelector(n,l=>l.context.imageUrl||"");return{generateQrCode:()=>p.generateQrCodePromise(n),isGenerating:S,qrCodeDataUrl:o,isGenerated:d,activateMfa:l=>p.activateMfaPromise(n,l),isActivating:g,isActivated:h,isError:u,error:a}},U=()=>{const s=A();return s?C(s):null},w=s=>{const e=P(),n=m=>{s.send({type:"ADD",file:m.file,bucketId:m.bucketId||l})},u=m=>p.uploadFilePromise({url:e.storage.url,accessToken:e.auth.getAccessToken(),adminSecret:e.adminSecret,...m},s),S=()=>{s.send("CANCEL")},d=()=>{s.send("DESTROY")},g=t.useSelector(s,m=>m.matches("uploading")),h=t.useSelector(s,m=>m.matches("uploaded")),a=t.useSelector(s,m=>m.matches("error")),o=t.useSelector(s,m=>m.context.error||null),c=t.useSelector(s,m=>m.context.progress),r=t.useSelector(s,m=>m.context.id),l=t.useSelector(s,m=>m.context.bucketId),i=t.useSelector(s,m=>{var v;return(v=m.context.file)==null?void 0:v.name});return{add:n,upload:u,cancel:S,destroy:d,isUploaded:h,isUploading:g,isError:a,error:o,progress:c,id:r,bucketId:l,name:i}},_=()=>{const s=t.useInterpret(p.createFileUploadMachine);return w(s)},k=()=>{const s=U();return(s==null?void 0:s["https://hasura.io/jwt/claims"])||null},q=s=>{const e=k();return(e==null?void 0:e[s.startsWith("x-hasura-")?s:`x-hasura-${s}`])||null},H=()=>{const s=P(),[e,n]=E.useState([]),u=t.useInterpret(p.createMultipleFilesUploadMachine,{},i=>{i.event.type==="UPLOAD_ERROR"?n(i.context.files.filter(m=>{var v;return(v=m.getSnapshot())==null?void 0:v.context.error})):(i.matches("uploaded")||i.event.type==="CLEAR")&&e.length>0&&n([])}),S=i=>{u.send({type:"ADD",...i})},d=i=>p.uploadMultipleFilesPromise({url:s.storage.url,accessToken:s.auth.getAccessToken(),adminSecret:s.adminSecret,...i},u),g=()=>{u.send("CANCEL")},h=()=>{u.send("CLEAR")},a=t.useSelector(u,i=>i.matches("uploading")),o=t.useSelector(u,i=>i.matches("uploaded")),c=t.useSelector(u,i=>i.matches("error")),r=t.useSelector(u,i=>i.context.progress),l=t.useSelector(u,i=>i.context.files);return{upload:d,add:S,clear:h,cancel:g,progress:r,isUploaded:o,isUploading:a,files:l,isError:c,errors:e}},j=s=>{const[e,n]=E.useState(!0);E.useEffect(()=>{n(!1)},[]);const u=E.useContext(x);return new Proxy({},{get(S,d){return p.encodeQueryParameters(`${u.auth.client.backendUrl}/signin/provider/${d}`,p.rewriteRedirectTo(e?void 0:u.auth.client.clientUrl,s))}})},Q=s=>{const e=P(),n=E.useMemo(()=>p.createResetPasswordMachine(e.auth.client),[e]),u=t.useInterpret(n),S=t.useSelector(u,o=>o.matches("requesting")),d=t.useSelector(u,o=>o.context.error),g=t.useSelector(u,o=>o.matches("idle.error")),h=t.useSelector(u,o=>o.matches("idle.success"));return{resetPassword:(o,c=s)=>p.resetPasswordPromise(u,o,c),isLoading:S,isSent:h,isError:g,error:d}},J=s=>{const e=P(),n=E.useMemo(()=>p.createSendVerificationEmailMachine(e.auth.client),[e]),u=t.useInterpret(n),S=t.useSelector(u,o=>o.matches({idle:"error"})),d=t.useSelector(u,o=>o.matches({idle:"success"})),g=t.useSelector(u,o=>o.context.error),h=t.useSelector(u,o=>o.matches("requesting"));return{sendEmail:(o,c=s)=>p.sendVerificationEmailPromise(u,o,c),isLoading:h,isSent:d,isError:S,error:g}},Y=()=>{const s=f(),e=()=>p.signInAnonymousPromise(s),n=t.useSelector(s,a=>a.context.errors.authentication||null,(a,o)=>(a==null?void 0:a.error)===(o==null?void 0:o.error)),u=t.useSelector(s,a=>a.matches({authentication:{authenticating:"anonymous"}})),S=t.useSelector(s,a=>a.matches({authentication:"signedIn"})),d=t.useSelector(s,a=>a.matches({authentication:{signedOut:"failed"}})),g=t.useSelector(s,a=>a.context.user,(a,o)=>(a==null?void 0:a.id)===(o==null?void 0:o.id));return{accessToken:t.useSelector(s,a=>a.context.accessToken.value),error:n,isError:d,isLoading:u,isSuccess:S,signInAnonymous:e,user:g}},$=()=>{const s=f(),e=(i,m)=>p.signInEmailPasswordPromise(s,i,m),n=i=>p.signInMfaTotpPromise(s,i),u=t.useSelector(s,i=>i.context.user,(i,m)=>(i==null?void 0:i.id)===(m==null?void 0:m.id)),S=t.useSelector(s,i=>i.context.accessToken.value),d=t.useSelector(s,i=>i.context.refreshToken.value),g=t.useSelector(s,i=>i.context.errors.authentication||null,(i,m)=>(i==null?void 0:i.error)===(m==null?void 0:m.error)),h=t.useSelector(s,i=>i.matches({authentication:"signedIn"})),a=t.useSelector(s,i=>i.matches({authentication:{authenticating:"password"}}),(i,m)=>i===m),o=t.useSelector(s,i=>i.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(i,m)=>i===m),c=t.useSelector(s,i=>i.matches({authentication:{signedOut:"needsMfa"}}),(i,m)=>i===m),r=t.useSelector(s,i=>i.matches({authentication:{signedOut:"failed"}}),(i,m)=>i===m),l=t.useSelector(s,i=>i.context.mfa);return{accessToken:S,refreshToken:d,error:g,isError:r,isLoading:a,isSuccess:h,needsEmailVerification:o,needsMfaOtp:c,mfa:l,sendMfaOtp:n,signInEmailPassword:e,user:u}};function G(s){const e=f(),n=(h,a=s)=>p.signInEmailPasswordlessPromise(e,h,a),u=t.useSelector(e,h=>h.context.errors.registration||null,(h,a)=>(h==null?void 0:h.error)===(a==null?void 0:a.error)),S=t.useSelector(e,h=>h.matches("registration.passwordlessEmail")),d=t.useSelector(e,h=>h.matches("registration.incomplete.needsEmailVerification")),g=t.useSelector(e,h=>h.matches("registration.incomplete.failed"));return{signInEmailPasswordless:n,isLoading:S,isSuccess:d,isError:g,error:u}}const W=()=>{const s=f(),e=c=>p.signInEmailSecurityKeyPromise(s,c),n=t.useSelector(s,c=>c.context.user,(c,r)=>(c==null?void 0:c.id)===(r==null?void 0:r.id)),u=t.useSelector(s,c=>c.context.accessToken.value),S=t.useSelector(s,c=>c.context.refreshToken.value),d=t.useSelector(s,c=>c.context.errors.authentication||null,(c,r)=>(c==null?void 0:c.error)===(r==null?void 0:r.error)),g=t.useSelector(s,c=>c.matches({authentication:"signedIn"})),h=t.useSelector(s,c=>c.matches({authentication:{authenticating:"securityKeyEmail"}}),(c,r)=>c===r),a=t.useSelector(s,c=>c.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(c,r)=>c===r),o=t.useSelector(s,c=>c.matches({authentication:{signedOut:"failed"}}),(c,r)=>c===r);return{accessToken:u,refreshToken:S,error:d,isError:o,isLoading:h,isSuccess:g,needsEmailVerification:a,signInEmailSecurityKey:e,user:n}},z=()=>{const s=f(),e=o=>p.signInPATPromise(s,o),n=t.useSelector(s,o=>o.context.user,(o,c)=>(o==null?void 0:o.id)===(c==null?void 0:c.id)),u=t.useSelector(s,o=>o.context.accessToken.value),S=t.useSelector(s,o=>o.context.refreshToken.value),d=t.useSelector(s,o=>o.context.errors.authentication||null,(o,c)=>(o==null?void 0:o.error)===(c==null?void 0:c.error)),g=t.useSelector(s,o=>o.matches({authentication:"signedIn"})),h=t.useSelector(s,o=>o.matches({authentication:{authenticating:"password"}}),(o,c)=>o===c),a=t.useSelector(s,o=>o.matches({authentication:{signedOut:"failed"}}),(o,c)=>o===c);return{accessToken:u,refreshToken:S,error:d,isError:a,isLoading:h,isSuccess:g,signInPAT:e,user:n}};function B(s){const e=f(),[n,u]=E.useState(""),S=(r,l=s)=>(u(r),p.signInSmsPasswordlessPromise(e,r,l)),d=async(...r)=>{if(r.length===2){const[i,m]=r;return p.signInSmsPasswordlessOtpPromise(e,i,m)}const[l]=r;return p.signInSmsPasswordlessOtpPromise(e,n,l)},g=t.useSelector(e,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),h=t.useSelector(e,r=>r.matches("registration.passwordlessSms")||r.matches("registration.passwordlessSmsOtp")),a=t.useSelector(e,r=>r.matches("authentication.signedIn")),o=t.useSelector(e,r=>r.matches("registration.incomplete.needsOtp")),c=t.useSelector(e,r=>r.matches("registration.incomplete.failed"));return{signInSmsPasswordless:S,sendOtp:d,isLoading:h,isSuccess:a,needsOtp:o,isError:c,error:g}}const X=(s=!1)=>{const e=f(),n=d=>p.signOutPromise(e,typeof d=="boolean"?d:s),u=t.useSelector(e,d=>d.matches({authentication:{signedOut:"success"}}),(d,g)=>d===g),S=t.useSelector(e,d=>d.context.errors.signout||null,(d,g)=>(d==null?void 0:d.error)===(g==null?void 0:g.error));return{signOut:n,isSuccess:u,error:S}},Z=s=>{const e=f(),n=t.useSelector(e,r=>!!r.context.errors.registration),u=t.useSelector(e,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),S=t.useSelector(e,r=>r.matches("registration.emailPassword")),d=t.useSelector(e,r=>r.matches("registration.incomplete.needsEmailVerification")),g=t.useSelector(e,r=>r.matches({authentication:"signedIn",registration:"complete"})),h=(r,l,i=s)=>p.signUpEmailPasswordPromise(e,r,l,i),a=t.useSelector(e,r=>r.context.user,(r,l)=>(r==null?void 0:r.id)===(l==null?void 0:l.id)),o=t.useSelector(e,r=>r.context.accessToken.value),c=t.useSelector(e,r=>r.context.refreshToken.value);return{accessToken:o,refreshToken:c,error:u,isError:n,isLoading:S,isSuccess:g,needsEmailVerification:d,signUpEmailPassword:h,user:a}},b=s=>{const e=f(),n=t.useSelector(e,r=>!!r.context.errors.registration),u=t.useSelector(e,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),S=t.useSelector(e,r=>r.matches("registration.securityKey")),d=t.useSelector(e,r=>r.matches("registration.incomplete.needsEmailVerification")),g=t.useSelector(e,r=>r.matches({authentication:"signedIn",registration:"complete"})),h=(r,l=s)=>p.signUpEmailSecurityKeyPromise(e,r,l),a=t.useSelector(e,r=>r.context.user,(r,l)=>(r==null?void 0:r.id)===(l==null?void 0:l.id)),o=t.useSelector(e,r=>r.context.accessToken.value),c=t.useSelector(e,r=>r.context.refreshToken.value);return{accessToken:o,refreshToken:c,error:u,isError:n,isLoading:S,isSuccess:g,needsEmailVerification:d,signUpEmailSecurityKey:h,user:a}},ee=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.avatarUrl},(e,n)=>e===n)},se=()=>{const s=f();return t.useSelector(s,e=>e.context.user,(e,n)=>(e&&JSON.stringify(e))===(n&&JSON.stringify(n)))},te=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.defaultRole},(e,n)=>e===n)},ne=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.displayName},(e,n)=>e===n)},re=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.email},(e,n)=>e===n)},oe=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.id},(e,n)=>e===n)},ce=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.isAnonymous},(e,n)=>e===n)},ie=()=>{const s=f();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.locale},(e,n)=>e===n)},ue=()=>{const s=f();return t.useSelector(s,e=>{var n;return e.matches("authentication.signedIn")?((n=e.context.user)==null?void 0:n.roles)||[]:[]})};Object.defineProperty(exports,"NHOST_REFRESH_TOKEN_KEY",{enumerable:!0,get:()=>p.NHOST_REFRESH_TOKEN_KEY});exports.NhostClient=O;exports.NhostProvider=T;exports.NhostReactContext=x;exports.NhostReactProvider=N;exports.SignedIn=M;exports.SignedOut=R;exports.VanillaNhostClient=y;exports.useAccessToken=A;exports.useAddSecurityKey=L;exports.useAuthInterpreter=f;exports.useAuthenticated=D;exports.useAuthenticationStatus=I;exports.useChangeEmail=K;exports.useChangePassword=V;exports.useConfigMfa=F;exports.useDecodedAccessToken=U;exports.useFileUpload=_;exports.useFileUploadItem=w;exports.useHasuraClaim=q;exports.useHasuraClaims=k;exports.useMultipleFilesUpload=H;exports.useNhostClient=P;exports.useProviderLink=j;exports.useResetPassword=Q;exports.useSendVerificationEmail=J;exports.useSignInAnonymous=Y;exports.useSignInEmailPassword=$;exports.useSignInEmailPasswordless=G;exports.useSignInEmailSecurityKey=W;exports.useSignInPAT=z;exports.useSignInSmsPasswordless=B;exports.useSignOut=X;exports.useSignUpEmailPassword=Z;exports.useSignUpEmailSecurityKeyEmail=b;exports.useUserAvatarUrl=ee;exports.useUserData=se;exports.useUserDefaultRole=te;exports.useUserDisplayName=ne;exports.useUserEmail=re;exports.useUserId=oe;exports.useUserIsAnonymous=ce;exports.useUserLocale=ie;exports.useUserRoles=ue;
//# sourceMappingURL=index.cjs.js.map
