"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const E=require("@nhost/nhost-js"),p=require("react"),n=require("@xstate/react"),C=require("jwt-decode"),k=E.NhostClient;class L extends k{constructor(t){super({...t,start:!1})}}const P=p.createContext({}),O=({nhost:e,initial:t,...c})=>{const i=n.useInterpret(e.auth.client.machine,{devTools:e.devTools});e.auth.client.start({interpreter:i,initialSession:t,devTools:e.devTools});const S=p.useRef(!0);return p.useEffect(()=>{S.current?S.current=!1:t&&i.send("SESSION_UPDATE",{data:{session:t}})},[t,i]),p.createElement(P.Provider,{value:e},c.children)},N=O,f=()=>{var c;const t=(c=p.useContext(P).auth)==null?void 0:c.client.interpreter;if(!t)throw Error("Could not find the Nhost auth client. Did you wrap your app in <NhostProvider />?");return t},y=()=>{const e=f();return n.useSelector(e,t=>({isAuthenticated:t.matches({authentication:"signedIn"}),isLoading:t.hasTag("loading"),error:t.context.errors.authentication||null,isError:t.matches({authentication:{signedOut:"failed"}}),connectionAttempts:t.context.importTokenAttempts}),(t,c)=>t.isAuthenticated===c.isAuthenticated&&t.isLoading===c.isLoading&&t.connectionAttempts===c.connectionAttempts)};function M({children:e}){const{isAuthenticated:t}=y();return t?p.createElement(p.Fragment,null,e):null}function R({children:e}){const{isAuthenticated:t}=y();return t?null:p.createElement(p.Fragment,null,e)}const T=()=>{const e=f();return n.useSelector(e,t=>t.context.accessToken.value)},I=()=>p.useContext(P),K=()=>{const e=I(),[t,c]=p.useState(null),i=!t,S=!!t,[l,m]=p.useState(!1);return{add:async u=>{m(!0);const s=await E.addSecurityKeyPromise(e.auth.client,u),{error:r}=s;return r&&c(r),m(!1),s},isLoading:l,isSuccess:i,isError:S,error:t}},D=()=>{const e=f(),[t,c]=p.useState(!!e.status&&e.getSnapshot().matches({authentication:"signedIn"}));return p.useEffect(()=>e.subscribe(S=>{const l=S.matches({authentication:"signedIn"});c(l)}).unsubscribe,[e]),t};function V(e){const t=I(),c=p.useMemo(()=>E.createChangeEmailMachine(t.auth.client),[t]),i=n.useInterpret(c),S=n.useSelector(i,s=>s.matches("requesting")),l=n.useSelector(i,s=>s.context.error),m=n.useSelector(i,s=>s.matches("idle.error")),h=n.useSelector(i,s=>s.matches("idle.success"));return{changeEmail:p.useCallback(async(s,r=e)=>E.changeEmailPromise(i,s,r),[i,e]),isLoading:S,needsEmailVerification:h,isError:m,error:l}}const F=()=>{const e=I(),t=p.useMemo(()=>E.createChangePasswordMachine(e.auth.client),[e]),c=n.useInterpret(t),i=n.useSelector(c,u=>u.matches({idle:"error"})),S=n.useSelector(c,u=>u.matches({idle:"success"})),l=n.useSelector(c,u=>u.context.error),m=n.useSelector(c,u=>u.matches("requesting"));return{changePassword:u=>E.changePasswordPromise(c,u),isLoading:m,isSuccess:S,isError:i,error:l}},_=()=>{const e=I(),t=p.useMemo(()=>E.createEnableMfaMachine(e.auth.client),[e]),c=n.useInterpret(t),i=n.useSelector(c,d=>d.matches({idle:"error"})||d.matches({generated:{idle:"error"}})),S=n.useSelector(c,d=>d.matches("generating")),l=n.useSelector(c,d=>d.matches("generated")),m=n.useSelector(c,d=>d.matches({generated:"activating"})),h=n.useSelector(c,d=>d.matches({generated:"activated"})),u=n.useSelector(c,d=>d.context.error),s=n.useSelector(c,d=>d.context.imageUrl||"");return{generateQrCode:()=>E.generateQrCodePromise(c),isGenerating:S,qrCodeDataUrl:s,isGenerated:l,activateMfa:d=>E.activateMfaPromise(c,d),isActivating:m,isActivated:h,isError:i,error:u}},w=()=>{const e=T();return e?C.jwtDecode(e):null},A=e=>{const t=I(),c=g=>{e.send({type:"ADD",file:g.file,bucketId:g.bucketId||d})},i=g=>E.uploadFilePromise({url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,...g},e),S=()=>{e.send("CANCEL")},l=()=>{e.send("DESTROY")},m=n.useSelector(e,g=>g.matches("uploading")),h=n.useSelector(e,g=>g.matches("uploaded")),u=n.useSelector(e,g=>g.matches("error")),s=n.useSelector(e,g=>g.context.error||null),r=n.useSelector(e,g=>g.context.progress),o=n.useSelector(e,g=>g.context.id),d=n.useSelector(e,g=>g.context.bucketId),a=n.useSelector(e,g=>{var v;return(v=g.context.file)==null?void 0:v.name});return{add:c,upload:i,cancel:S,destroy:l,isUploaded:h,isUploading:m,isError:u,error:s,progress:r,id:o,bucketId:d,name:a}},q=()=>{const e=n.useInterpret(E.createFileUploadMachine);return A(e)},x=()=>{const e=w();return(e==null?void 0:e["https://hasura.io/jwt/claims"])||null},H=e=>{const t=x();return(t==null?void 0:t[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null},j=()=>{const e=I(),[t,c]=p.useState([]),i=n.useInterpret(E.createMultipleFilesUploadMachine,{},a=>{a.event.type==="UPLOAD_ERROR"?c(a.context.files.filter(g=>{var v;return(v=g.getSnapshot())==null?void 0:v.context.error})):(a.matches("uploaded")||a.event.type==="CLEAR")&&t.length>0&&c([])}),S=a=>{i.send({type:"ADD",...a})},l=a=>E.uploadMultipleFilesPromise({url:e.storage.url,accessToken:e.auth.getAccessToken(),adminSecret:e.adminSecret,...a},i),m=()=>{i.send("CANCEL")},h=()=>{i.send("CLEAR")},u=n.useSelector(i,a=>a.matches("uploading")),s=n.useSelector(i,a=>a.matches("uploaded")),r=n.useSelector(i,a=>a.matches("error")),o=n.useSelector(i,a=>a.context.progress),d=n.useSelector(i,a=>a.context.files);return{upload:l,add:S,clear:h,cancel:m,progress:o,isUploaded:s,isUploading:u,files:d,isError:r,errors:t}},Q=e=>{const[t,c]=p.useState(!0),i=T();p.useEffect(()=>{c(!1)},[]);const S=p.useContext(P);return new Proxy({},{get(l,m){let h=`${S.auth.client.backendUrl}/signin/provider/${m}`;const u=e!=null&&e.connect?{connect:i}:{};return E.encodeQueryParameters(h,E.rewriteRedirectTo(t?void 0:S.auth.client.clientUrl,{...e,...u}))}})},J=e=>{const t=I(),c=p.useMemo(()=>E.createResetPasswordMachine(t.auth.client),[t]),i=n.useInterpret(c),S=n.useSelector(i,s=>s.matches("requesting")),l=n.useSelector(i,s=>s.context.error),m=n.useSelector(i,s=>s.matches("idle.error")),h=n.useSelector(i,s=>s.matches("idle.success"));return{resetPassword:(s,r=e)=>E.resetPasswordPromise(i,s,r),isLoading:S,isSent:h,isError:m,error:l}},Y=e=>{const t=I(),c=p.useMemo(()=>E.createSendVerificationEmailMachine(t.auth.client),[t]),i=n.useInterpret(c),S=n.useSelector(i,s=>s.matches({idle:"error"})),l=n.useSelector(i,s=>s.matches({idle:"success"})),m=n.useSelector(i,s=>s.context.error),h=n.useSelector(i,s=>s.matches("requesting"));return{sendEmail:(s,r=e)=>E.sendVerificationEmailPromise(i,s,r),isLoading:h,isSent:l,isError:S,error:m}},$=()=>{const e=f(),t=()=>E.signInAnonymousPromise(e),c=n.useSelector(e,u=>u.context.errors.authentication||null,(u,s)=>(u==null?void 0:u.error)===(s==null?void 0:s.error)),i=n.useSelector(e,u=>u.matches({authentication:{authenticating:"anonymous"}})),S=n.useSelector(e,u=>u.matches({authentication:"signedIn"})),l=n.useSelector(e,u=>u.matches({authentication:{signedOut:"failed"}})),m=n.useSelector(e,u=>u.context.user,(u,s)=>(u==null?void 0:u.id)===(s==null?void 0:s.id));return{accessToken:n.useSelector(e,u=>u.context.accessToken.value),error:c,isError:l,isLoading:i,isSuccess:S,signInAnonymous:t,user:m}},G=()=>{const e=f(),t=(a,g)=>E.signInEmailPasswordPromise(e,a,g),c=a=>E.signInMfaTotpPromise(e,a),i=n.useSelector(e,a=>a.context.user,(a,g)=>(a==null?void 0:a.id)===(g==null?void 0:g.id)),S=n.useSelector(e,a=>a.context.accessToken.value),l=n.useSelector(e,a=>a.context.refreshToken.value),m=n.useSelector(e,a=>a.context.errors.authentication||null,(a,g)=>(a==null?void 0:a.error)===(g==null?void 0:g.error)),h=n.useSelector(e,a=>a.matches({authentication:"signedIn"})),u=n.useSelector(e,a=>a.matches({authentication:{authenticating:"password"}}),(a,g)=>a===g),s=n.useSelector(e,a=>a.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(a,g)=>a===g),r=n.useSelector(e,a=>a.matches({authentication:{signedOut:"needsMfa"}}),(a,g)=>a===g),o=n.useSelector(e,a=>a.matches({authentication:{signedOut:"failed"}}),(a,g)=>a===g),d=n.useSelector(e,a=>a.context.mfa);return{accessToken:S,refreshToken:l,error:m,isError:o,isLoading:u,isSuccess:h,needsEmailVerification:s,needsMfaOtp:r,mfa:d,sendMfaOtp:c,signInEmailPassword:t,user:i}};function W(e){const t=f(),c=(h,u=e)=>E.signInEmailPasswordlessPromise(t,h,u),i=n.useSelector(t,h=>h.context.errors.registration||null,(h,u)=>(h==null?void 0:h.error)===(u==null?void 0:u.error)),S=n.useSelector(t,h=>h.matches("registration.passwordlessEmail")),l=n.useSelector(t,h=>h.matches("registration.incomplete.needsEmailVerification")),m=n.useSelector(t,h=>h.matches("registration.incomplete.failed"));return{signInEmailPasswordless:c,isLoading:S,isSuccess:l,isError:m,error:i}}const z=()=>{const e=f(),t=r=>E.signInEmailSecurityKeyPromise(e,r),c=n.useSelector(e,r=>r.context.user,(r,o)=>(r==null?void 0:r.id)===(o==null?void 0:o.id)),i=n.useSelector(e,r=>r.context.accessToken.value),S=n.useSelector(e,r=>r.context.refreshToken.value),l=n.useSelector(e,r=>r.context.errors.authentication||null,(r,o)=>(r==null?void 0:r.error)===(o==null?void 0:o.error)),m=n.useSelector(e,r=>r.matches({authentication:"signedIn"})),h=n.useSelector(e,r=>r.matches({authentication:{authenticating:"securityKeyEmail"}}),(r,o)=>r===o),u=n.useSelector(e,r=>r.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(r,o)=>r===o),s=n.useSelector(e,r=>r.matches({authentication:{signedOut:"failed"}}),(r,o)=>r===o);return{accessToken:i,refreshToken:S,error:l,isError:s,isLoading:h,isSuccess:m,needsEmailVerification:u,signInEmailSecurityKey:t,user:c}},U=()=>{const e=f();return n.useSelector(e,t=>t.context.user,(t,c)=>(t&&JSON.stringify(t))===(c&&JSON.stringify(c)))},B=()=>{const e=U(),t=I(),c=x(),i=e?(c==null?void 0:c["x-hasura-auth-elevated"])===(e==null?void 0:e.id):!1,[S,l]=p.useState(!!i),m=h=>E.elevateEmailSecurityKeyPromise(t.auth.client,h);return p.useEffect(()=>{l(!!i)},[i]),{elevated:S,elevateEmailSecurityKey:m}},X=()=>{const e=f(),t=s=>E.signInPATPromise(e,s),c=n.useSelector(e,s=>s.context.user,(s,r)=>(s==null?void 0:s.id)===(r==null?void 0:r.id)),i=n.useSelector(e,s=>s.context.accessToken.value),S=n.useSelector(e,s=>s.context.refreshToken.value),l=n.useSelector(e,s=>s.context.errors.authentication||null,(s,r)=>(s==null?void 0:s.error)===(r==null?void 0:r.error)),m=n.useSelector(e,s=>s.matches({authentication:"signedIn"})),h=n.useSelector(e,s=>s.matches({authentication:{authenticating:"password"}}),(s,r)=>s===r),u=n.useSelector(e,s=>s.matches({authentication:{signedOut:"failed"}}),(s,r)=>s===r);return{accessToken:i,refreshToken:S,error:l,isError:u,isLoading:h,isSuccess:m,signInPAT:t,user:c}};function Z(e){const t=f(),[c,i]=p.useState(""),S=(o,d=e)=>(i(o),E.signInSmsPasswordlessPromise(t,o,d)),l=async(...o)=>{if(o.length===2){const[a,g]=o;return E.signInSmsPasswordlessOtpPromise(t,a,g)}const[d]=o;return E.signInSmsPasswordlessOtpPromise(t,c,d)},m=n.useSelector(t,o=>o.context.errors.registration||null,(o,d)=>(o==null?void 0:o.error)===(d==null?void 0:d.error)),h=n.useSelector(t,o=>o.matches("registration.passwordlessSms")||o.matches("registration.passwordlessSmsOtp")),u=n.useSelector(t,o=>o.matches("authentication.signedIn")),s=n.useSelector(t,o=>o.matches("registration.incomplete.needsOtp")),r=n.useSelector(t,o=>o.matches("registration.incomplete.failed"));return{signInSmsPasswordless:S,sendOtp:l,isLoading:h,isSuccess:u,needsOtp:s,isError:r,error:m}}const b=(e=!1)=>{const t=f(),c=l=>E.signOutPromise(t,typeof l=="boolean"?l:e),i=n.useSelector(t,l=>l.matches({authentication:{signedOut:"success"}}),(l,m)=>l===m),S=n.useSelector(t,l=>l.context.errors.signout||null,(l,m)=>(l==null?void 0:l.error)===(m==null?void 0:m.error));return{signOut:c,isSuccess:i,error:S}},ee=e=>{const t=f(),c=n.useSelector(t,o=>!!o.context.errors.registration),i=n.useSelector(t,o=>o.context.errors.registration||null,(o,d)=>(o==null?void 0:o.error)===(d==null?void 0:d.error)),S=n.useSelector(t,o=>o.matches("registration.emailPassword")),l=n.useSelector(t,o=>o.matches("registration.incomplete.needsEmailVerification")),m=n.useSelector(t,o=>o.matches({authentication:"signedIn",registration:"complete"})),h=(o,d,a=e,g)=>E.signUpEmailPasswordPromise(t,o,d,a,g),u=n.useSelector(t,o=>o.context.user,(o,d)=>(o==null?void 0:o.id)===(d==null?void 0:d.id)),s=n.useSelector(t,o=>o.context.accessToken.value),r=n.useSelector(t,o=>o.context.refreshToken.value);return{accessToken:s,refreshToken:r,error:i,isError:c,isLoading:S,isSuccess:m,needsEmailVerification:l,signUpEmailPassword:h,user:u}},te=e=>{const t=f(),c=n.useSelector(t,o=>!!o.context.errors.registration),i=n.useSelector(t,o=>o.context.errors.registration||null,(o,d)=>(o==null?void 0:o.error)===(d==null?void 0:d.error)),S=n.useSelector(t,o=>o.matches("registration.securityKey")),l=n.useSelector(t,o=>o.matches("registration.incomplete.needsEmailVerification")),m=n.useSelector(t,o=>o.matches({authentication:"signedIn",registration:"complete"})),h=(o,d=e)=>E.signUpEmailSecurityKeyPromise(t,o,d),u=n.useSelector(t,o=>o.context.user,(o,d)=>(o==null?void 0:o.id)===(d==null?void 0:d.id)),s=n.useSelector(t,o=>o.context.accessToken.value),r=n.useSelector(t,o=>o.context.refreshToken.value);return{accessToken:s,refreshToken:r,error:i,isError:c,isLoading:S,isSuccess:m,needsEmailVerification:l,signUpEmailSecurityKey:h,user:u}},se=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.avatarUrl},(t,c)=>t===c)},ne=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.defaultRole},(t,c)=>t===c)},re=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.displayName},(t,c)=>t===c)},oe=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.email},(t,c)=>t===c)},ce=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.id},(t,c)=>t===c)},ie=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.isAnonymous},(t,c)=>t===c)},ue=()=>{const e=f();return n.useSelector(e,t=>{var c;return(c=t.context.user)==null?void 0:c.locale},(t,c)=>t===c)},ae=()=>{const e=f();return n.useSelector(e,t=>{var c;return t.matches("authentication.signedIn")?((c=t.context.user)==null?void 0:c.roles)||[]:[]})};function le(e){const t=f(),c=(s,r=e)=>E.signInEmailOTPPromise(t,s,r),i=async(s,r)=>E.verifyEmailOTPPromise(t,s,r),S=n.useSelector(t,s=>s.context.errors.registration||null,(s,r)=>(s==null?void 0:s.error)===(r==null?void 0:r.error)),l=n.useSelector(t,s=>s.matches("registration.signInEmailOTP")||s.matches("registration.verifyEmailOTP")),m=n.useSelector(t,s=>s.matches("authentication.signedIn")),h=n.useSelector(t,s=>s.matches("registration.incomplete.needsOtp")),u=n.useSelector(t,s=>s.matches("registration.incomplete.failed"));return{signInEmailOTP:c,verifyEmailOTP:i,isLoading:l,isSuccess:m,isError:u,error:S,needsOtp:h}}const de=()=>{const e=f(),t=(s,r,o)=>E.signInIdTokenPromise(e,{provider:s,idToken:r,nonce:o}),c=n.useSelector(e,s=>s.context.user,(s,r)=>(s==null?void 0:s.id)===(r==null?void 0:r.id)),i=n.useSelector(e,s=>s.context.accessToken.value),S=n.useSelector(e,s=>s.context.refreshToken.value),l=n.useSelector(e,s=>s.context.errors.authentication||null,(s,r)=>(s==null?void 0:s.error)===(r==null?void 0:r.error)),m=n.useSelector(e,s=>s.matches({authentication:"signedIn"})),h=n.useSelector(e,s=>s.matches({authentication:{authenticating:"idToken"}}),(s,r)=>s===r),u=n.useSelector(e,s=>s.matches({authentication:{signedOut:"failed"}}),(s,r)=>s===r);return{accessToken:i,refreshToken:S,error:l,isError:u,isLoading:h,isSuccess:m,signInIdToken:t,user:c}},Se=()=>{const e=I(),[t,c]=p.useState(null),i=!t,S=!!t,[l,m]=p.useState(!1);return{linkIdToken:async({provider:u,idToken:s,nonce:r})=>{m(!0);const o=await E.linkIdTokenPromise(e.auth.client,{provider:u,idToken:s,...r&&{nonce:r}}),{error:d}=o;return d&&c(d),m(!1),o},isLoading:l,isSuccess:i,isError:S,error:t}},me=()=>{const e=f(),t=()=>E.signInSecurityKeyPromise(e),c=n.useSelector(e,r=>r.context.user,(r,o)=>(r==null?void 0:r.id)===(o==null?void 0:o.id)),i=n.useSelector(e,r=>r.context.accessToken.value),S=n.useSelector(e,r=>r.context.refreshToken.value),l=n.useSelector(e,r=>r.context.errors.authentication||null,(r,o)=>(r==null?void 0:r.error)===(o==null?void 0:o.error)),m=n.useSelector(e,r=>r.matches({authentication:"signedIn"})),h=n.useSelector(e,r=>r.matches({authentication:{authenticating:"securityKeyEmail"}}),(r,o)=>r===o),u=n.useSelector(e,r=>r.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(r,o)=>r===o),s=n.useSelector(e,r=>r.matches({authentication:{signedOut:"failed"}}),(r,o)=>r===o);return{accessToken:i,refreshToken:S,error:l,isError:s,isLoading:h,isSuccess:m,needsEmailVerification:u,signInSecurityKey:t,user:c}};Object.defineProperty(exports,"NHOST_REFRESH_TOKEN_KEY",{enumerable:!0,get:()=>E.NHOST_REFRESH_TOKEN_KEY});exports.NhostClient=L;exports.NhostProvider=O;exports.NhostReactContext=P;exports.NhostReactProvider=N;exports.SignedIn=M;exports.SignedOut=R;exports.VanillaNhostClient=k;exports.useAccessToken=T;exports.useAddSecurityKey=K;exports.useAuthInterpreter=f;exports.useAuthenticated=D;exports.useAuthenticationStatus=y;exports.useChangeEmail=V;exports.useChangePassword=F;exports.useConfigMfa=_;exports.useDecodedAccessToken=w;exports.useElevateSecurityKeyEmail=B;exports.useFileUpload=q;exports.useFileUploadItem=A;exports.useHasuraClaim=H;exports.useHasuraClaims=x;exports.useLinkIdToken=Se;exports.useMultipleFilesUpload=j;exports.useNhostClient=I;exports.useProviderLink=Q;exports.useResetPassword=J;exports.useSendVerificationEmail=Y;exports.useSignInAnonymous=$;exports.useSignInEmailOTP=le;exports.useSignInEmailPassword=G;exports.useSignInEmailPasswordless=W;exports.useSignInEmailSecurityKey=z;exports.useSignInIdToken=de;exports.useSignInPAT=X;exports.useSignInSecurityKey=me;exports.useSignInSmsPasswordless=Z;exports.useSignOut=b;exports.useSignUpEmailPassword=ee;exports.useSignUpEmailSecurityKeyEmail=te;exports.useUserAvatarUrl=se;exports.useUserData=U;exports.useUserDefaultRole=ne;exports.useUserDisplayName=re;exports.useUserEmail=oe;exports.useUserId=ce;exports.useUserIsAnonymous=ie;exports.useUserLocale=ue;exports.useUserRoles=ae;
//# sourceMappingURL=index.cjs.js.map
