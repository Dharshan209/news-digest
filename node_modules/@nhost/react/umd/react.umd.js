(function(I,P){typeof exports=="object"&&typeof module!="undefined"?P(exports,require("react"),require("react/jsx-runtime")):typeof define=="function"&&define.amd?define(["exports","react","react/jsx-runtime"],P):(I=typeof globalThis!="undefined"?globalThis:I||self,P(I["@nhost/react"]={},I.React,I._jsx))})(this,function(I,P,Gi){"use strict";function Hi(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const Ki=Hi(P);class Je extends Error{}Je.prototype.name="InvalidTokenError";function Yi(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function $i(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Yi(e)}catch{return atob(e)}}function qt(t,e){if(typeof t!="string")throw new Je("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,r=t.split(".")[n];if(typeof r!="string")throw new Je(`Invalid token specified: missing part #${n+1}`);let i;try{i=$i(r)}catch(s){throw new Je(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new Je(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var S=function(){return S=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},S.apply(this,arguments)};function Jt(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function F(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function V(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(h){o={error:h}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function q(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var Y;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(Y||(Y={}));var Oe;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(Oe||(Oe={}));var ht=Y.Start,ft=Y.Stop,Le=Y.Raise,We=Y.Send,Wt=Y.Cancel,zn=Y.NullEvent,pt=Y.Assign,zi=Y.After,qi=Y.DoneState,vt=Y.Log,qn=Y.Init,mt=Y.Invoke,Ji=Y.ErrorExecution,Qt=Y.ErrorPlatform,Xt=Y.ErrorCustom,yt=Y.Update,Jn=Y.Choose,Wn=Y.Pure;const Wi=Object.freeze(Object.defineProperty({__proto__:null,after:zi,assign:pt,cancel:Wt,choose:Jn,doneState:qi,error:Xt,errorExecution:Ji,errorPlatform:Qt,init:qn,invoke:mt,log:vt,nullEvent:zn,pure:Wn,raise:Le,send:We,start:ht,stop:ft,update:yt},Symbol.toStringTag,{value:"Module"}));var Qn=".",Xn={},Zt="xstate.guard",Qi="",Q=process.env.NODE_ENV==="production",gt;function en(t,e,n){n===void 0&&(n=Qn);var r=Qe(t,n),i=Qe(e,n);return G(i)?G(r)?i===r:!1:G(r)?r in i:Object.keys(r).every(function(s){return s in i?en(r[s],i[s]):!1})}function Zn(t){try{return G(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function tn(t,e){try{return Ue(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function Xi(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function Qe(t,e){if(Xi(t))return t.value;if(Ue(t))return Et(t);if(typeof t!="string")return t;var n=tn(t,e);return Et(n)}function Et(t){if(t.length===1)return t[0];for(var e={},n=e,r=0;r<t.length-1;r++)r===t.length-2?n[t[r]]=t[r+1]:(n[t[r]]={},n=n[t[r]]);return e}function Xe(t,e){for(var n={},r=Object.keys(t),i=0;i<r.length;i++){var s=r[i];n[s]=e(t[s],s,t,i)}return n}function er(t,e,n){var r,i,s={};try{for(var o=F(Object.keys(t)),h=o.next();!h.done;h=o.next()){var d=h.value,a=t[d];n(a)&&(s[d]=e(a,d,t))}}catch(u){r={error:u}}finally{try{h&&!h.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}var Zi=function(t){return function(e){var n,r,i=e;try{for(var s=F(t),o=s.next();!o.done;o=s.next()){var h=o.value;i=i[h]}}catch(d){n={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}};function es(t,e){return function(n){var r,i,s=n;try{for(var o=F(t),h=o.next();!h.done;h=o.next()){var d=h.value;s=s[e][d]}}catch(a){r={error:a}}finally{try{h&&!h.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}}function Tt(t){if(!t)return[[]];if(G(t))return[[t]];var e=X(Object.keys(t).map(function(n){var r=t[n];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[n]]:Tt(t[n]).map(function(i){return[n].concat(i)})}));return e}function X(t){var e;return(e=[]).concat.apply(e,q([],V(t),!1))}function tr(t){return Ue(t)?t:[t]}function fe(t){return t===void 0?[]:tr(t)}function St(t,e,n){var r,i;if(B(t))return t(e,n.data);var s={};try{for(var o=F(Object.keys(t)),h=o.next();!h.done;h=o.next()){var d=h.value,a=t[d];B(a)?s[d]=a(e,n.data):s[d]=a}}catch(u){r={error:u}}finally{try{h&&!h.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function ts(t){return/^(done|error)\./.test(t)}function nr(t){return!!(t instanceof Promise||t!==null&&(B(t)||typeof t=="object")&&B(t.then))}function ns(t){return t!==null&&typeof t=="object"&&"transition"in t&&typeof t.transition=="function"}function rs(t,e){var n,r,i=V([[],[]],2),s=i[0],o=i[1];try{for(var h=F(t),d=h.next();!d.done;d=h.next()){var a=d.value;e(a)?s.push(a):o.push(a)}}catch(u){n={error:u}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return[s,o]}function rr(t,e){return Xe(t.states,function(n,r){if(n){var i=(G(e)?void 0:e[r])||(n?n.current:void 0);if(i)return{current:i,states:rr(n,i)}}})}function is(t,e){return{current:e,states:rr(t,e)}}function ir(t,e,n,r){Q||ie(!!t,"Attempting to update undefined context");var i=t&&n.reduce(function(s,o){var h,d,a=o.assignment,u={state:r,action:o,_event:e},c={};if(B(a))c=a(s,e.data,u);else try{for(var l=F(Object.keys(a)),f=l.next();!f.done;f=l.next()){var p=f.value,v=a[p];c[p]=B(v)?v(s,e.data,u):v}}catch(T){h={error:T}}finally{try{f&&!f.done&&(d=l.return)&&d.call(l)}finally{if(h)throw h.error}}return Object.assign({},s,c)},t);return i}var ie=function(){};Q||(ie=function(t,e){var n=t instanceof Error?t:void 0;if(!(!n&&t)&&console!==void 0){var r=["Warning: ".concat(e)];n&&r.push(n),console.warn.apply(console,r)}});function Ue(t){return Array.isArray(t)}function B(t){return typeof t=="function"}function G(t){return typeof t=="string"}function sr(t,e){if(t)return G(t)?{type:Zt,name:t,predicate:e?e[t]:void 0}:B(t)?{type:Zt,name:t.name,predicate:t}:t}function ss(t){try{return"subscribe"in t&&B(t.subscribe)}catch{return!1}}var ke=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();gt={},gt[ke]=function(){return this},gt[Symbol.observable]=function(){return this};function Se(t){return!!t&&"__xstatenode"in t}function os(t){return!!t&&typeof t.send=="function"}var as=function(){var t=0;return function(){return t++,t.toString(16)}}();function wt(t,e){return G(t)||typeof t=="number"?S({type:t},e):t}function ae(t,e){if(!G(t)&&"$$type"in t&&t.$$type==="scxml")return t;var n=wt(t);return S({name:n.type,data:n,$$type:"scxml",type:"external"},e)}function Me(t,e){var n=tr(e).map(function(r){return typeof r=="undefined"||typeof r=="string"||Se(r)?{target:r,event:t}:S(S({},r),{event:t})});return n}function cs(t){if(!(t===void 0||t===Qi))return fe(t)}function us(t,e,n){if(!Q){var r=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";if(t===e)console.error("Missing onError handler for invocation '".concat(n,"', error was '").concat(t,"'.").concat(r));else{var i=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(n,"'. ")+"Original error: '".concat(t,"'. ").concat(r," Current error is '").concat(e,"'.").concat(i))}}}function or(t,e,n,r,i){var s=t.options.guards,o={state:i,cond:e,_event:r};if(e.type===Zt)return((s==null?void 0:s[e.name])||e.predicate)(n,r.data,o);var h=s==null?void 0:s[e.type];if(!h)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return h(n,r.data,o)}function ar(t){return typeof t=="string"?{type:t}:t}function Ze(t,e,n){var r=function(){},i=typeof t=="object",s=i?t:null;return{next:((i?t.next:t)||r).bind(s),error:((i?t.error:e)||r).bind(s),complete:((i?t.complete:n)||r).bind(s)}}function xt(t,e){return"".concat(t,":invocation[").concat(e,"]")}function nn(t){return(t.type===Le||t.type===We&&t.to===Oe.Internal)&&typeof t.delay!="number"}var be=ae({type:qn});function Ot(t,e){return e&&e[t]||void 0}function je(t,e){var n;if(G(t)||typeof t=="number"){var r=Ot(t,e);B(r)?n={type:t,exec:r}:r?n=r:n={type:t,exec:void 0}}else if(B(t))n={type:t.name||t.toString(),exec:t};else{var r=Ot(t.type,e);if(B(r))n=S(S({},t),{exec:r});else if(r){var i=r.type||t.type;n=S(S(S({},r),t),{type:i})}else n=t}return n}var we=function(t,e){if(!t)return[];var n=Ue(t)?t:[t];return n.map(function(r){return je(r,e)})};function kt(t){var e=je(t);return S(S({id:G(t)?t:e.id},e),{type:e.type})}function cr(t,e){return{type:Le,event:typeof t=="function"?t:wt(t),delay:e?e.delay:void 0,id:e==null?void 0:e.id}}function ur(t,e,n,r){var i={_event:n},s=ae(B(t.event)?t.event(e,n.data,i):t.event),o;if(G(t.delay)){var h=r&&r[t.delay];o=B(h)?h(e,n.data,i):h}else o=B(t.delay)?t.delay(e,n.data,i):t.delay;return S(S({},t),{type:Le,_event:s,delay:o})}function _e(t,e){return{to:e?e.to:void 0,type:We,event:B(t)?t:wt(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:B(t)?t.name:Zn(t)}}function lr(t,e,n,r){var i={_event:n},s=ae(B(t.event)?t.event(e,n.data,i):t.event),o;if(G(t.delay)){var h=r&&r[t.delay];o=B(h)?h(e,n.data,i):h}else o=B(t.delay)?t.delay(e,n.data,i):t.delay;var d=B(t.to)?t.to(e,n.data,i):t.to;return S(S({},t),{to:d,_event:s,event:s.data,delay:o})}function rn(t,e){return _e(t,S(S({},e),{to:Oe.Parent}))}function ls(t,e,n){return _e(e,S(S({},n),{to:t}))}function ds(){return rn(yt)}function hs(t,e){return _e(t,S(S({},e),{to:function(n,r,i){var s=i._event;return s.origin}}))}var fs=function(t,e){return{context:t,event:e}};function ps(t,e){return t===void 0&&(t=fs),{type:vt,label:e,expr:t}}var dr=function(t,e,n){return S(S({},t),{value:G(t.expr)?t.expr:t.expr(e,n.data,{_event:n})})},hr=function(t){return{type:Wt,sendId:t}};function fr(t){var e=kt(t);return{type:Y.Start,activity:e,exec:void 0}}function pr(t){var e=B(t)?t:kt(t);return{type:Y.Stop,activity:e,exec:void 0}}function vr(t,e,n){var r=B(t.activity)?t.activity(e,n.data):t.activity,i=typeof r=="string"?{id:r}:r,s={type:Y.Stop,activity:i};return s}var mr=function(t){return{type:pt,assignment:t}};function vs(t){return typeof t=="object"&&"type"in t}function yr(t,e){var n=e?"#".concat(e):"";return"".concat(Y.After,"(").concat(t,")").concat(n)}function et(t,e){var n="".concat(Y.DoneState,".").concat(t),r={type:n,data:e};return r.toString=function(){return n},r}function tt(t,e){var n="".concat(Y.DoneInvoke,".").concat(t),r={type:n,data:e};return r.toString=function(){return n},r}function Fe(t,e){var n="".concat(Y.ErrorPlatform,".").concat(t),r={type:n,data:e};return r.toString=function(){return n},r}function ms(t){return{type:Y.Pure,get:t}}function ys(t,e){if(!Q&&(!t||typeof t=="function")){var n=t;t=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=typeof n=="function"?n.apply(void 0,q([],V(r),!1)):n;if(!s)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return s}}return _e(function(r,i){return i},S(S({},e),{to:t}))}function gs(t,e){return rn(function(n,r,i){return{type:Xt,data:B(t)?t(n,r,i):t}},S(S({},e),{to:Oe.Parent}))}function Es(t){return{type:Y.Choose,conds:t}}var Ts=function(t){var e,n,r=[];try{for(var i=F(t),s=i.next();!s.done;s=i.next())for(var o=s.value,h=0;h<o.actions.length;){if(o.actions[h].type===pt){r.push(o.actions[h]),o.actions.splice(h,1);continue}h++}}catch(d){e={error:d}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r};function nt(t,e,n,r,i,s,o){o===void 0&&(o=!1);var h=o?[]:Ts(i),d=h.length?ir(n,r,h,e):n,a=o?[n]:void 0,u=[];function c(p,v){var T;switch(v.type){case Le:{var E=ur(v,d,r,t.options.delays);return s&&typeof E.delay=="number"&&s(E,d,r),E}case We:var x=lr(v,d,r,t.options.delays);if(!Q){var O=v.delay;ie(!G(O)||typeof x.delay=="number","No delay reference for delay expression '".concat(O,"' was found on machine '").concat(t.id,"'"))}return s&&x.to!==Oe.Internal&&(p==="entry"?u.push(x):s(x,d,r)),x;case vt:{var k=dr(v,d,r);return s==null||s(k,d,r),k}case Jn:{var C=v,b=(T=C.conds.find(function(m){var w=sr(m.cond,t.options.guards);return!w||or(t,w,d,r,s?void 0:e)}))===null||T===void 0?void 0:T.actions;if(!b)return[];var _=V(nt(t,e,d,r,[{type:p,actions:we(fe(b),t.options.actions)}],s,o),2),M=_[0],j=_[1];return d=j,a==null||a.push(d),M}case Wn:{var b=v.get(d,r.data);if(!b)return[];var Z=V(nt(t,e,d,r,[{type:p,actions:we(fe(b),t.options.actions)}],s,o),2),D=Z[0],$=Z[1];return d=$,a==null||a.push(d),D}case ft:{var k=vr(v,d,r);return s==null||s(k,n,r),k}case pt:{d=ir(d,r,[v],s?void 0:e),a==null||a.push(d);break}default:var ne=je(v,t.options.actions),W=ne.exec;if(s)s(ne,d,r);else if(W&&a){var Pe=a.length-1,Ce=S(S({},ne),{exec:function(m){for(var w=[],N=1;N<arguments.length;N++)w[N-1]=arguments[N];W.apply(void 0,q([a[Pe]],V(w),!1))}});ne=Ce}return ne}}function l(p){var v,T,E=[];try{for(var x=F(p.actions),O=x.next();!O.done;O=x.next()){var k=O.value,C=c(p.type,k);C&&(E=E.concat(C))}}catch(b){v={error:b}}finally{try{O&&!O.done&&(T=x.return)&&T.call(x)}finally{if(v)throw v.error}}return u.forEach(function(b){s(b,d,r)}),u.length=0,E}var f=X(i.map(l));return[f,d]}const Ss=Object.freeze(Object.defineProperty({__proto__:null,actionTypes:Wi,after:yr,assign:mr,cancel:hr,choose:Es,done:et,doneInvoke:tt,error:Fe,escalate:gs,forwardTo:ys,getActionFunction:Ot,initEvent:be,isActionObject:vs,log:ps,pure:ms,raise:cr,resolveActions:nt,resolveLog:dr,resolveRaise:ur,resolveSend:lr,resolveStop:vr,respond:hs,send:_e,sendParent:rn,sendTo:ls,sendUpdate:ds,start:fr,stop:pr,toActionObject:je,toActionObjects:we,toActivityDefinition:kt},Symbol.toStringTag,{value:"Module"}));var At=[],Ve=function(t,e){At.push(t);var n=e(t);return At.pop(),n},ws=function(t){return t(At[At.length-1])};function gr(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[ke]=function(){return this},e}function xs(t,e,n,r){var i,s=ar(t.src),o=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[s.type],h=t.data?St(t.data,n,r):void 0,d=o?sn(o,t.id,h):gr(t.id);return d.meta=t,d}function sn(t,e,n){var r=gr(e);if(r.deferred=!0,Se(t)){var i=r.state=Ve(void 0,function(){return(n?t.withContext(n):t).initialState});r.getSnapshot=function(){return i}}return r}function Os(t){try{return typeof t.send=="function"}catch{return!1}}function ks(t){return Os(t)&&"id"in t}function As(t){var e;return S((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[ke]=function(){return this},e),t)}var It=function(t){return t.type==="atomic"||t.type==="final"};function Er(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function rt(t){return Er(t).filter(function(e){return e.type!=="history"})}function Tr(t){var e=[t];return It(t)?e:e.concat(X(rt(t).map(Tr)))}function it(t,e){var n,r,i,s,o,h,d,a,u=new Set(t),c=on(u),l=new Set(e);try{for(var f=F(l),p=f.next();!p.done;p=f.next())for(var v=p.value,T=v.parent;T&&!l.has(T);)l.add(T),T=T.parent}catch(j){n={error:j}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}var E=on(l);try{for(var x=F(l),O=x.next();!O.done;O=x.next()){var v=O.value;if(v.type==="compound"&&(!E.get(v)||!E.get(v).length))c.get(v)?c.get(v).forEach(function(Z){return l.add(Z)}):v.initialStateNodes.forEach(function(Z){return l.add(Z)});else if(v.type==="parallel")try{for(var k=(o=void 0,F(rt(v))),C=k.next();!C.done;C=k.next()){var b=C.value;l.has(b)||(l.add(b),c.get(b)?c.get(b).forEach(function(Z){return l.add(Z)}):b.initialStateNodes.forEach(function(Z){return l.add(Z)}))}}catch(Z){o={error:Z}}finally{try{C&&!C.done&&(h=k.return)&&h.call(k)}finally{if(o)throw o.error}}}}catch(j){i={error:j}}finally{try{O&&!O.done&&(s=x.return)&&s.call(x)}finally{if(i)throw i.error}}try{for(var _=F(l),M=_.next();!M.done;M=_.next())for(var v=M.value,T=v.parent;T&&!l.has(T);)l.add(T),T=T.parent}catch(j){d={error:j}}finally{try{M&&!M.done&&(a=_.return)&&a.call(_)}finally{if(d)throw d.error}}return l}function Sr(t,e){var n=e.get(t);if(!n)return{};if(t.type==="compound"){var r=n[0];if(r){if(It(r))return r.key}else return{}}var i={};return n.forEach(function(s){i[s.key]=Sr(s,e)}),i}function on(t){var e,n,r=new Map;try{for(var i=F(t),s=i.next();!s.done;s=i.next()){var o=s.value;r.has(o)||r.set(o,[]),o.parent&&(r.has(o.parent)||r.set(o.parent,[]),r.get(o.parent).push(o))}}catch(h){e={error:h}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Is(t,e){var n=it([t],e);return Sr(t,on(n))}function st(t,e){return Array.isArray(t)?t.some(function(n){return n===e}):t instanceof Set?t.has(e):!1}function bs(t){return q([],V(new Set(X(q([],V(t.map(function(e){return e.ownEvents})),!1)))),!1)}function bt(t,e){return e.type==="compound"?rt(e).some(function(n){return n.type==="final"&&st(t,n)}):e.type==="parallel"?rt(e).every(function(n){return bt(t,n)}):!1}function _s(t){return t===void 0&&(t=[]),t.reduce(function(e,n){return n.meta!==void 0&&(e[n.id]=n.meta),e},{})}function wr(t){return new Set(X(t.map(function(e){return e.tags})))}function xr(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(G(t)||G(e))return t===e;var n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&n.every(function(i){return xr(t[i],e[i])})}function Ns(t){return typeof t!="object"||t===null?!1:"value"in t&&"_event"in t}function Rs(t,e){var n=t.exec,r=S(S({},t),{exec:n!==void 0?function(){return n(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0});return r}var pe=function(){function t(e){var n=this,r;this.actions=[],this.activities=Xn,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||Xn,this.meta=_s(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(r=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&r!==void 0?r:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return bs(n.configuration)}})}return t.from=function(e,n){if(e instanceof t)return e.context!==n?new t({value:e.value,context:n,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var r=be;return new t({value:e,context:n,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,n){if(e instanceof t){if(!e.actions.length)return e;var r=be;return new t({value:e.value,context:n,_event:r,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,n)},t.prototype.toStrings=function(e,n){var r=this;if(e===void 0&&(e=this.value),n===void 0&&(n="."),G(e))return[e];var i=Object.keys(e);return i.concat.apply(i,q([],V(i.map(function(s){return r.toStrings(e[s],n).map(function(o){return s+n+o})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var n=e.tags;e.machine;var r=Jt(e,["configuration","transitions","tags","machine"]);return S(S({},r),{tags:Array.from(n)})},t.prototype.matches=function(e){return en(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var n;Q&&ie(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var r=(n=this.machine)===null||n===void 0?void 0:n.getTransitionData(this,e);return!!(r!=null&&r.transitions.length)&&r.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),Ds={deferEvents:!1},Or=function(){function t(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=S(S({},Ds),e)}return t.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},t.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},t.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(n){throw this.clear(),n}finally{this.processingEvent=!1}},t}(),an=new Map,Ps=0,ot={bookId:function(){return"x:".concat(Ps++)},register:function(t,e){return an.set(t,e),t},get:function(t){return an.get(t)},free:function(t){an.delete(t)}};function cn(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;Q||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues")}function Cs(){var t=cn();if(t&&"__xstate__"in t)return t.__xstate__}function Ls(t){if(cn()){var e=Cs();e&&e.register(t)}}function Us(t,e){e===void 0&&(e={});var n=t.initialState,r=new Set,i=[],s=!1,o=function(){if(!s){for(s=!0;i.length>0;){var a=i.shift();n=t.transition(n,a,d),r.forEach(function(u){return u.next(n)})}s=!1}},h=As({id:e.id,send:function(a){i.push(a),o()},getSnapshot:function(){return n},subscribe:function(a,u,c){var l=Ze(a,u,c);return r.add(l),l.next(n),{unsubscribe:function(){r.delete(l)}}}}),d={parent:e.parent,self:h,id:e.id||"anonymous",observers:r};return n=t.start?t.start(d):n,h}var un={sync:!1,autoForward:!1},ee;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(ee||(ee={}));var Ms=function(){function t(e,n){n===void 0&&(n=t.defaultOptions);var r=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=ee.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(u,c){if(Ue(u))return r.batch(u),r.state;var l=ae(wt(u,c));if(r.status===ee.Stopped)return Q||ie(!1,'Event "'.concat(l.name,'" was sent to stopped service "').concat(r.machine.id,`". This service has already reached its final state, and will not transition.
Event: `).concat(JSON.stringify(l.data))),r.state;if(r.status!==ee.Running&&!r.options.deferEvents)throw new Error('Event "'.concat(l.name,'" was sent to uninitialized service "').concat(r.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(l.data)));return r.scheduler.schedule(function(){r.forward(l);var f=r._nextState(l);r.update(f,l)}),r._state},this.sendTo=function(u,c,l){var f=r.parent&&(c===Oe.Parent||r.parent.id===c),p=f?r.parent:G(c)?c===Oe.Internal?r:r.children.get(c)||ot.get(c):os(c)?c:void 0;if(!p){if(!f)throw new Error("Unable to send event to child '".concat(c,"' from service '").concat(r.id,"'."));Q||ie(!1,"Service '".concat(r.id,"' has no parent: unable to send event ").concat(u.type));return}if("machine"in p){if(r.status!==ee.Stopped||r.parent!==p||r.state.done){var v=S(S({},u),{name:u.name===Xt?"".concat(Fe(r.id)):u.name,origin:r.sessionId});!l&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([p,v]):p.send(v)}}else!l&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([p,u.data]):p.send(u.data)},this._exec=function(u,c,l,f){f===void 0&&(f=r.machine.options.actions);var p=u.exec||Ot(u.type,f),v=B(p)?p:p?p.exec:u.exec;if(v)try{return v(c,l.data,r.machine.config.predictableActionArguments?{action:u,_event:l}:{action:u,state:r.state,_event:l})}catch(W){throw r.parent&&r.parent.send({type:"xstate.error",data:W}),W}switch(u.type){case Le:{var T=u;r.defer(T);break}case We:var E=u;if(typeof E.delay=="number"){r.defer(E);return}else E.to?r.sendTo(E._event,E.to,l===be):r.send(E._event);break;case Wt:r.cancel(u.sendId);break;case ht:{if(r.status!==ee.Running)return;var x=u.activity;if(!r.machine.config.predictableActionArguments&&!r.state.activities[x.id||x.type])break;if(x.type===Y.Invoke){var O=ar(x.src),k=r.machine.options.services?r.machine.options.services[O.type]:void 0,C=x.id,b=x.data;Q||ie(!("forward"in x),"`forward` property is deprecated (found in invocation of '".concat(x.src,"' in in machine '").concat(r.machine.id,"'). ")+"Please use `autoForward` instead.");var _="autoForward"in x?x.autoForward:!!x.forward;if(!k){Q||ie(!1,"No service found for invocation '".concat(x.src,"' in machine '").concat(r.machine.id,"'."));return}var M=b?St(b,c,l):void 0;if(typeof k=="string")return;var j=B(k)?k(c,l.data,{data:M,src:O,meta:x.meta}):k;if(!j)return;var Z=void 0;Se(j)&&(j=M?j.withContext(M):j,Z={autoForward:_}),r.spawn(j,C,Z)}else r.spawnActivity(x);break}case ft:{r.stopChild(u.activity.id);break}case vt:var D=u,$=D.label,ne=D.value;$?r.logger($,ne):r.logger(ne);break;default:Q||ie(!1,"No implementation found for action type '".concat(u.type,"'"));break}};var i=S(S({},t.defaultOptions),n),s=i.clock,o=i.logger,h=i.parent,d=i.id,a=d!==void 0?d:e.id;this.id=a,this.logger=o,this.clock=s,this.parent=h,this.options=i,this.scheduler=new Or({deferEvents:this.options.deferEvents}),this.sessionId=ot.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:Ve(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return Q||ie(this.status!==ee.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(e,n){var r,i;try{for(var s=F(e.actions),o=s.next();!o.done;o=s.next()){var h=o.value;this.exec(h,e,n)}}catch(d){r={error:d}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.prototype.update=function(e,n){var r,i,s,o,h,d,a,u,c=this;if(e._sessionid=this.sessionId,this._state=e,(!this.machine.config.predictableActionArguments||n===be)&&this.options.execute)this.execute(this.state);else for(var l=void 0;l=this._outgoingQueue.shift();)l[0].send(l[1]);if(this.children.forEach(function(j){c.state.children[j.id]=j}),this.devTools&&this.devTools.send(n.data,e),e.event)try{for(var f=F(this.eventListeners),p=f.next();!p.done;p=f.next()){var v=p.value;v(e.event)}}catch(j){r={error:j}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}try{for(var T=F(this.listeners),E=T.next();!E.done;E=T.next()){var v=E.value;v(e,e.event)}}catch(j){s={error:j}}finally{try{E&&!E.done&&(o=T.return)&&o.call(T)}finally{if(s)throw s.error}}try{for(var x=F(this.contextListeners),O=x.next();!O.done;O=x.next()){var k=O.value;k(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(j){h={error:j}}finally{try{O&&!O.done&&(d=x.return)&&d.call(x)}finally{if(h)throw h.error}}if(this.state.done){var C=e.configuration.find(function(j){return j.type==="final"&&j.parent===c.machine}),b=C&&C.doneData?St(C.doneData,e.context,n):void 0;this._doneEvent=tt(this.id,b);try{for(var _=F(this.doneListeners),M=_.next();!M.done;M=_.next()){var v=M.value;v(this._doneEvent)}}catch(j){a={error:j}}finally{try{M&&!M.done&&(u=_.return)&&u.call(_)}finally{if(a)throw a.error}}this._stop(),this._stopChildren(),ot.free(this.sessionId)}},t.prototype.onTransition=function(e){return this.listeners.add(e),this.status===ee.Running&&e(this.state,this.state.event),this},t.prototype.subscribe=function(e,n,r){var i=this,s=Ze(e,n,r);this.listeners.add(s.next),this.status!==ee.NotStarted&&s.next(this.state);var o=function(){i.doneListeners.delete(o),i.stopListeners.delete(o),s.complete()};return this.status===ee.Stopped?s.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){i.listeners.delete(s.next),i.doneListeners.delete(o),i.stopListeners.delete(o)}}},t.prototype.onEvent=function(e){return this.eventListeners.add(e),this},t.prototype.onSend=function(e){return this.sendListeners.add(e),this},t.prototype.onChange=function(e){return this.contextListeners.add(e),this},t.prototype.onStop=function(e){return this.stopListeners.add(e),this},t.prototype.onDone=function(e){return this.status===ee.Stopped&&this._doneEvent?e(this._doneEvent):this.doneListeners.add(e),this},t.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},t.prototype.start=function(e){var n=this;if(this.status===ee.Running)return this;this.machine._init(),ot.register(this.sessionId,this),this.initialized=!0,this.status=ee.Running;var r=e===void 0?this.initialState:Ve(this,function(){return Ns(e)?n.machine.resolveState(e):n.machine.resolveState(pe.from(e,n.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){n.update(r,be)}),this},t.prototype._stopChildren=function(){this.children.forEach(function(e){B(e.stop)&&e.stop()}),this.children.clear()},t.prototype._stop=function(){var e,n,r,i,s,o,h,d,a,u;try{for(var c=F(this.listeners),l=c.next();!l.done;l=c.next()){var f=l.value;this.listeners.delete(f)}}catch(_){e={error:_}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var p=F(this.stopListeners),v=p.next();!v.done;v=p.next()){var f=v.value;f(),this.stopListeners.delete(f)}}catch(_){r={error:_}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}try{for(var T=F(this.contextListeners),E=T.next();!E.done;E=T.next()){var f=E.value;this.contextListeners.delete(f)}}catch(_){s={error:_}}finally{try{E&&!E.done&&(o=T.return)&&o.call(T)}finally{if(s)throw s.error}}try{for(var x=F(this.doneListeners),O=x.next();!O.done;O=x.next()){var f=O.value;this.doneListeners.delete(f)}}catch(_){h={error:_}}finally{try{O&&!O.done&&(d=x.return)&&d.call(x)}finally{if(h)throw h.error}}if(!this.initialized)return this;this.initialized=!1,this.status=ee.Stopped,this._initialState=void 0;try{for(var k=F(Object.keys(this.delayedEventsMap)),C=k.next();!C.done;C=k.next()){var b=C.value;this.clock.clearTimeout(this.delayedEventsMap[b])}}catch(_){a={error:_}}finally{try{C&&!C.done&&(u=k.return)&&u.call(k)}finally{if(a)throw a.error}}this.scheduler.clear(),this.scheduler=new Or({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var e=this,n=this.scheduler;return this._stop(),n.schedule(function(){var r;if(!(!((r=e._state)===null||r===void 0)&&r.done)){var i=ae({type:"xstate.stop"}),s=Ve(e,function(){var o=X(q([],V(e.state.configuration),!1).sort(function(c,l){return l.order-c.order}).map(function(c){return we(c.onExit,e.machine.options.actions)})),h=V(nt(e.machine,e.state,e.state.context,i,[{type:"exit",actions:o}],e.machine.config.predictableActionArguments?e._exec:void 0,e.machine.config.predictableActionArguments||e.machine.config.preserveActionOrder),2),d=h[0],a=h[1],u=new pe({value:e.state.value,context:a,_event:i,_sessionid:e.sessionId,historyValue:void 0,history:e.state,actions:d.filter(function(c){return!nn(c)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:e.state.done,tags:e.state.tags,machine:e.machine});return u.changed=!0,u});e.update(s,i),e._stopChildren(),ot.free(e.sessionId)}}),this},t.prototype.batch=function(e){var n=this;if(this.status===ee.NotStarted&&this.options.deferEvents)Q||ie(!1,"".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,`" and are deferred. Make sure .start() is called for this service.
Event: `).concat(JSON.stringify(event)));else if(this.status!==ee.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(e.length){var r=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,s,o=n.state,h=!1,d=[],a=function(f){var p=ae(f);n.forward(p),o=Ve(n,function(){return n.machine.transition(o,p,void 0,r||void 0)}),d.push.apply(d,q([],V(n.machine.config.predictableActionArguments?o.actions:o.actions.map(function(v){return Rs(v,o)})),!1)),h=h||!!o.changed};try{for(var u=F(e),c=u.next();!c.done;c=u.next()){var l=c.value;a(l)}}catch(f){i={error:f}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}o.changed=h,o.actions=d,n.update(o,ae(e[e.length-1]))})}},t.prototype.sender=function(e){return this.send.bind(this,e)},t.prototype._nextState=function(e,n){var r=this;n===void 0&&(n=!!this.machine.config.predictableActionArguments&&this._exec);var i=ae(e);if(i.name.indexOf(Qt)===0&&!this.state.nextEvents.some(function(o){return o.indexOf(Qt)===0}))throw i.data.data;var s=Ve(this,function(){return r.machine.transition(r.state,i,void 0,n||void 0)});return s},t.prototype.nextState=function(e){return this._nextState(e,!1)},t.prototype.forward=function(e){var n,r;try{for(var i=F(this.forwardTo),s=i.next();!s.done;s=i.next()){var o=s.value,h=this.children.get(o);if(!h)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));h.send(e)}}catch(d){n={error:d}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.defer=function(e){var n=this,r=this.clock.setTimeout(function(){"to"in e&&e.to?n.sendTo(e._event,e.to,!0):n.send(e._event)},e.delay);e.id&&(this.delayedEventsMap[e.id]=r)},t.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},t.prototype.exec=function(e,n,r){r===void 0&&(r=this.machine.options.actions),this._exec(e,n.context,n._event,r)},t.prototype.removeChild=function(e){var n;this.children.delete(e),this.forwardTo.delete(e),(n=this.state)===null||n===void 0||delete n.children[e]},t.prototype.stopChild=function(e){var n=this.children.get(e);n&&(this.removeChild(e),B(n.stop)&&n.stop())},t.prototype.spawn=function(e,n,r){if(this.status!==ee.Running)return sn(e,n);if(nr(e))return this.spawnPromise(Promise.resolve(e),n);if(B(e))return this.spawnCallback(e,n);if(ks(e))return this.spawnActor(e,n);if(ss(e))return this.spawnObservable(e,n);if(Se(e))return this.spawnMachine(e,S(S({},r),{id:n}));if(ns(e))return this.spawnBehavior(e,n);throw new Error('Unable to spawn entity "'.concat(n,'" of type "').concat(typeof e,'".'))},t.prototype.spawnMachine=function(e,n){var r=this;n===void 0&&(n={});var i=new t(e,S(S({},this.options),{parent:this,id:n.id||e.id})),s=S(S({},un),n);s.sync&&i.onTransition(function(h){r.send(yt,{state:h,id:i.id})});var o=i;return this.children.set(i.id,o),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(h){r.removeChild(i.id),r.send(ae(h,{origin:i.id}))}).start(),o},t.prototype.spawnBehavior=function(e,n){var r=Us(e,{id:n,parent:this});return this.children.set(n,r),r},t.prototype.spawnPromise=function(e,n){var r,i=this,s=!1,o;e.then(function(d){s||(o=d,i.removeChild(n),i.send(ae(tt(n,d),{origin:n})))},function(d){if(!s){i.removeChild(n);var a=Fe(n,d);try{i.send(ae(a,{origin:n}))}catch(u){us(d,u,n),i.devTools&&i.devTools.send(a,i.state),i.machine.strict&&i.stop()}}});var h=(r={id:n,send:function(){},subscribe:function(d,a,u){var c=Ze(d,a,u),l=!1;return e.then(function(f){l||(c.next(f),!l&&c.complete())},function(f){l||c.error(f)}),{unsubscribe:function(){return l=!0}}},stop:function(){s=!0},toJSON:function(){return{id:n}},getSnapshot:function(){return o}},r[ke]=function(){return this},r);return this.children.set(n,h),h},t.prototype.spawnCallback=function(e,n){var r,i=this,s=!1,o=new Set,h=new Set,d,a=function(l){d=l,h.forEach(function(f){return f(l)}),!s&&i.send(ae(l,{origin:n}))},u;try{u=e(a,function(l){o.add(l)})}catch(l){this.send(Fe(n,l))}if(nr(u))return this.spawnPromise(u,n);var c=(r={id:n,send:function(l){return o.forEach(function(f){return f(l)})},subscribe:function(l){var f=Ze(l);return h.add(f.next),{unsubscribe:function(){h.delete(f.next)}}},stop:function(){s=!0,B(u)&&u()},toJSON:function(){return{id:n}},getSnapshot:function(){return d}},r[ke]=function(){return this},r);return this.children.set(n,c),c},t.prototype.spawnObservable=function(e,n){var r,i=this,s,o=e.subscribe(function(d){s=d,i.send(ae(d,{origin:n}))},function(d){i.removeChild(n),i.send(ae(Fe(n,d),{origin:n}))},function(){i.removeChild(n),i.send(ae(tt(n),{origin:n}))}),h=(r={id:n,send:function(){},subscribe:function(d,a,u){return e.subscribe(d,a,u)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:n}}},r[ke]=function(){return this},r);return this.children.set(n,h),h},t.prototype.spawnActor=function(e,n){return this.children.set(n,e),e},t.prototype.spawnActivity=function(e){var n=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(!n){Q||ie(!1,"No implementation found for activity '".concat(e.type,"'"));return}var r=n(this.state.context,e);this.spawnEffect(e.id,r)},t.prototype.spawnEffect=function(e,n){var r;this.children.set(e,(r={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:n||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},r[ke]=function(){return this},r))},t.prototype.attachDev=function(){var e=cn();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var n=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(S(S({name:this.id,autoPause:!0,stateSanitizer:function(r){return{value:r.value,context:r.context,actions:r.actions}}},n),{features:S({jump:!1,skip:!1},n?n.features:void 0)}),this.machine),this.devTools.init(this.state)}Ls(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[ke]=function(){return this},t.prototype.getSnapshot=function(){return this.status===ee.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,n){return setTimeout(e,n)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},t.interpret=Ne,t}(),js=function(t){return G(t)?S(S({},un),{name:t}):S(S(S({},un),{name:as()}),t)};function Fs(t,e){var n=js(e);return ws(function(r){if(!Q){var i=Se(t)||B(t);ie(!!r||i,'Attempted to spawn an Actor (ID: "'.concat(Se(t)?t.id:"undefined",'") outside of a service. This will have no effect.'))}return r?r.spawn(t,n.name,n):sn(t,n.name)})}function Ne(t,e){var n=new Ms(t,e);return n}function Vs(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function _t(t){return S(S({type:mt},t),{toJSON:function(){t.onDone,t.onError;var e=Jt(t,["onDone","onError"]);return S(S({},e),{type:mt,src:Vs(t.src)})}})}var Be="",ln="#",at="*",Ge={},He=function(t){return t[0]===ln},Bs=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Gs=function(t,e,n){var r=n.slice(0,-1).some(function(s){return!("cond"in s)&&!("in"in s)&&(G(s.target)||Se(s.target))}),i=e===Be?"the transient event":"event '".concat(e,"'");ie(!r,"One or more transitions for ".concat(i," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},Hs=function(){function t(e,n,r,i){r===void 0&&(r="context"in e?e.context:void 0);var s=this,o;this.config=e,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Bs(),n),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:Qn),this.id=this.config.id||q([this.machine.key],V(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,Q||ie(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?Xe(this.config.states,function(a,u){var c,l=new t(a,{},void 0,{parent:s,key:u});return Object.assign(s.idMap,S((c={},c[l.id]=l,c),l.idMap)),l}):Ge;var h=0;function d(a){var u,c;a.order=h++;try{for(var l=F(Er(a)),f=l.next();!f.done;f=l.next()){var p=f.value;d(p)}}catch(v){u={error:v}}finally{try{f&&!f.done&&(c=l.return)&&c.call(l)}finally{if(u)throw u.error}}}d(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(a){var u=a.event;return u===Be}):Be in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=fe(this.config.entry||this.config.onEntry).map(function(a){return je(a)}),this.onExit=fe(this.config.exit||this.config.onExit).map(function(a){return je(a)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=fe(this.config.invoke).map(function(a,u){var c,l;if(Se(a)){var f=xt(s.id,u);return s.machine.options.services=S((c={},c[f]=a,c),s.machine.options.services),_t({src:f,id:f})}else if(G(a.src)){var f=a.id||xt(s.id,u);return _t(S(S({},a),{id:f,src:a.src}))}else if(Se(a.src)||B(a.src)){var f=a.id||xt(s.id,u);return s.machine.options.services=S((l={},l[f]=a.src,l),s.machine.options.services),_t(S(S({id:f},a),{src:f}))}else{var p=a.src;return _t(S(S({id:xt(s.id,u)},a),{src:p}))}}),this.activities=fe(this.config.activities).concat(this.invoke).map(function(a){return kt(a)}),this.transition=this.transition.bind(this),this.tags=fe(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||Tr(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,n){var r=this.options,i=r.actions,s=r.activities,o=r.guards,h=r.services,d=r.delays;return new t(this.config,{actions:S(S({},i),e.actions),activities:S(S({},s),e.activities),guards:S(S({},o),e.guards),services:S(S({},h),e.services),delays:S(S({},d),e.delays)},n!=null?n:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return B(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Xe(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(n,r){return n[r.eventType]=n[r.eventType]||[],n[r.eventType].push(r),n},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var n=e===Be,r=this.transitions.filter(function(i){var s=i.eventType===e;return n?s:s||i.eventType===at});return this.__cache.candidates[e]=r,r},t.prototype.getDelayedTransitions=function(){var e=this,n=this.config.after;if(!n)return[];var r=function(s,o){var h=B(s)?"".concat(e.id,":delay[").concat(o,"]"):s,d=yr(h,e.id);return e.onEntry.push(_e(d,{delay:s})),e.onExit.push(hr(d)),d},i=Ue(n)?n.map(function(s,o){var h=r(s.delay,o);return S(S({},s),{event:h})}):X(Object.keys(n).map(function(s,o){var h=n[s],d=G(h)?{target:h}:h,a=isNaN(+s)?s:+s,u=r(a,o);return fe(d).map(function(c){return S(S({},c),{event:u,delay:a})})}));return i.map(function(s){var o=s.delay;return S(S({},e.formatTransition(s)),{delay:o})})},t.prototype.getStateNodes=function(e){var n,r=this;if(!e)return[];var i=e instanceof pe?e.value:Qe(e,this.delimiter);if(G(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((n={},n[i]=s,n)):[this,this.states[i]]}var o=Object.keys(i),h=[this];return h.push.apply(h,q([],V(X(o.map(function(d){return r.getStateNode(d).getStateNodes(i[d])}))),!1)),h},t.prototype.handles=function(e){var n=Zn(e);return this.events.includes(n)},t.prototype.resolveState=function(e){var n=e instanceof pe?e:pe.create(e),r=Array.from(it([],this.getStateNodes(n.value)));return new pe(S(S({},n),{value:this.resolve(n.value),configuration:r,done:bt(r,this),tags:wr(r),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,n,r){var i=this.getStateNode(e),s=i.next(n,r);return!s||!s.transitions.length?this.next(n,r):s},t.prototype.transitionCompoundNode=function(e,n,r){var i=Object.keys(e),s=this.getStateNode(i[0]),o=s._transition(e[i[0]],n,r);return!o||!o.transitions.length?this.next(n,r):o},t.prototype.transitionParallelNode=function(e,n,r){var i,s,o={};try{for(var h=F(Object.keys(e)),d=h.next();!d.done;d=h.next()){var a=d.value,u=e[a];if(u){var c=this.getStateNode(a),l=c._transition(u,n,r);l&&(o[a]=l)}}}catch(E){i={error:E}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}var f=Object.keys(o).map(function(E){return o[E]}),p=X(f.map(function(E){return E.transitions})),v=f.some(function(E){return E.transitions.length>0});if(!v)return this.next(n,r);var T=X(Object.keys(o).map(function(E){return o[E].configuration}));return{transitions:p,exitSet:X(f.map(function(E){return E.exitSet})),configuration:T,source:n,actions:X(Object.keys(o).map(function(E){return o[E].actions}))}},t.prototype._transition=function(e,n,r){return G(e)?this.transitionLeafNode(e,n,r):Object.keys(e).length===1?this.transitionCompoundNode(e,n,r):this.transitionParallelNode(e,n,r)},t.prototype.getTransitionData=function(e,n){return this._transition(e.value,e,ae(n))},t.prototype.next=function(e,n){var r,i,s=this,o=n.name,h=[],d=[],a;try{for(var u=F(this.getCandidates(o)),c=u.next();!c.done;c=u.next()){var l=c.value,f=l.cond,p=l.in,v=e.context,T=p?G(p)&&He(p)?e.matches(Qe(this.getStateNodeById(p).path,this.delimiter)):en(Qe(p,this.delimiter),Zi(this.path.slice(0,-2))(e.value)):!0,E=!1;try{E=!f||or(this.machine,f,v,n,e)}catch(k){throw new Error("Unable to evaluate guard '".concat(f.name||f.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(k.message))}if(E&&T){l.target!==void 0&&(d=l.target),h.push.apply(h,q([],V(l.actions),!1)),a=l;break}}}catch(k){r={error:k}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}if(a){if(!d.length)return{transitions:[a],exitSet:[],configuration:e.value?[this]:[],source:e,actions:h};var x=X(d.map(function(k){return s.getRelativeStateNodes(k,e.historyValue)})),O=!!a.internal;return{transitions:[a],exitSet:O?[]:X(d.map(function(k){return s.getPotentiallyReenteringNodes(k)})),configuration:x,source:e,actions:h}}},t.prototype.getPotentiallyReenteringNodes=function(e){if(this.order<e.order)return[this];for(var n=[],r=this,i=e;r&&r!==i;)n.push(r),r=r.parent;return r!==i?[]:(n.push(i),n)},t.prototype.getActions=function(e,n,r,i,s,o,h){var d,a,u,c,l=this,f=o?it([],this.getStateNodes(o.value)):[],p=new Set;try{for(var v=F(Array.from(e).sort(function(D,$){return D.order-$.order})),T=v.next();!T.done;T=v.next()){var E=T.value;(!st(f,E)||st(r.exitSet,E)||E.parent&&p.has(E.parent))&&p.add(E)}}catch(D){d={error:D}}finally{try{T&&!T.done&&(a=v.return)&&a.call(v)}finally{if(d)throw d.error}}try{for(var x=F(f),O=x.next();!O.done;O=x.next()){var E=O.value;(!st(e,E)||st(r.exitSet,E.parent))&&r.exitSet.push(E)}}catch(D){u={error:D}}finally{try{O&&!O.done&&(c=x.return)&&c.call(x)}finally{if(u)throw u.error}}r.exitSet.sort(function(D,$){return $.order-D.order});var k=Array.from(p).sort(function(D,$){return D.order-$.order}),C=new Set(r.exitSet),b=X(k.map(function(D){var $=[];if(D.type!=="final")return $;var ne=D.parent;if(!ne.parent)return $;$.push(et(D.id,D.doneData),et(ne.id,D.doneData?St(D.doneData,i,s):void 0));var W=ne.parent;return W.type==="parallel"&&rt(W).every(function(Pe){return bt(r.configuration,Pe)})&&$.push(et(W.id)),$})),_=k.map(function(D){var $=D.onEntry,ne=D.activities.map(function(W){return fr(W)});return{type:"entry",actions:we(h?q(q([],V($),!1),V(ne),!1):q(q([],V(ne),!1),V($),!1),l.machine.options.actions)}}).concat({type:"state_done",actions:b.map(function(D){return cr(D)})}),M=Array.from(C).map(function(D){return{type:"exit",actions:we(q(q([],V(D.onExit),!1),V(D.activities.map(function($){return pr($)})),!1),l.machine.options.actions)}}),j=M.concat({type:"transition",actions:we(r.actions,this.machine.options.actions)}).concat(_);if(n){var Z=we(X(q([],V(e),!1).sort(function(D,$){return $.order-D.order}).map(function(D){return D.onExit})),this.machine.options.actions).filter(function(D){return!nn(D)});return j.concat({type:"stop",actions:Z})}return j},t.prototype.transition=function(e,n,r,i){e===void 0&&(e=this.initialState);var s=ae(n),o;if(e instanceof pe)o=r===void 0?e:this.resolveState(pe.from(e,r));else{var h=G(e)?this.resolve(Et(this.getResolvedPath(e))):this.resolve(e),d=r!=null?r:this.machine.context;o=this.resolveState(pe.from(h,d))}if(!Q&&s.name===at)throw new Error("An event cannot have the wildcard type ('".concat(at,"')"));if(this.strict&&!this.events.includes(s.name)&&!ts(s.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var a=this._transition(o.value,o,s)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},u=it([],this.getStateNodes(o.value)),c=a.configuration.length?it(u,a.configuration):u;return a.configuration=q([],V(c),!1),this.resolveTransition(a,o,o.context,i,s)},t.prototype.resolveRaisedTransition=function(e,n,r,i){var s,o=e.actions;return e=this.transition(e,n,void 0,i),e._event=r,e.event=r.data,(s=e.actions).unshift.apply(s,q([],V(o),!1)),e},t.prototype.resolveTransition=function(e,n,r,i,s){var o,h,d,a,u=this;s===void 0&&(s=be);var c=e.configuration,l=!n||e.transitions.length>0,f=l?e.configuration:n?n.configuration:[],p=bt(f,this),v=l?Is(this.machine,c):void 0,T=n?n.historyValue?n.historyValue:e.source?this.machine.historyValue(n.value):void 0:void 0,E=this.getActions(new Set(f),p,e,r,s,n,i),x=n?S({},n.activities):{};try{for(var O=F(E),k=O.next();!k.done;k=O.next()){var C=k.value;try{for(var b=(d=void 0,F(C.actions)),_=b.next();!_.done;_=b.next()){var M=_.value;M.type===ht?x[M.activity.id||M.activity.type]=M:M.type===ft&&(x[M.activity.id||M.activity.type]=!1)}}catch(de){d={error:de}}finally{try{_&&!_.done&&(a=b.return)&&a.call(b)}finally{if(d)throw d.error}}}}catch(de){o={error:de}}finally{try{k&&!k.done&&(h=O.return)&&h.call(O)}finally{if(o)throw o.error}}var j=V(nt(this,n,r,s,E,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),Z=j[0],D=j[1],$=V(rs(Z,nn),2),ne=$[0],W=$[1],Pe=Z.filter(function(de){var re;return de.type===ht&&((re=de.activity)===null||re===void 0?void 0:re.type)===mt}),Ce=Pe.reduce(function(de,re){return de[re.activity.id]=xs(re.activity,u.machine,D,s),de},n?S({},n.children):{}),m=new pe({value:v||n.value,context:D,_event:s,_sessionid:n?n._sessionid:null,historyValue:v?T?is(T,v):void 0:n?n.historyValue:void 0,history:!v||e.source?n:void 0,actions:v?W:[],activities:v?x:n?n.activities:{},events:[],configuration:f,transitions:e.transitions,children:Ce,done:p,tags:wr(f),machine:this}),w=r!==D;m.changed=s.name===yt||w;var N=m.history;N&&delete N.history;var z=!p&&(this._transient||c.some(function(de){return de._transient}));if(!l&&(!z||s.name===Be))return m;var H=m;if(!p)for(z&&(H=this.resolveRaisedTransition(H,{type:zn},s,i));ne.length;){var K=ne.shift();H=this.resolveRaisedTransition(H,K._event,s,i)}var qe=H.changed||(N?!!H.actions.length||w||typeof N.value!=typeof H.value||!xr(H.value,N.value):void 0);return H.changed=qe,H.history=N,H},t.prototype.getStateNode=function(e){if(He(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var n=this.states[e];if(!n)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return n},t.prototype.getStateNodeById=function(e){var n=He(e)?e.slice(ln.length):e;if(n===this.id)return this;var r=this.machine.idMap[n];if(!r)throw new Error("Child state node '#".concat(n,"' does not exist on machine '").concat(this.id,"'"));return r},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&He(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var n=tn(e,this.delimiter).slice(),r=this;n.length;){var i=n.shift();if(!i.length)break;r=r.getStateNode(i)}return r},t.prototype.resolve=function(e){var n,r=this;if(!e)return this.initialStateValue||Ge;switch(this.type){case"parallel":return Xe(this.initialStateValue,function(s,o){return s?r.getStateNode(o).resolve(e[o]||s):Ge});case"compound":if(G(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(n={},n[e]=i.initialStateValue,n):e}return Object.keys(e).length?Xe(e,function(s,o){return s?r.getStateNode(o).resolve(s):Ge}):this.initialStateValue||{};default:return e||Ge}},t.prototype.getResolvedPath=function(e){if(He(e)){var n=this.machine.idMap[e.slice(ln.length)];if(!n)throw new Error("Unable to find state node '".concat(e,"'"));return n.path}return tn(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var n;if(this.type==="parallel")n=er(this.states,function(r){return r.initialStateValue||Ge},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));n=It(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else n={};return this.__cache.initialStateValue=n,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,n){this._init();var r=this.getStateNodes(e);return this.resolveTransition({configuration:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,n!=null?n:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var n=this.config;G(n.target)?e=He(n.target)?Et(this.machine.getStateNodeById(n.target).path.slice(this.path.length-1)):n.target:e=n.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,n,r){return r===void 0&&(r=!0),r?e.type==="history"?e.resolveHistory(n):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(It(this))return[this];if(this.type==="compound"&&!this.initial)return Q||ie(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var n=Tt(this.initialStateValue);return X(n.map(function(r){return e.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var n=V(e),r=n[0],i=n.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var s=this.getStateNode(r);if(s.type==="history")return s.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(Object.keys(this.states).length)return{current:e||this.initialStateValue,states:er(this.states,function(n,r){if(!e)return n.historyValue();var i=G(e)?void 0:e[r];return n.historyValue(i||n.initialStateValue)},function(n){return!n.history})}},t.prototype.resolveHistory=function(e){var n=this;if(this.type!=="history")return[this];var r=this.parent;if(!e){var i=this.target;return i?X(Tt(i).map(function(o){return r.getFromRelativePath(o)})):r.initialStateNodes}var s=es(r.path,"states")(e).current;return G(s)?[r.getStateNode(s)]:X(Tt(s).map(function(o){return n.history==="deep"?r.getFromRelativePath(o):[r.states[o[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,n=X(Object.keys(this.states).map(function(r){return e.states[r].stateIds}));return[this.id].concat(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,n,r,i;if(this.__cache.events)return this.__cache.events;var s=this.states,o=new Set(this.ownEvents);if(s)try{for(var h=F(Object.keys(s)),d=h.next();!d.done;d=h.next()){var a=d.value,u=s[a];if(u.states)try{for(var c=(r=void 0,F(u.events)),l=c.next();!l.done;l=c.next()){var f=l.value;o.add("".concat(f))}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(n){return!(!n.target&&!n.actions.length&&n.internal)}).map(function(n){return n.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var n=this;if(e!==void 0)return e.map(function(r){if(!G(r))return r;var i=r[0]===n.delimiter;if(i&&!n.parent)return n.getStateNodeByPath(r.slice(1));var s=i?n.key+r:r;if(n.parent)try{var o=n.parent.getStateNodeByPath(s);return o}catch(h){throw new Error("Invalid transition definition for state node '".concat(n.id,`':
`).concat(h.message))}else return n.getStateNodeByPath(s)})},t.prototype.formatTransition=function(e){var n=this,r=cs(e.target),i="internal"in e?e.internal:r?r.some(function(d){return G(d)&&d[0]===n.delimiter}):!0,s=this.machine.options.guards,o=this.resolveTarget(r),h=S(S({},e),{actions:we(fe(e.actions)),cond:sr(e.cond,s),target:o,source:this,internal:i,eventType:e.event,toJSON:function(){return S(S({},h),{target:h.target?h.target.map(function(d){return"#".concat(d.id)}):void 0,source:"#".concat(n.id)})}});return h},t.prototype.formatTransitions=function(){var e,n,r=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,o=at,h=s[o],d=h===void 0?[]:h,a=Jt(s,[typeof o=="symbol"?o:o+""]);i=X(Object.keys(a).map(function(x){!Q&&x===Be&&ie(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(r.id,'".'));var O=Me(x,a[x]);return Q||Gs(r,x,O),O}).concat(Me(at,d)))}var u=this.config.always?Me("",this.config.always):[],c=this.config.onDone?Me(String(et(this.id)),this.config.onDone):[];Q||ie(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var l=X(this.invoke.map(function(x){var O=[];return x.onDone&&O.push.apply(O,q([],V(Me(String(tt(x.id)),x.onDone)),!1)),x.onError&&O.push.apply(O,q([],V(Me(String(Fe(x.id)),x.onError)),!1)),O})),f=this.after,p=X(q(q(q(q([],V(c),!1),V(l),!1),V(i),!1),V(u),!1).map(function(x){return fe(x).map(function(O){return r.formatTransition(O)})}));try{for(var v=F(f),T=v.next();!T.done;T=v.next()){var E=T.value;p.push(E)}}catch(x){e={error:x}}finally{try{T&&!T.done&&(n=v.return)&&n.call(v)}finally{if(e)throw e.error}}return p},t}(),kr=!1;function Ae(t,e){return!Q&&!("predictableActionArguments"in t)&&!kr&&(kr=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Hs(t,e)}var L=mr,se=_e;/*! js-cookie v3.0.5 | MIT */function Nt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}var Ks={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function dn(t,e){function n(i,s,o){if(typeof document!="undefined"){o=Nt({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var h="";for(var d in o)o[d]&&(h+="; "+d,o[d]!==!0&&(h+="="+o[d].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+h}}function r(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],o={},h=0;h<s.length;h++){var d=s[h].split("="),a=d.slice(1).join("=");try{var u=decodeURIComponent(d[0]);if(o[u]=t.read(a,u),i===u)break}catch{}}return i?o[i]:o}}return Object.create({set:n,get:r,remove:function(i,s){n(i,"",Nt({},s,{expires:-1}))},withAttributes:function(i){return dn(this.converter,Nt({},this.attributes,i))},withConverter:function(i){return dn(Nt({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var hn=dn(Ks,{path:"/"}),fn=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function pn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ys(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var vn={exports:{}};(function(t,e){(function(n){function r(i){var s=i&&i.Promise||n.Promise,o=i&&i.XMLHttpRequest||n.XMLHttpRequest;return function(){var h=Object.create(n,{fetch:{value:void 0,writable:!0}});return function(d,a){a(e)}(this,function(d){var a=typeof h!="undefined"&&h||typeof self!="undefined"&&self||typeof a!="undefined"&&a,u={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function c(m){return m&&DataView.prototype.isPrototypeOf(m)}if(u.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],f=ArrayBuffer.isView||function(m){return m&&l.indexOf(Object.prototype.toString.call(m))>-1};function p(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(m)||m==="")throw new TypeError("Invalid character in header field name");return m.toLowerCase()}function v(m){return typeof m!="string"&&(m=String(m)),m}function T(m){var w={next:function(){var N=m.shift();return{done:N===void 0,value:N}}};return u.iterable&&(w[Symbol.iterator]=function(){return w}),w}function E(m){this.map={},m instanceof E?m.forEach(function(w,N){this.append(N,w)},this):Array.isArray(m)?m.forEach(function(w){this.append(w[0],w[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(w){this.append(w,m[w])},this)}E.prototype.append=function(m,w){m=p(m),w=v(w);var N=this.map[m];this.map[m]=N?N+", "+w:w},E.prototype.delete=function(m){delete this.map[p(m)]},E.prototype.get=function(m){return m=p(m),this.has(m)?this.map[m]:null},E.prototype.has=function(m){return this.map.hasOwnProperty(p(m))},E.prototype.set=function(m,w){this.map[p(m)]=v(w)},E.prototype.forEach=function(m,w){for(var N in this.map)this.map.hasOwnProperty(N)&&m.call(w,this.map[N],N,this)},E.prototype.keys=function(){var m=[];return this.forEach(function(w,N){m.push(N)}),T(m)},E.prototype.values=function(){var m=[];return this.forEach(function(w){m.push(w)}),T(m)},E.prototype.entries=function(){var m=[];return this.forEach(function(w,N){m.push([N,w])}),T(m)},u.iterable&&(E.prototype[Symbol.iterator]=E.prototype.entries);function x(m){if(m.bodyUsed)return s.reject(new TypeError("Already read"));m.bodyUsed=!0}function O(m){return new s(function(w,N){m.onload=function(){w(m.result)},m.onerror=function(){N(m.error)}})}function k(m){var w=new FileReader,N=O(w);return w.readAsArrayBuffer(m),N}function C(m){var w=new FileReader,N=O(w);return w.readAsText(m),N}function b(m){for(var w=new Uint8Array(m),N=new Array(w.length),z=0;z<w.length;z++)N[z]=String.fromCharCode(w[z]);return N.join("")}function _(m){if(m.slice)return m.slice(0);var w=new Uint8Array(m.byteLength);return w.set(new Uint8Array(m)),w.buffer}function M(){return this.bodyUsed=!1,this._initBody=function(m){this.bodyUsed=this.bodyUsed,this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:u.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:u.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():u.arrayBuffer&&u.blob&&c(m)?(this._bodyArrayBuffer=_(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||f(m))?this._bodyArrayBuffer=_(m):this._bodyText=m=Object.prototype.toString.call(m):this._bodyText="",this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var m=x(this);if(m)return m;if(this._bodyBlob)return s.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return s.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return s.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var m=x(this);return m||(ArrayBuffer.isView(this._bodyArrayBuffer)?s.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):s.resolve(this._bodyArrayBuffer))}else return this.blob().then(k)}),this.text=function(){var m=x(this);if(m)return m;if(this._bodyBlob)return C(this._bodyBlob);if(this._bodyArrayBuffer)return s.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return s.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then($)}),this.json=function(){return this.text().then(JSON.parse)},this}var j=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Z(m){var w=m.toUpperCase();return j.indexOf(w)>-1?w:m}function D(m,w){if(!(this instanceof D))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var N=w.body;if(m instanceof D){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,w.headers||(this.headers=new E(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!N&&m._bodyInit!=null&&(N=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new E(w.headers)),this.method=Z(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&N)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(N),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var z=/([?&])_=[^&]*/;if(z.test(this.url))this.url=this.url.replace(z,"$1_="+new Date().getTime());else{var H=/\?/;this.url+=(H.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}D.prototype.clone=function(){return new D(this,{body:this._bodyInit})};function $(m){var w=new FormData;return m.trim().split("&").forEach(function(N){if(N){var z=N.split("="),H=z.shift().replace(/\+/g," "),K=z.join("=").replace(/\+/g," ");w.append(decodeURIComponent(H),decodeURIComponent(K))}}),w}function ne(m){var w=new E,N=m.replace(/\r?\n[\t ]+/g," ");return N.split("\r").map(function(z){return z.indexOf(`
`)===0?z.substr(1,z.length):z}).forEach(function(z){var H=z.split(":"),K=H.shift().trim();if(K){var qe=H.join(":").trim();w.append(K,qe)}}),w}M.call(D.prototype);function W(m,w){if(!(this instanceof W))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in w?w.statusText:"",this.headers=new E(w.headers),this.url=w.url||"",this._initBody(m)}M.call(W.prototype),W.prototype.clone=function(){return new W(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new E(this.headers),url:this.url})},W.error=function(){var m=new W(null,{status:0,statusText:""});return m.type="error",m};var Pe=[301,302,303,307,308];W.redirect=function(m,w){if(Pe.indexOf(w)===-1)throw new RangeError("Invalid status code");return new W(null,{status:w,headers:{location:m}})},d.DOMException=a.DOMException;try{new d.DOMException}catch{d.DOMException=function(w,N){this.message=w,this.name=N;var z=Error(w);this.stack=z.stack},d.DOMException.prototype=Object.create(Error.prototype),d.DOMException.prototype.constructor=d.DOMException}function Ce(m,w){return new s(function(N,z){var H=new D(m,w);if(H.signal&&H.signal.aborted)return z(new d.DOMException("Aborted","AbortError"));var K=new o;function qe(){K.abort()}K.onload=function(){var re={status:K.status,statusText:K.statusText,headers:ne(K.getAllResponseHeaders()||"")};re.url="responseURL"in K?K.responseURL:re.headers.get("X-Request-URL");var zt="response"in K?K.response:K.responseText;setTimeout(function(){N(new W(zt,re))},0)},K.onerror=function(){setTimeout(function(){z(new TypeError("Network request failed"))},0)},K.ontimeout=function(){setTimeout(function(){z(new TypeError("Network request failed"))},0)},K.onabort=function(){setTimeout(function(){z(new d.DOMException("Aborted","AbortError"))},0)};function de(re){try{return re===""&&a.location.href?a.location.href:re}catch{return re}}K.open(H.method,de(H.url),!0),H.credentials==="include"?K.withCredentials=!0:H.credentials==="omit"&&(K.withCredentials=!1),"responseType"in K&&(u.blob?K.responseType="blob":u.arrayBuffer&&H.headers.get("Content-Type")&&H.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(K.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof E)?Object.getOwnPropertyNames(w.headers).forEach(function(re){K.setRequestHeader(re,v(w.headers[re]))}):H.headers.forEach(function(re,zt){K.setRequestHeader(zt,re)}),H.signal&&(H.signal.addEventListener("abort",qe),K.onreadystatechange=function(){K.readyState===4&&H.signal.removeEventListener("abort",qe)}),K.send(typeof H._bodyInit=="undefined"?null:H._bodyInit)})}Ce.polyfill=!0,a.fetch||(a.fetch=Ce,a.Headers=E,a.Request=D,a.Response=W),d.Headers=E,d.Request=D,d.Response=W,d.fetch=Ce,Object.defineProperty(d,"__esModule",{value:!0})}),{fetch:h.fetch,Headers:h.Headers,Request:h.Request,Response:h.Response,DOMException:h.DOMException}}()}t.exports=r})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:fn)})(vn,vn.exports);var $s=vn.exports;const mn=pn($s),Ke="nhostRefreshToken",Rt="nhostRefreshTokenId",Ye="nhostRefreshTokenExpiresAt",zs=3,qs=60,Ar=5,Ir=0,br=1,ge=10,Dt=20;let Re=class extends Error{constructor(e){super(e.message),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),e instanceof Error?(this.name=e.name,this.error={error:e.name,status:br,message:e.message}):(this.name=e.error,this.error=e)}};const Ee={status:ge,error:"invalid-email",message:"Email is incorrectly formatted"},Js={status:ge,error:"invalid-mfa-type",message:"MFA type is invalid"},Ws={status:ge,error:"invalid-mfa-code",message:"MFA code is invalid"},yn={status:ge,error:"invalid-password",message:"Password is incorrectly formatted"},_r={status:ge,error:"invalid-phone-number",message:"Phone number is incorrectly formatted"},Qs={status:ge,error:"invalid-mfa-ticket",message:"MFA ticket is invalid"},Xs={status:ge,error:"no-mfa-ticket",message:"No MFA ticket has been provided"},Zs={status:ge,error:"no-refresh-token",message:"No refresh token has been provided"},eo={status:Dt,error:"refresher-already-running",message:"The token refresher is already running. You must wait until is has finished before submitting a new token."},ue={status:Dt,error:"already-signed-in",message:"User is already signed in"},to={status:Dt,error:"unauthenticated-user",message:"User is not authenticated"},no={status:Dt,error:"unverified-user",message:"Email needs verification"},ro={status:ge,error:"invalid-refresh-token",message:"Invalid or expired refresh token"},io={status:br,error:"invalid-sign-in-method",message:"Invalid sign-in method"},gn={user:null,mfa:null,accessToken:{value:null,expiresAt:null,expiresInSeconds:15},refreshTimer:{startedAt:null,attempts:0,lastAttempt:null},refreshToken:{value:null},importTokenAttempts:0,errors:{}};function so(t){return new TextEncoder().encode(t)}function xe(t){const e=new Uint8Array(t);let n="";for(const r of e)n+=String.fromCharCode(r);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function En(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4,r=e.padEnd(e.length+n,"="),i=atob(r),s=new ArrayBuffer(i.length),o=new Uint8Array(s);for(let h=0;h<i.length;h++)o[h]=i.charCodeAt(h);return s}function Nr(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function Rr(t){const{id:e}=t;return{...t,id:En(e),transports:t.transports}}function Dr(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}class ce extends Error{constructor({message:e,code:n,cause:r,name:i}){super(e,{cause:r}),this.name=i!=null?i:r.name,this.code=n}}function oo({error:t,options:e}){var n,r;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ce({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)==null?void 0:n.requireResidentKey)===!0)return new ce({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(((r=i.authenticatorSelection)==null?void 0:r.userVerification)==="required")return new ce({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new ce({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new ce({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(s=>s.type==="public-key").length===0?new ce({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new ce({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(Dr(s)){if(i.rp.id!==s)return new ce({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ce({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ce({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new ce({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return t}class ao{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Pr=new ao,co=["cross-platform","platform"];function Cr(t){if(t&&!(co.indexOf(t)<0))return t}async function Lr(t){var e;if(!Nr())throw new Error("WebAuthn is not supported in this browser");const n={publicKey:{...t,challenge:En(t.challenge),user:{...t.user,id:so(t.user.id)},excludeCredentials:(e=t.excludeCredentials)==null?void 0:e.map(Rr)}};n.signal=Pr.createNewAbortSignal();let r;try{r=await navigator.credentials.create(n)}catch(l){throw oo({error:l,options:n})}if(!r)throw new Error("Registration was not completed");const{id:i,rawId:s,response:o,type:h}=r;let d;typeof o.getTransports=="function"&&(d=o.getTransports());let a;if(typeof o.getPublicKeyAlgorithm=="function")try{a=o.getPublicKeyAlgorithm()}catch(l){Tn("getPublicKeyAlgorithm()",l)}let u;if(typeof o.getPublicKey=="function")try{const l=o.getPublicKey();l!==null&&(u=xe(l))}catch(l){Tn("getPublicKey()",l)}let c;if(typeof o.getAuthenticatorData=="function")try{c=xe(o.getAuthenticatorData())}catch(l){Tn("getAuthenticatorData()",l)}return{id:i,rawId:xe(s),response:{attestationObject:xe(o.attestationObject),clientDataJSON:xe(o.clientDataJSON),transports:d,publicKeyAlgorithm:a,publicKey:u,authenticatorData:c},type:h,clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:Cr(r.authenticatorAttachment)}}function Tn(t,e){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${t}. You should report this error to them.
`,e)}function uo(t){return new TextDecoder("utf-8").decode(t)}function lo(){const t=window.PublicKeyCredential;return t.isConditionalMediationAvailable===void 0?new Promise(e=>e(!1)):t.isConditionalMediationAvailable()}function ho({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ce({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new ce({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(Dr(r)){if(n.rpId!==r)return new ce({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ce({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new ce({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return t}async function Sn(t,e=!1){var n,r;if(!Nr())throw new Error("WebAuthn is not supported in this browser");let i;((n=t.allowCredentials)==null?void 0:n.length)!==0&&(i=(r=t.allowCredentials)==null?void 0:r.map(Rr));const s={...t,challenge:En(t.challenge),allowCredentials:i},o={};if(e){if(!await lo())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');o.mediation="conditional",s.allowCredentials=[]}o.publicKey=s,o.signal=Pr.createNewAbortSignal();let h;try{h=await navigator.credentials.get(o)}catch(f){throw ho({error:f,options:o})}if(!h)throw new Error("Authentication was not completed");const{id:d,rawId:a,response:u,type:c}=h;let l;return u.userHandle&&(l=uo(u.userHandle)),{id:d,rawId:xe(a),response:{authenticatorData:xe(u.authenticatorData),clientDataJSON:xe(u.clientDataJSON),signature:xe(u.signature),userHandle:l},type:c,clientExtensionResults:h.getClientExtensionResults(),authenticatorAttachment:Cr(h.authenticatorAttachment)}}const Pt=typeof window!="undefined",Ct=new Map,fo=t=>{var e;return Pt&&typeof localStorage!="undefined"?localStorage.getItem(t):(e=Ct.get(t))!=null?e:null},po=(t,e)=>{Pt&&typeof localStorage!="undefined"?e?localStorage.setItem(t,e):localStorage.removeItem(t):e?Ct.set(t,e):Ct.has(t)&&Ct.delete(t)},vo=(t,e)=>{if(t==="localStorage"||t==="web")return fo;if(t==="cookie")return n=>{var r;return Pt&&(r=hn.get(n))!=null?r:null};if(!e)throw Error(`clientStorageType is set to '${t}' but no clientStorage has been given`);if(t==="react-native")return n=>{var r;return(r=e.getItem)==null?void 0:r.call(e,n)};if(t==="capacitor")return n=>{var r;return(r=e.get)==null?void 0:r.call(e,{key:n})};if(t==="expo-secure-storage")return n=>{var r;return(r=e.getItemAsync)==null?void 0:r.call(e,n)};if(t==="custom"){if(e.getItem&&e.removeItem)return e.getItem;if(e.getItemAsync)return e.getItemAsync;throw Error(`clientStorageType is set to 'custom' but clientStorage is missing either "getItem" and "removeItem" properties or "getItemAsync" property`)}throw Error(`Unknown storage type: ${t}`)},mo=(t,e)=>{if(t==="localStorage"||t==="web")return po;if(t==="cookie")return(n,r)=>{Pt&&(r?hn.set(n,r,{expires:30,sameSite:"lax",httpOnly:!1}):hn.remove(n))};if(!e)throw Error(`clientStorageType is set to '${t}' but no clienStorage has been given`);if(t==="react-native")return(n,r)=>{var i,s;return r?(i=e.setItem)==null?void 0:i.call(e,n,r):(s=e.removeItem)==null?void 0:s.call(e,n)};if(t==="capacitor")return(n,r)=>{var i,s;return r?(i=e.set)==null?void 0:i.call(e,{key:n,value:r}):(s=e.remove)==null?void 0:s.call(e,{key:n})};if(t==="expo-secure-storage")return async(n,r)=>{var i,s;return r?(i=e.setItemAsync)==null?void 0:i.call(e,n,r):(s=e.deleteItemAsync)==null?void 0:s.call(e,n)};if(t==="custom"){if(!e.removeItem)throw Error("clientStorageType is set to 'custom' but clientStorage is missing a removeItem property");if(e.setItem)return(n,r)=>{var i,s;return r?(i=e.setItem)==null?void 0:i.call(e,n,r):(s=e.removeItem)==null?void 0:s.call(e,n)};if(e.setItemAsync)return async(n,r)=>{var i,s;return r?(i=e.setItemAsync)==null?void 0:i.call(e,n,r):(s=e.removeItem)==null?void 0:s.call(e,n)};throw Error("clientStorageType is set to 'custom' but clientStorage is missing setItem or setItemAsync property")}throw Error(`Unknown storage type: ${t}`)},Lt=t=>!t||!t.accessToken.value||!t.accessToken.expiresAt||!t.user?null:{accessToken:t.accessToken.value,accessTokenExpiresIn:(t.accessToken.expiresAt.getTime()-Date.now())/1e3,refreshToken:t.refreshToken.value,user:t.user},ve=({accessToken:t,refreshToken:e,isError:n,user:r,error:i})=>n?{session:null,error:i}:r&&t?{session:{accessToken:t,accessTokenExpiresIn:0,refreshToken:e,user:r},error:null}:{session:null,error:null},Ur=()=>typeof window!="undefined"&&typeof window.location!="undefined";let Mr=globalThis.fetch;typeof EdgeRuntime!="string"&&(Mr=mn().fetch);const jr=async(t,e,{token:n,body:r,extraHeaders:i}={})=>{const s={"Content-Type":"application/json",Accept:"*/*"};n&&(s.Authorization=`Bearer ${n}`);const o={...s,...i},h={method:e,headers:o};r&&(h.body=JSON.stringify(r));try{const d=await Mr(t,h);if(!d.ok){const a=await d.json();return Promise.reject({error:a})}try{return{data:await d.json(),error:null}}catch{return console.warn(`Unexpected response: can't parse the response of the server at ${t}`),{data:"OK",error:null}}}catch{const d={message:"Network Error",status:Ir,error:"network"};return Promise.reject({error:d})}},he=async(t,e,n,r)=>jr(t,"POST",{token:n,body:e,extraHeaders:r}),yo=(t,e)=>jr(t,"GET",{token:e}),Ut=(t,e)=>{const n=e&&Object.entries(e).map(([r,i])=>{const s=Array.isArray(i)?i.join(","):typeof i=="object"?JSON.stringify(i):i;return`${r}=${encodeURIComponent(s)}`}).join("&");return n?`${t}?${n}`:t},le=(t,e)=>{if(!(e!=null&&e.redirectTo))return e;const{redirectTo:n,...r}=e;if(!t)return n.startsWith("/")?r:e;const i=new URL(t),s=Object.fromEntries(new URLSearchParams(i.search)),o=new URL(n.startsWith("/")?i.origin+n:n),h=new URLSearchParams(o.search);let d=Object.fromEntries(h);n.startsWith("/")&&(d={...s,...d});let a=i.pathname;return o.pathname.length>1&&(a+=o.pathname.slice(1)),{...r,redirectTo:Ut(o.origin+a,d)}};function Mt(t,e){var n;if(!e){if(typeof window=="undefined")return;e=((n=window.location)==null?void 0:n.href)||""}t=t.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)"),i=r.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function Fr(t){var e;if(typeof window=="undefined")return;const n=window==null?void 0:window.location;if(n&&n){const r=new URLSearchParams(n.search),i=new URLSearchParams((e=n.hash)==null?void 0:e.slice(1));r.delete(t),i.delete(t);let s=window.location.pathname;Array.from(r).length&&(s+=`?${r.toString()}`),Array.from(i).length&&(s+=`#${i.toString()}`),window.history.pushState({},"",s)}}const Te=t=>!!t&&typeof t=="string"&&!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),wn=t=>!!t&&typeof t=="string"&&t.length>=zs,Vr=t=>!!t&&typeof t=="string",go=t=>t&&typeof t=="string"&&t.match(/^mfaTotp:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i),Eo=({backendUrl:t,clientUrl:e,broadcastKey:n,clientStorageType:r="web",clientStorage:i,refreshIntervalTime:s,autoRefreshToken:o=!0,autoSignIn:h=!0})=>{const d=vo(r,i),a=mo(r,i),u=async(c,l,f,p)=>(await he(`${t}${c}`,l,f,p)).data;return Ae({schema:{context:{},events:{},services:{}},tsTypes:{},context:gn,predictableActionArguments:!0,id:"nhost",type:"parallel",states:{authentication:{initial:"starting",on:{SESSION_UPDATE:[{cond:"hasSession",actions:["saveSession","resetTimer","reportTokenChanged"],target:".signedIn"}]},states:{starting:{tags:["loading"],always:{cond:"isSignedIn",target:"signedIn"},invoke:{id:"importRefreshToken",src:"importRefreshToken",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"signedIn"},{target:"signedOut"}],onError:[{cond:"shouldRetryImportToken",actions:"incrementTokenImportAttempts",target:"retryTokenImport"},{actions:["saveAuthenticationError"],target:"signedOut"}]}},retryTokenImport:{tags:["loading"],after:{RETRY_IMPORT_TOKEN_DELAY:"starting"}},signedOut:{initial:"noErrors",entry:"reportSignedOut",states:{noErrors:{},success:{},needsSmsOtp:{},needsMfa:{},failed:{},signingOut:{entry:["clearContextExceptTokens"],exit:["destroyAccessToken","destroyRefreshToken","reportTokenChanged"],invoke:{src:"signout",id:"signingOut",onDone:{target:"success"},onError:{target:"failed",actions:["saveAuthenticationError"]}}}},on:{SIGNIN_PASSWORD:"authenticating.password",SIGNIN_ANONYMOUS:"authenticating.anonymous",SIGNIN_SECURITY_KEY_EMAIL:"authenticating.securityKeyEmail",SIGNIN_SECURITY_KEY:"authenticating.securityKey",SIGNIN_MFA_TOTP:"authenticating.mfa.totp",SIGNIN_PAT:"authenticating.pat",SIGNIN_ID_TOKEN:"authenticating.idToken"}},authenticating:{entry:"resetErrors",states:{password:{invoke:{src:"signInPassword",id:"authenticateUserWithPassword",onDone:[{cond:"hasMfaTicket",actions:["saveMfaTicket"],target:"#nhost.authentication.signedOut.needsMfa"},{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"}],onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}},pat:{invoke:{src:"signInPAT",id:"authenticateWithPAT",onDone:{actions:["savePATSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},idToken:{invoke:{src:"signInIdToken",id:"authenticateWithIdToken",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},anonymous:{invoke:{src:"signInAnonymous",id:"authenticateAnonymously",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},mfa:{states:{totp:{invoke:{src:"signInMfaTotp",id:"signInMfaTotp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:["saveAuthenticationError"],target:"#nhost.authentication.signedOut.failed"}}}}},securityKeyEmail:{invoke:{src:"signInSecurityKeyEmail",id:"authenticateUserWithSecurityKey",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}},securityKey:{invoke:{src:"signInSecurityKey",id:"authenticateUserWithSecurityKey",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}}}},signedIn:{type:"parallel",entry:["reportSignedIn","cleanUrl","broadcastToken","resetErrors"],on:{SIGNOUT:"signedOut.signingOut"},states:{refreshTimer:{id:"timer",initial:"idle",states:{disabled:{type:"final"},stopped:{always:{cond:"noToken",target:"idle"}},idle:{always:[{cond:"isAutoRefreshDisabled",target:"disabled"},{cond:"isRefreshTokenPAT",target:"disabled"},{cond:"hasRefreshToken",target:"running"}]},running:{initial:"pending",entry:"resetTimer",states:{pending:{after:{1e3:{internal:!1,target:"pending"}},always:{cond:"refreshTimerShouldRefresh",target:"refreshing"}},refreshing:{invoke:{src:"refreshToken",id:"refreshToken",onDone:{actions:["saveSession","resetTimer","reportTokenChanged"],target:"pending"},onError:[{cond:"isUnauthorizedError",target:"#nhost.authentication.signedOut"},{actions:"saveRefreshAttempt",target:"pending"}]}}}}}}}}}},token:{initial:"idle",states:{idle:{on:{TRY_TOKEN:"running"},initial:"noErrors",states:{noErrors:{},error:{}}},running:{invoke:{src:"refreshToken",id:"authenticateWithToken",onDone:{actions:["saveSession","reportTokenChanged"],target:["#nhost.authentication.signedIn","idle.noErrors"]},onError:[{cond:"isSignedIn",target:"idle.error"},{actions:"saveAuthenticationError",target:["#nhost.authentication.signedOut.failed","idle.error"]}]}}}},registration:{initial:"incomplete",on:{SIGNED_IN:[{cond:"isAnonymous",target:".incomplete"},".complete"]},states:{incomplete:{on:{SIGNUP_EMAIL_PASSWORD:"emailPassword",SIGNUP_SECURITY_KEY:"securityKey",PASSWORDLESS_EMAIL:"passwordlessEmail",PASSWORDLESS_SMS:"passwordlessSms",PASSWORDLESS_SMS_OTP:"passwordlessSmsOtp",SIGNIN_EMAIL_OTP:"signInEmailOTP",VERIFY_EMAIL_OTP:"verifyEmailOTP"},initial:"noErrors",states:{noErrors:{},needsEmailVerification:{},needsOtp:{},failed:{}}},emailPassword:{entry:["resetErrors"],invoke:{src:"signUpEmailPassword",id:"signUpEmailPassword",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},securityKey:{entry:["resetErrors"],invoke:{src:"signUpSecurityKey",id:"signUpSecurityKey",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},passwordlessEmail:{entry:["resetErrors"],invoke:{src:"passwordlessEmail",id:"passwordlessEmail",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSms:{entry:["resetErrors"],invoke:{src:"passwordlessSms",id:"passwordlessSms",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsOtp"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSmsOtp:{entry:["resetErrors"],invoke:{src:"passwordlessSmsOtp",id:"passwordlessSmsOtp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},signInEmailOTP:{entry:["resetErrors"],invoke:{src:"signInEmailOTP",id:"signInEmailOTP",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsOtp"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},verifyEmailOTP:{entry:["resetErrors"],invoke:{src:"verifyEmailOTP",id:"verifyEmailOTP",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},complete:{on:{SIGNED_OUT:"incomplete"}}}}}},{actions:{reportSignedIn:se("SIGNED_IN"),reportSignedOut:se("SIGNED_OUT"),reportTokenChanged:se("TOKEN_CHANGED"),incrementTokenImportAttempts:L({importTokenAttempts:({importTokenAttempts:c})=>c+1}),clearContext:L(()=>(a(Ye,null),a(Ke,null),a(Rt,null),{...gn})),clearContextExceptTokens:L(({accessToken:c,refreshToken:l})=>({...gn,accessToken:c,refreshToken:l})),saveSession:L({user:(c,{data:l})=>{var f;return((f=l==null?void 0:l.session)==null?void 0:f.user)||null},accessToken:(c,{data:l})=>{if(l.session){const{accessTokenExpiresIn:f,accessToken:p}=l.session,v=new Date(Date.now()+f*1e3);return a(Ye,v.toISOString()),{value:p,expiresAt:v,expiresInSeconds:f}}return a(Ye,null),{value:null,expiresAt:null,expiresInSeconds:null}},refreshToken:(c,{data:l})=>{var f,p;const v=((f=l.session)==null?void 0:f.refreshToken)||null,T=((p=l.session)==null?void 0:p.refreshTokenId)||null;return v&&a(Ke,v),T&&a(Rt,T),{value:v}}}),savePATSession:L({user:(c,{data:l})=>{var f;return((f=l==null?void 0:l.session)==null?void 0:f.user)||null},accessToken:(c,{data:l})=>{if(l.session){const{accessTokenExpiresIn:f,accessToken:p}=l.session,v=new Date(Date.now()+f*1e3);return a(Ye,v.toISOString()),{value:p,expiresAt:v,expiresInSeconds:f}}return a(Ye,null),{value:null,expiresAt:null,expiresInSeconds:null}},refreshToken:(c,{data:l})=>{var f,p;const v=((f=l.session)==null?void 0:f.refreshToken)||null,T=((p=l.session)==null?void 0:p.refreshTokenId)||null;return v&&a(Ke,v),T&&a(Rt,T),{value:v,isPAT:!0}}}),saveMfaTicket:L({mfa:(c,l)=>{var f;return(f=l.data)==null?void 0:f.mfa}}),resetTimer:L({refreshTimer:c=>({startedAt:new Date,attempts:0,lastAttempt:null})}),saveRefreshAttempt:L({refreshTimer:(c,l)=>({startedAt:c.refreshTimer.startedAt,attempts:c.refreshTimer.attempts+1,lastAttempt:new Date})}),saveAuthenticationError:L({errors:({errors:c},{data:{error:l}})=>({...c,authentication:l})}),resetErrors:L({errors:c=>({}),importTokenAttempts:c=>0}),saveRegistrationError:L({errors:({errors:c},{data:{error:l}})=>({...c,registration:l})}),destroyRefreshToken:L({refreshToken:c=>(a(Ke,null),a(Rt,null),{value:null})}),destroyAccessToken:L({accessToken:c=>(a(Ye,null),{value:null,expiresAt:null,expiresInSeconds:null})}),cleanUrl:()=>{h&&Mt("refreshToken")&&(Fr("refreshToken"),Fr("type"))},broadcastToken:c=>{if(h&&n)try{new BroadcastChannel(n).postMessage({type:"broadcast_token",payload:{token:c.refreshToken.value}})}catch{}}},guards:{isAnonymous:(c,l)=>{var f;return!!((f=c.user)!=null&&f.isAnonymous)},isSignedIn:c=>!!c.user&&!!c.accessToken.value,noToken:c=>!c.refreshToken.value,isRefreshTokenPAT:c=>{var l;return!!((l=c.refreshToken)!=null&&l.isPAT)},hasRefreshToken:c=>!!c.refreshToken.value,isAutoRefreshDisabled:()=>!o,refreshTimerShouldRefresh:c=>{const{expiresAt:l}=c.accessToken;if(!l)return!1;if(c.refreshTimer.lastAttempt)return c.refreshTimer.attempts>Ar?!1:Date.now()-c.refreshTimer.lastAttempt.getTime()>Math.pow(2,c.refreshTimer.attempts-1)*5e3;if(l.getTime()<Date.now()||s&&Date.now()-c.refreshTimer.startedAt.getTime()>s*1e3)return!0;const f=c.accessToken.expiresInSeconds;return f?l.getTime()-Date.now()-1e3*Math.min(qs,f*.5)<=0:!1},shouldRetryImportToken:(c,l)=>c.importTokenAttempts<Ar&&(l.data.error.status===Ir||l.data.error.status>=500),unverified:(c,{data:{error:l}})=>l.status===401&&(l.message==="Email is not verified"||l.error==="unverified-user"),hasSession:(c,l)=>{var f;return!!((f=l.data)!=null&&f.session)},hasMfaTicket:(c,l)=>{var f;return!!((f=l.data)!=null&&f.mfa)},isUnauthorizedError:(c,{data:{error:l}})=>l.status===401},services:{signInPassword:(c,{email:l,password:f})=>Te(l)?wn(f)?u("/signin/email-password",{email:l,password:f}):Promise.reject({error:yn}):Promise.reject({error:Ee}),signInPAT:(c,{pat:l})=>u("/signin/pat",{personalAccessToken:l}),signInIdToken:(c,{provider:l,idToken:f,nonce:p})=>u("/signin/idtoken",{provider:l,idToken:f,...p&&{nonce:p}}),passwordlessSms:(c,{phoneNumber:l,options:f})=>{var p;return Vr(l)?(p=c.user)!=null&&p.isAnonymous?(console.warn("Deanonymisation from a phone number is not yet implemented in hasura-auth"),u("/user/deanonymize",{signInMethod:"passwordless",connection:"sms",phoneNumber:l,options:le(e,f)},c.accessToken.value)):u("/signin/passwordless/sms",{phoneNumber:l,options:le(e,f)}):Promise.reject({error:_r})},passwordlessSmsOtp:(c,{phoneNumber:l,otp:f})=>Vr(l)?u("/signin/passwordless/sms/otp",{phoneNumber:l,otp:f}):Promise.reject({error:_r}),signInEmailOTP:(c,{email:l,options:f})=>Te(l)?u("/signin/otp/email",{email:l,options:le(e,f)}):Promise.reject({error:Ee}),verifyEmailOTP:(c,{email:l,otp:f})=>Te(l)?u("/signin/otp/email/verify",{email:l,otp:f}):Promise.reject({error:Ee}),passwordlessEmail:(c,{email:l,options:f})=>{var p;return Te(l)?(p=c.user)!=null&&p.isAnonymous?u("/user/deanonymize",{signInMethod:"passwordless",connection:"email",email:l,options:le(e,f)},c.accessToken.value):u("/signin/passwordless/email",{email:l,options:le(e,f)}):Promise.reject({error:Ee})},signInAnonymous:c=>u("/signin/anonymous"),signInMfaTotp:(c,l)=>{var f;const p=l.ticket||((f=c.mfa)==null?void 0:f.ticket);return p?go(p)?u("/signin/mfa/totp",{ticket:p,otp:l.otp}):Promise.reject({error:Qs}):Promise.reject({error:Xs})},signInSecurityKeyEmail:async(c,{email:l})=>{if(!Te(l))throw new Re(Ee);const f=await u("/signin/webauthn",{email:l});let p;try{p=await Sn(f)}catch(v){throw new Re(v)}return u("/signin/webauthn/verify",{email:l,credential:p})},refreshToken:async(c,l)=>{const f=l.type==="TRY_TOKEN"?l.token:c.refreshToken.value;return{session:await u("/token",{refreshToken:f}),error:null}},signInSecurityKey:async()=>{try{const c=await u("/signin/webauthn",{});let l;try{l=await Sn(c)}catch(f){throw new Re(f)}return u("/signin/webauthn/verify",{credential:l})}catch(c){throw new Re(c)}},signout:async(c,l)=>{const f=await u("/signout",{refreshToken:c.refreshToken.value,all:!!l.all},l.all?c.accessToken.value:void 0);if(n)try{new BroadcastChannel(n).postMessage({type:"signout"})}catch{}return f},signUpEmailPassword:async(c,{email:l,password:f,options:p,requestOptions:v})=>{var T;return Te(l)?wn(f)?(T=c.user)!=null&&T.isAnonymous?u("/user/deanonymize",{signInMethod:"email-password",email:l,password:f,options:le(e,p)},c.accessToken.value,v==null?void 0:v.headers):u("/signup/email-password",{email:l,password:f,options:le(e,p)},null,v==null?void 0:v.headers):Promise.reject({error:yn}):Promise.reject({error:Ee})},signUpSecurityKey:async(c,{email:l,options:f})=>{if(!Te(l))return Promise.reject({error:Ee});const p=f==null?void 0:f.nickname;p&&delete f.nickname;const v=await u("/signup/webauthn",{email:l,options:f});let T;try{T=await Lr(v)}catch(E){throw new Re(E)}return u("/signup/webauthn/verify",{credential:T,options:{redirectTo:f==null?void 0:f.redirectTo,nickname:p}})},importRefreshToken:async c=>{if(c.user&&c.refreshToken.value&&c.accessToken.value&&c.accessToken.expiresAt)return{session:{accessToken:c.accessToken.value,accessTokenExpiresIn:c.accessToken.expiresAt.getTime()-Date.now(),refreshToken:c.refreshToken.value,user:c.user},error:null};let l=null;if(h){const p=Mt("refreshToken")||null;if(p)try{return{session:await u("/token",{refreshToken:p}),error:null}}catch(v){l=v.error}else{const v=Mt("error"),T=Mt("errorDescription");if(v&&T!=="social user already exists")return Promise.reject({session:null,error:{status:ge,error:v,message:T||v}})}}const f=await d(Ke);if(f)try{return{session:await u("/token",{refreshToken:f}),error:null}}catch(p){l=p.error}return l?Promise.reject({error:l,session:null}):{error:null,session:null}}},delays:{RETRY_IMPORT_TOKEN_DELAY:({importTokenAttempts:c})=>Math.pow(2,c-1)*5e3}})},Br=({backendUrl:t,clientUrl:e,interpreter:n})=>Ae({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changeEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:L({error:r=>Ee}),saveRequestError:L({error:(r,{data:{error:i}})=>i}),reportError:se(r=>({type:"ERROR",error:r.error})),reportSuccess:se("SUCCESS")},guards:{invalidEmail:(r,{email:i})=>!Te(i)},services:{requestChange:async(r,{email:i,options:s})=>(await he(`${t}/user/email/change`,{newEmail:i,options:le(e,s)},n==null?void 0:n.getSnapshot().context.accessToken.value)).data}}),Gr=({backendUrl:t,interpreter:e})=>Ae({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidPassword",actions:"saveInvalidPasswordError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidPasswordError:L({error:n=>yn}),saveRequestError:L({error:(n,{data:{error:r}})=>r}),reportError:se(n=>({type:"ERROR",error:n.error})),reportSuccess:se("SUCCESS")},guards:{invalidPassword:(n,{password:r})=>!wn(r)},services:{requestChange:(n,{password:r,ticket:i})=>he(`${t}/user/password`,{newPassword:r,ticket:i},e==null?void 0:e.getSnapshot().context.accessToken.value)}}),To=({backendUrl:t,interpreter:e})=>Ae({schema:{context:{},events:{}},tsTypes:{},predictableActionArguments:!0,id:"enableMfa",initial:"idle",context:{error:null,imageUrl:null,secret:null},states:{idle:{initial:"initial",on:{GENERATE:"generating"},states:{initial:{},error:{}}},generating:{invoke:{src:"generate",id:"generate",onDone:{target:"generated",actions:["reportGeneratedSuccess","saveGeneration"]},onError:{actions:["saveError","reportGeneratedError"],target:"idle.error"}}},generated:{initial:"idle",states:{idle:{initial:"idle",on:{ACTIVATE:[{cond:"invalidMfaType",actions:"saveInvalidMfaTypeError",target:".error"},{cond:"invalidMfaCode",actions:"saveInvalidMfaCodeError",target:".error"},{target:"activating"}]},states:{idle:{},error:{}}},activating:{invoke:{src:"activate",id:"activate",onDone:{target:"activated",actions:"reportSuccess"},onError:{actions:["saveError","reportError"],target:"idle.error"}}},activated:{type:"final"}}}}},{actions:{saveInvalidMfaTypeError:L({error:n=>Js}),saveInvalidMfaCodeError:L({error:n=>Ws}),saveError:L({error:(n,{data:{error:r}})=>r}),saveGeneration:L({imageUrl:(n,{data:{imageUrl:r}})=>r,secret:(n,{data:{totpSecret:r}})=>r}),reportError:se((n,r)=>(console.log("REPORT",n,r),{type:"ERROR",error:n.error})),reportSuccess:se("SUCCESS"),reportGeneratedSuccess:se("GENERATED"),reportGeneratedError:se(n=>({type:"GENERATED_ERROR",error:n.error}))},guards:{invalidMfaCode:(n,{code:r})=>!r,invalidMfaType:(n,{activeMfaType:r})=>!r||r!=="totp"},services:{generate:async n=>{const{data:r}=await yo(`${t}/mfa/totp/generate`,e==null?void 0:e.getSnapshot().context.accessToken.value);return r},activate:(n,{code:r,activeMfaType:i})=>he(`${t}/user/mfa`,{code:r,activeMfaType:i},e==null?void 0:e.getSnapshot().context.accessToken.value)}}),Hr=({backendUrl:t,clientUrl:e})=>Ae({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:L({error:n=>Ee}),saveRequestError:L({error:(n,{data:{error:r}})=>r}),reportError:se(n=>({type:"ERROR",error:n.error})),reportSuccess:se("SUCCESS")},guards:{invalidEmail:(n,{email:r})=>!Te(r)},services:{requestChange:(n,{email:r,options:i})=>he(`${t}/user/password/reset`,{email:r,options:le(e,i)})}}),Kr=({backendUrl:t,clientUrl:e})=>Ae({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"sendVerificationEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"request",id:"request",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:L({error:n=>Ee}),saveRequestError:L({error:(n,{data:{error:r}})=>r}),reportError:se(n=>({type:"ERROR",error:n.error})),reportSuccess:se("SUCCESS")},guards:{invalidEmail:(n,{email:r})=>!Te(r)},services:{request:async(n,{email:r,options:i})=>(await he(`${t}/user/email/send-verification-email`,{email:r,options:le(e,i)})).data}});class So{constructor({clientStorageType:e="web",autoSignIn:n=!0,autoRefreshToken:r=!0,start:i=!0,backendUrl:s,clientUrl:o,broadcastKey:h,devTools:d,...a}){var u;if(this._started=!1,this._subscriptionsQueue=new Set,this._subscriptions=new Set,this.backendUrl=s,this.clientUrl=o,this._machine=Eo({...a,backendUrl:s,clientUrl:o,broadcastKey:h,clientStorageType:e,autoSignIn:n,autoRefreshToken:r}),i&&this.start({devTools:d}),typeof window!="undefined"&&h)try{this._channel=new BroadcastChannel(h),n&&((u=this._channel)==null||u.addEventListener("message",c=>{var l;const{type:f,payload:p}=c.data;if(f==="broadcast_token"){const v=(l=this.interpreter)==null?void 0:l.getSnapshot().context.refreshToken.value;this.interpreter&&p.token&&p.token!==v&&this.interpreter.send("TRY_TOKEN",{token:p.token})}})),this._channel.addEventListener("message",c=>{const{type:l}=c.data;l==="signout"&&this.interpreter&&this.interpreter.send("SIGNOUT")})}catch{}}start({devTools:e=!1,initialSession:n,interpreter:r}={}){var i,s;const o={...this.machine.context,accessToken:{...this.machine.context.accessToken},refreshToken:{...this.machine.context.refreshToken}};n&&(o.user=n.user,o.refreshToken.value=(i=n.refreshToken)!=null?i:null,o.accessToken.value=(s=n.accessToken)!=null?s:null,o.accessToken.expiresAt=new Date(Date.now()+n.accessTokenExpiresIn*1e3));const h=this.machine.withContext(o);this._interpreter||(this._interpreter=r||Ne(h,{devTools:e})),(!this._started||typeof window=="undefined")&&(this._interpreter.initialized&&(this._interpreter.stop(),this._subscriptions.forEach(d=>d())),this._interpreter.start(h.initialState),this._subscriptionsQueue.forEach(d=>d(this))),this._started=!0}get machine(){return this._machine}get interpreter(){return this._interpreter}get started(){return this._started}subscribe(e){if(this.started){const n=e(this);return this._subscriptions.add(n),n}else return this._subscriptionsQueue.add(e),()=>{console.log("onTokenChanged was added before the interpreter started. Cannot unsubscribe listener.")}}}const Yr=async({backendUrl:t,interpreter:e},n)=>{try{const{data:r}=await he(`${t}/user/webauthn/add`,{},e==null?void 0:e.getSnapshot().context.accessToken.value);let i;try{i=await Lr(r)}catch(o){throw new Re(o)}const{data:s}=await he(`${t}/user/webauthn/verify`,{credential:i,nickname:n},e==null?void 0:e.getSnapshot().context.accessToken.value);return{key:s,isError:!1,error:null,isSuccess:!0}}catch(r){const{error:i}=r;return{isError:!0,error:i,isSuccess:!1}}},$r=async(t,e,n)=>new Promise(r=>{t.send("REQUEST",{email:e,options:n}),t.onTransition(i=>{i.matches({idle:"error"})?r({error:i.context.error,isError:!0,needsEmailVerification:!1}):i.matches({idle:"success"})&&r({error:null,isError:!1,needsEmailVerification:!0})})}),zr=async(t,e,n)=>new Promise(r=>{t.send("REQUEST",{password:e,ticket:n}),t.onTransition(i=>{i.matches({idle:"error"})?r({error:i.context.error,isError:!0,isSuccess:!1}):i.matches({idle:"success"})&&r({error:null,isError:!1,isSuccess:!0})})}),wo=t=>new Promise(e=>{t.send("GENERATE"),t.onTransition(n=>{n.matches("generated")?e({error:null,isError:!1,isGenerated:!0,qrCodeDataUrl:n.context.imageUrl||""}):n.matches({idle:"error"})&&e({error:n.context.error||null,isError:!0,isGenerated:!1,qrCodeDataUrl:""})})}),xo=(t,e)=>new Promise(n=>{t.send("ACTIVATE",{activeMfaType:"totp",code:e}),t.onTransition(r=>{r.matches({generated:"activated"})?n({error:null,isActivated:!0,isError:!1}):r.matches({generated:{idle:"error"}})&&n({error:r.context.error,isActivated:!1,isError:!0})})}),qr=async(t,e,n)=>new Promise(r=>{t.send("REQUEST",{email:e,options:n}),t.onTransition(i=>{i.matches({idle:"error"})?r({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&r({error:null,isError:!1,isSent:!0})})}),Jr=(t,e,n)=>new Promise(r=>{t.send("REQUEST",{email:e,options:n}),t.onTransition(i=>{i.matches({idle:"error"})?r({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&r({error:null,isError:!1,isSent:!0})})}),Wr=t=>new Promise(e=>{const{changed:n}=t.send("SIGNIN_ANONYMOUS");n||e({isSuccess:!1,isError:!0,error:ue,user:null,accessToken:null,refreshToken:null}),t.onTransition(r=>{r.matches({authentication:"signedIn"})&&e({isSuccess:!0,isError:!1,error:null,user:r.context.user,accessToken:r.context.accessToken.value,refreshToken:r.context.refreshToken.value}),r.matches({authentication:{signedOut:"failed"}})&&e({isSuccess:!1,isError:!0,error:r.context.errors.authentication||null,user:null,accessToken:null,refreshToken:null})})}),Qr=(t,e,n)=>new Promise(r=>{const{changed:i,context:s}=t.send("SIGNIN_PASSWORD",{email:e,password:n});if(!i)return r({accessToken:s.accessToken.value,refreshToken:s.refreshToken.value,error:ue,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:s.user});t.onTransition(o=>{o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?r({accessToken:null,refreshToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,needsMfaOtp:!1,mfa:null,user:null}):o.matches({authentication:{signedOut:"needsMfa"}})?r({accessToken:null,refreshToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!0,mfa:o.context.mfa,user:null}):o.matches({authentication:{signedOut:"failed"}})?r({accessToken:null,refreshToken:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:null}):o.matches({authentication:"signedIn"})&&r({accessToken:o.context.accessToken.value,refreshToken:o.context.refreshToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:o.context.user})})}),xn=(t,e,n)=>new Promise(r=>{const{changed:i}=t.send("PASSWORDLESS_EMAIL",{email:e,options:n});if(!i)return r({error:ue,isError:!0,isSuccess:!1});t.onTransition(s=>{s.matches("registration.incomplete.failed")?r({error:s.context.errors.registration||null,isError:!0,isSuccess:!1}):s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})&&r({error:null,isError:!1,isSuccess:!0})})}),Xr=(t,e)=>new Promise(n=>{const{changed:r,context:i}=t.send({type:"SIGNIN_SECURITY_KEY_EMAIL",email:e});if(!r)return n({accessToken:i.accessToken.value,refreshToken:i.refreshToken.value,error:ue,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:i.user});t.onTransition(s=>{s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,refreshToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):s.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,refreshToken:null,error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):s.matches({authentication:"signedIn"})&&n({accessToken:s.context.accessToken.value,refreshToken:s.context.refreshToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:s.context.user})})}),Zr=(t,e)=>new Promise(async n=>{var r,i;const s=(r=t.interpreter)==null?void 0:r.getSnapshot(),o=s==null?void 0:s.context.accessToken.value,{data:h}=await he(`${t.backendUrl}/elevate/webauthn`,{email:e},o);let d;try{d=await Sn(h)}catch(a){throw new Re(a)}try{const{data:{session:a},error:u}=await he(`${t.backendUrl}/elevate/webauthn/verify`,{email:e,credential:d},o);a&&!u&&((i=t.interpreter)==null||i.send({type:"SESSION_UPDATE",data:{session:a}}),n({error:null,isError:!1,isSuccess:!0,elevated:!0}))}catch(a){const{error:u}=a;n({error:u,isError:!0,isSuccess:!1,elevated:!1})}}),ei=(t,e,n)=>new Promise(r=>{const{changed:i,context:s}=t.send("SIGNIN_MFA_TOTP",{otp:e,ticket:n});if(!i)return r({accessToken:s.accessToken.value,refreshToken:s.refreshToken.value,error:ue,isError:!0,isSuccess:!1,user:s.user});t.onTransition(o=>{o.matches({authentication:{signedOut:"failed"}})?r({accessToken:null,refreshToken:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null}):o.matches({authentication:"signedIn"})&&r({accessToken:o.context.accessToken.value,refreshToken:o.context.refreshToken.value,error:null,isError:!1,isSuccess:!0,user:o.context.user})})}),ti=(t,e)=>new Promise(n=>{const{changed:r}=t.send("SIGNIN_PAT",{pat:e});r||n({isSuccess:!1,isError:!0,error:ue,user:null,accessToken:null,refreshToken:null}),t.onTransition(i=>{if(i.matches({authentication:{signedOut:"failed"}}))return n({accessToken:null,refreshToken:null,user:null,error:i.context.errors.authentication||null,isError:!0,isSuccess:!1});if(i.matches({authentication:"signedIn"}))return n({accessToken:i.context.accessToken.value,refreshToken:i.context.refreshToken.value,user:i.context.user,error:null,isError:!1,isSuccess:!0})})}),On=(t,e,n)=>new Promise(r=>{const{changed:i}=t.send("PASSWORDLESS_SMS",{phoneNumber:e,options:n});if(!i)return r({error:ue,isError:!0,isSuccess:!1,needsOtp:!1});t.onTransition(s=>{s.matches("registration.incomplete.needsOtp")?r({error:null,isError:!1,isSuccess:!1,needsOtp:!0}):s.matches("registration.incomplete.failed")&&r({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsOtp:!1})})}),kn=(t,e,n)=>new Promise(r=>{const{changed:i}=t.send({type:"PASSWORDLESS_SMS_OTP",phoneNumber:e,otp:n});if(!i)return r({error:ue,isError:!0,isSuccess:!1,user:null,accessToken:null,refreshToken:null});t.onTransition(s=>{s.matches({authentication:"signedIn"})?r({error:null,isError:!1,isSuccess:!0,user:s.context.user,accessToken:s.context.accessToken.value,refreshToken:s.context.refreshToken.value}):s.matches({registration:{incomplete:"failed"}})&&r({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null,accessToken:null,refreshToken:null})})}),ni=async(t,e)=>new Promise(n=>{const{event:r}=t.send("SIGNOUT",{all:e});if(r.type!=="SIGNED_OUT")return n({isSuccess:!1,isError:!0,error:to});t.onTransition(i=>{i.matches({authentication:{signedOut:"success"}})?n({isSuccess:!0,isError:!1,error:null}):i.matches("authentication.signedOut.failed")&&n({isSuccess:!1,isError:!0,error:i.context.errors.signout||null})})}),An=(t,e,n,r,i)=>new Promise(s=>{const{changed:o,context:h}=t.send("SIGNUP_EMAIL_PASSWORD",{email:e,password:n,options:r,requestOptions:i});if(!o)return s({error:ue,accessToken:h.accessToken.value,refreshToken:h.refreshToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:h.user});t.onTransition(d=>{d.matches("registration.incomplete.failed")?s({accessToken:null,refreshToken:null,error:d.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):d.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?s({accessToken:null,refreshToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):d.matches({authentication:"signedIn",registration:"complete"})&&s({accessToken:d.context.accessToken.value,refreshToken:d.context.refreshToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:d.context.user})})}),ri=(t,e,n)=>new Promise(r=>{const{changed:i,context:s}=t.send("SIGNUP_SECURITY_KEY",{email:e,options:n});if(!i)return r({error:ue,accessToken:s.accessToken.value,refreshToken:s.refreshToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:s.user});t.onTransition(o=>{o.matches("registration.incomplete.failed")?r({accessToken:null,refreshToken:null,error:o.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?r({accessToken:null,refreshToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):o.matches({authentication:"signedIn",registration:"complete"})&&r({accessToken:o.context.accessToken.value,refreshToken:o.context.refreshToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:o.context.user})})}),ii=(t,e,n)=>new Promise(r=>{const{changed:i}=t.send("SIGNIN_EMAIL_OTP",{email:e,options:n});if(!i)return r({error:ue,isError:!0,isSuccess:!1,needsOtp:!1});t.onTransition(s=>{s.matches("registration.incomplete.needsOtp")?r({error:null,isError:!1,isSuccess:!0,needsOtp:!0}):s.matches("registration.incomplete.failed")&&r({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsOtp:!1})})}),si=(t,e,n)=>new Promise(r=>{const{changed:i}=t.send({type:"VERIFY_EMAIL_OTP",email:e,otp:n});if(!i)return r({error:ue,isError:!0,isSuccess:!1,user:null,accessToken:null,refreshToken:null});t.onTransition(s=>{s.matches({authentication:"signedIn"})?r({error:null,isError:!1,isSuccess:!0,user:s.context.user,accessToken:s.context.accessToken.value,refreshToken:s.context.refreshToken.value}):s.matches({registration:{incomplete:"failed"}})&&r({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null,accessToken:null,refreshToken:null})})}),oi=(t,{provider:e,idToken:n,nonce:r})=>new Promise(i=>{const{changed:s}=t.send("SIGNIN_ID_TOKEN",{provider:e,idToken:n,...r&&{nonce:r}});s||i({isSuccess:!1,isError:!0,error:ue,user:null,accessToken:null,refreshToken:null}),t.onTransition(o=>{if(o.matches({authentication:{signedOut:"failed"}}))return i({accessToken:null,refreshToken:null,user:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1});if(o.matches({authentication:"signedIn"}))return i({accessToken:o.context.accessToken.value,refreshToken:o.context.refreshToken.value,user:o.context.user,error:null,isError:!1,isSuccess:!0})})}),ai=async({backendUrl:t,interpreter:e},{provider:n,idToken:r,nonce:i})=>{try{return await he(`${t}/link/idtoken`,{provider:n,idToken:r,...i&&{nonce:i}},e==null?void 0:e.getSnapshot().context.accessToken.value),{isError:!1,error:null,isSuccess:!0}}catch(s){const{error:o}=s;return{isError:!0,error:o,isSuccess:!1}}},ci=t=>new Promise(e=>{const{changed:n,context:r}=t.send({type:"SIGNIN_SECURITY_KEY"});if(!n)return e({accessToken:r.accessToken.value,refreshToken:r.refreshToken.value,error:ue,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:r.user});t.onTransition(i=>{i.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?e({accessToken:null,refreshToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):i.matches({authentication:{signedOut:"failed"}})?e({accessToken:null,refreshToken:null,error:i.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):i.matches({authentication:"signedIn"})&&e({accessToken:i.context.accessToken.value,refreshToken:i.context.refreshToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:i.context.user})})}),Oo=async({backendUrl:t,interpreter:e},{expiresAt:n,metadata:r})=>{try{const{data:i}=await he(`${t}/pat`,{expiresAt:n.toISOString(),metadata:r},e==null?void 0:e.getSnapshot().context.accessToken.value);return{data:i?{id:i.id||null,personalAccessToken:i.personalAccessToken||null}:null,isError:!1,error:null,isSuccess:!0}}catch(i){const{error:s}=i;return{isError:!0,error:s,isSuccess:!1,data:null}}};class ko{constructor({url:e,broadcastKey:n,autoRefreshToken:r=!0,autoSignIn:i=!0,clientStorage:s,clientStorageType:o,refreshIntervalTime:h,start:d=!0}){var a;this.url=e,this._client=new So({backendUrl:e,clientUrl:typeof window!="undefined"&&((a=window.location)==null?void 0:a.origin)||"",broadcastKey:n,autoRefreshToken:r,autoSignIn:i,start:d,clientStorage:s,clientStorageType:o,refreshIntervalTime:h})}async signUp(e){const n=await this.waitUntilReady(),{email:r,options:i}=e;return"securityKey"in e?ve(await ri(n,r,i)):ve(await An(n,r,e.password,i))}async connectProvider(e){const n=(await this.waitUntilReady()).getSnapshot().context.accessToken.value,{provider:r,options:i}=e,s=Ut(`${this._client.backendUrl}/signin/provider/${r}`,le(this._client.clientUrl,{...i,connect:n}));return Ur()&&(window.location.href=s),{providerUrl:s}}async signInIdToken(e){const n=await this.waitUntilReady(),r=await oi(n,e);return{...ve(r),mfa:null}}async linkIdToken(e){return ai(this._client,e)}async signIn(e){const n=await this.waitUntilReady();if(!e){const r=await Wr(n);return{...ve(r),mfa:null}}if("provider"in e){const{provider:r,options:i}=e,s=Ut(`${this._client.backendUrl}/signin/provider/${r}`,le(this._client.clientUrl,i));return Ur()&&(window.location.href=s),{providerUrl:s,provider:r,session:null,mfa:null,error:null}}if("email"in e&&"password"in e){const r=await Qr(n,e.email,e.password);return r.needsEmailVerification?{session:null,mfa:null,error:no}:r.needsMfaOtp?{session:null,mfa:r.mfa,error:null}:{...ve(r),mfa:null}}if("email"in e&&"securityKey"in e){if(e.securityKey!==!0)throw Error("securityKey must be true");const r=await Xr(n,e.email);return{...ve(r),mfa:null}}if("email"in e){const{email:r,options:i}=e,{error:s}=await xn(n,r,i);return{session:null,mfa:null,error:s}}if("phoneNumber"in e&&"otp"in e){const r=await kn(n,e.phoneNumber,e.otp);return{...ve(r),mfa:null}}if("phoneNumber"in e){const{error:r}=await On(n,e.phoneNumber,e.options);return{error:r,mfa:null,session:null}}if("otp"in e){const r=await ei(n,e.otp,e.ticket);return{...ve(r),mfa:null}}return{error:io,mfa:null,session:null}}async signInPAT(e){const n=await this.waitUntilReady(),r=await ti(n,e);return ve(r)}async signInEmailOTP(e,n){const r=await this.waitUntilReady(),{error:i}=await ii(r,e,n);return{error:i,session:null,mfa:null}}async verifyEmailOTP(e,n){const r=await this.waitUntilReady(),i=await si(r,e,n);return{...ve(i),mfa:null}}async signInSecurityKey(){const e=await this.waitUntilReady(),n=await ci(e);return{...ve(n),mfa:null}}async signOut(e){const n=await this.waitUntilReady(),{error:r}=await ni(n,e==null?void 0:e.all);return{error:r}}async resetPassword({email:e,options:n}){const r=Ne(Hr(this._client)).start(),{error:i}=await qr(r,e,n);return{error:i}}async changePassword({newPassword:e,ticket:n}){const r=Ne(Gr(this._client)).start(),{error:i}=await zr(r,e,n);return{error:i}}async sendVerificationEmail({email:e,options:n}){const r=Ne(Kr(this._client)).start(),{error:i}=await Jr(r,e,n);return{error:i}}async changeEmail({newEmail:e,options:n}){const r=Ne(Br(this._client)).start(),{error:i}=await $r(r,e,n);return{error:i}}async deanonymize(e){const n=await this.waitUntilReady();if(e.signInMethod==="passwordless"){if(e.connection==="email"){const{error:r}=await xn(n,e.email,e.options);return{error:r}}if(e.connection==="sms"){const{error:r}=await On(n,e.phoneNumber,e.options);return{error:r}}}if(e.signInMethod==="email-password"){const{error:r}=await An(n,e.email,e.password,e.options);return{error:r}}throw Error("Unknown deanonymization method")}async addSecurityKey(e){const{error:n,key:r}=await Yr(this._client,e);return{error:n,key:r}}async elevateEmailSecurityKey(e){if(!e)throw Error("A user email is required");return{...await Zr(this._client,e),mfa:null}}async createPAT(e,n){return Oo(this._client,{expiresAt:e,metadata:n})}onTokenChanged(e){return this._client.subscribe(()=>{var n;const r=(n=this._client.interpreter)==null?void 0:n.onTransition(({event:i,context:s})=>{i.type==="TOKEN_CHANGED"&&e(Lt(s))});return()=>r==null?void 0:r.stop()})}onAuthStateChanged(e){return this._client.subscribe(()=>{var n;const r=(n=this._client.interpreter)==null?void 0:n.onTransition(({event:i,context:s})=>{(i.type==="SIGNED_IN"||i.type==="SIGNED_OUT")&&e(i.type,Lt(s))});return()=>r==null?void 0:r.stop()})}isAuthenticated(){var e;return!!((e=this._client.interpreter)!=null&&e.getSnapshot().matches({authentication:"signedIn"}))}async isAuthenticatedAsync(){return(await this.waitUntilReady()).getSnapshot().matches({authentication:"signedIn"})}getAuthenticationStatus(){var e;const n=((e=this.client.interpreter)==null?void 0:e.getSnapshot().context.importTokenAttempts)||0;return this.isReady()?{isAuthenticated:this.isAuthenticated(),isLoading:!1,connectionAttempts:n}:{isAuthenticated:!1,isLoading:!0,connectionAttempts:n}}getAccessToken(){var e,n;return(n=(e=this._client.interpreter)==null?void 0:e.getSnapshot().context.accessToken.value)!=null?n:void 0}getDecodedAccessToken(){const e=this.getAccessToken();return e?qt(e):null}getHasuraClaims(){var e;return((e=this.getDecodedAccessToken())==null?void 0:e["https://hasura.io/jwt/claims"])||null}getHasuraClaim(e){var n;return((n=this.getHasuraClaims())==null?void 0:n[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null}async refreshSession(e){try{const n=await this.waitUntilReady();return new Promise(r=>{const i=e||n.getSnapshot().context.refreshToken.value;if(!i)return r({session:null,error:Zs});const{changed:s}=n.send("TRY_TOKEN",{token:i});if(!s)return r({session:null,error:eo});n.onTransition(o=>{o.matches({token:{idle:"error"}})?r({session:null,error:ro}):o.event.type==="TOKEN_CHANGED"&&r({session:Lt(o.context),error:null})})})}catch(n){return{session:null,error:n.message}}}getSession(){var e,n;return Lt((n=(e=this._client.interpreter)==null?void 0:e.getSnapshot())==null?void 0:n.context)}async initWithSession({session:e}){this.client.start({initialSession:e}),await this.waitUntilReady()}getUser(){var e,n,r;return((r=(n=(e=this._client.interpreter)==null?void 0:e.getSnapshot())==null?void 0:n.context)==null?void 0:r.user)||null}waitUntilReady(){const e=this._client.interpreter;if(!e)throw Error("Auth interpreter not set");return e.getSnapshot().hasTag("loading")?new Promise((n,r)=>{let i=setTimeout(()=>r("The state machine is not yet ready after 15 seconds."),15e3);e.onTransition(s=>{if(!s.hasTag("loading"))return clearTimeout(i),n(e)})}):Promise.resolve(e)}isReady(){var e,n;return!((n=(e=this._client.interpreter)==null?void 0:e.getSnapshot())!=null&&n.hasTag("loading"))}get client(){return this._client}}var Ao=typeof self=="object"?self.FormData:window.FormData;const In=pn(Ao);let ui=globalThis.fetch;const bn=async(t,e,{accessToken:n,name:r,fileId:i,bucketId:s,adminSecret:o,onUploadProgress:h,headers:d={}}={})=>{var a;const u={...d};s&&e.append("bucket-id",s),o&&(u["x-hasura-admin-secret"]=o),n&&(u.Authorization=`Bearer ${n}`);const c=`${t}/files`;if(typeof XMLHttpRequest=="undefined")try{e instanceof In&&(ui=mn().fetch);const l=await ui(c,{method:"POST",headers:u,body:e}),f=await l.json();return l.ok?{fileMetadata:f,error:null}:{error:{status:l.status,message:((a=f==null?void 0:f.error)==null?void 0:a.message)||l.statusText,error:l.statusText},fileMetadata:null}}catch(l){return{error:{status:0,message:l.message,error:l.message},fileMetadata:null}}return new Promise(l=>{let f=new XMLHttpRequest;f.responseType="json",f.onload=()=>{var p,v,T,E,x,O,k,C;if(f.status<200||f.status>=300){const b={error:(x=(E=(v=(p=f.response)==null?void 0:p.error)==null?void 0:v.message)!=null?E:(T=f.response)==null?void 0:T.error)!=null?x:f.response,message:(C=(k=(O=f.response)==null?void 0:O.error)==null?void 0:k.message)!=null?C:f.response,status:f.status};return l({fileMetadata:null,error:b})}return l({fileMetadata:f.response,error:null})},f.onerror=()=>{const p={error:f.statusText,message:f.statusText,status:f.status};return l({fileMetadata:null,error:p})},h&&f.upload.addEventListener("progress",h,!1),f.open("POST",c,!0),Object.entries(u).forEach(([p,v])=>{f.setRequestHeader(p,v)}),f.send(e)})};function _n(t,e){if(!e||Object.keys(e).length===0)return t;const n=new URL(t),r=Object.entries(e).reduce((i,[s,o])=>({...i,[s.charAt(0)]:o}),{});return Object.entries(r).forEach(([i,s])=>{s&&n.searchParams.set(i,s)}),n.toString()}let ct;typeof ct=="undefined"&&(ct=mn().fetch);let Io=class{constructor({url:e}){this.headers={},this.url=e}async uploadFormData({formData:e,bucketId:n,headers:r}){const{error:i,fileMetadata:s}=await bn(this.url,e,{bucketId:n,headers:{...this.headers,...r},accessToken:this.accessToken,adminSecret:this.adminSecret});return i?{fileMetadata:null,error:i}:s&&!("processedFiles"in s)?{fileMetadata:{processedFiles:[s]},error:null}:{fileMetadata:s,error:null}}async uploadFile({file:e,bucketId:n,id:r,name:i,headers:s}){const o=typeof window=="undefined"?new In:new FormData;o.append("file[]",e),o.append("metadata[]",JSON.stringify({id:r,name:i}));const{error:h,fileMetadata:d}=await bn(this.url,o,{accessToken:this.accessToken,adminSecret:this.adminSecret,bucketId:n,fileId:r,name:i,headers:{...this.headers,...s}});return h?{fileMetadata:null,error:h}:d&&"processedFiles"in d?{fileMetadata:d.processedFiles[0],error:null}:{fileMetadata:d,error:null}}async downloadFile(e){try{const{fileId:n,headers:r,...i}=e,s=_n(`${this.url}/files/${n}`,i),o=await ct(s,{method:"GET",headers:{...this.generateAuthHeaders(),...this.headers,...r}});if(!o.ok)throw new Error(await o.text());return{file:await o.blob(),error:null}}catch(n){return{file:null,error:n}}}async getPresignedUrl(e){try{const{fileId:n,headers:r}=e,i=await ct(`${this.url}/files/${n}/presignedurl`,{method:"GET",headers:{...this.generateAuthHeaders(),...this.headers,...r}});if(!i.ok)throw new Error(await i.text());return{presignedUrl:await i.json(),error:null}}catch(n){return{presignedUrl:null,error:n}}}async delete(e){try{const{fileId:n,headers:r}=e,i=await ct(`${this.url}/files/${n}`,{method:"DELETE",headers:{...this.generateAuthHeaders(),...this.headers,...r}});if(!i.ok)throw new Error(await i.text());return{error:null}}catch(n){return{error:n}}}setAccessToken(e){return this.accessToken=e,this}setAdminSecret(e){return this.adminSecret=e,this}getHeaders(){return this.headers}setHeaders(e){return e?(this.headers={...this.headers,...e},this):this}unsetHeaders(){const e=this.headers["x-hasura-role"];return this.headers=e?{"x-hasura-role":e}:{},this}generateAuthHeaders(){if(!(!this.adminSecret&&!this.accessToken))return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:{Authorization:`Bearer ${this.accessToken}`}}};class bo{constructor({url:e,adminSecret:n}){this.url=e,this.api=new Io({url:e}),this.setAdminSecret(n)}async upload(e){return"file"in e?this.api.uploadFile(e):this.api.uploadFormData(e)}getPublicUrl(e){const{fileId:n,...r}=e;return _n(`${this.url}/files/${n}`,r)}async getPresignedUrl(e){const{fileId:n,headers:r,...i}=e,{presignedUrl:s,error:o}=await this.api.getPresignedUrl(e);if(o)return{presignedUrl:null,error:o};if(!s)return{presignedUrl:null,error:new Error("Invalid file id")};const h=_n(s.url,i);return{presignedUrl:{...s,url:h},error:null}}async download(e){const{file:n,error:r}=await this.api.downloadFile(e);return r?{file:null,error:r}:n?{file:n,error:null}:{file:null,error:new Error("File does not exist")}}async delete(e){const{error:n}=await this.api.delete(e);return n?{error:n}:{error:null}}setAccessToken(e){return this.api.setAccessToken(e),this}setAdminSecret(e){return this.api.setAdminSecret(e),this}getHeaders(){return this.api.getHeaders()}setHeaders(e){return this.api.setHeaders(e),this}unsetHeaders(){return this.api.unsetHeaders(),this}}let Nn;typeof Nn=="undefined"&&(Nn=In);const Rn={progress:null,loaded:0,error:null,bucketId:void 0,file:void 0,id:void 0},li=()=>Ae({predictableActionArguments:!0,schema:{context:{},events:{}},tsTypes:{},context:{...Rn},initial:"idle",on:{DESTROY:{actions:"sendDestroy",target:"stopped"}},states:{idle:{on:{ADD:{actions:"addFile"},UPLOAD:{cond:"hasFile",target:"uploading"}}},uploading:{entry:"resetProgress",on:{UPLOAD_PROGRESS:{actions:["incrementProgress","sendProgress"]},UPLOAD_DONE:"uploaded",UPLOAD_ERROR:"error",CANCEL:"idle"},invoke:{src:"uploadFile"}},uploaded:{entry:["setFileMetadata","sendDone"],on:{ADD:{actions:"addFile",target:"idle"},UPLOAD:{actions:"resetContext",target:"uploading"}}},error:{entry:["setError","sendError"],on:{ADD:{actions:"addFile",target:"idle"},UPLOAD:{actions:"resetContext",target:"uploading"}}},stopped:{type:"final"}}},{guards:{hasFile:(t,e)=>!!t.file||!!e.file},actions:{incrementProgress:L({loaded:(t,{loaded:e})=>e,progress:(t,{progress:e})=>e}),setFileMetadata:L({id:(t,{id:e})=>e,bucketId:(t,{bucketId:e})=>e,progress:t=>100}),setError:L({error:(t,{error:e})=>e}),sendProgress:()=>{},sendError:()=>{},sendDestroy:()=>{},sendDone:()=>{},resetProgress:L({progress:t=>null,loaded:t=>0}),resetContext:L(t=>Rn),addFile:L({file:(t,{file:e})=>e,bucketId:(t,{bucketId:e})=>e,id:(t,{id:e})=>e})},services:{uploadFile:(t,e)=>n=>{const r=e.file||t.file,i=new Nn;i.append("file[]",r);let s=0;return bn(e.url,i,{fileId:e.id||t.id,bucketId:e.bucketId||t.bucketId,accessToken:e.accessToken,adminSecret:e.adminSecret,name:e.name||r.name,onUploadProgress:o=>{const h=o.total?Math.round(o.loaded*r.size/o.total):0,d=h-s;s=h,n({type:"UPLOAD_PROGRESS",progress:o.total?Math.round(h*100/o.total):0,loaded:h,additions:d})}}).then(({fileMetadata:o,error:h})=>{if(h&&n({type:"UPLOAD_ERROR",error:h}),o&&!("processedFiles"in o)){const{id:d,bucketId:a}=o;n({type:"UPLOAD_DONE",id:d,bucketId:a})}if(o&&"processedFiles"in o){const{id:d,bucketId:a}=o.processedFiles[0];n({type:"UPLOAD_DONE",id:d,bucketId:a})}}),()=>{}}}}),{pure:Dn,sendParent:jt}=Ss,_o=()=>Ae({id:"files-list",schema:{context:{},events:{}},tsTypes:{},predictableActionArguments:!0,context:{progress:null,files:[],loaded:0,total:0},initial:"idle",on:{UPLOAD:{cond:"hasFileToDownload",actions:"addItem",target:"uploading"},ADD:{actions:"addItem"},REMOVE:{actions:"removeItem"}},states:{idle:{entry:["resetProgress","resetLoaded","resetTotal"],on:{CLEAR:{actions:"clearList",target:"idle"}}},uploading:{entry:["upload","startProgress","resetLoaded","resetTotal"],on:{UPLOAD_PROGRESS:{actions:["incrementProgress"]},UPLOAD_DONE:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],UPLOAD_ERROR:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],CANCEL:{actions:"cancel",target:"idle"}}},uploaded:{entry:"setUploaded",on:{CLEAR:{actions:"clearList",target:"idle"}}},error:{on:{CLEAR:{actions:"clearList",target:"idle"}}}}},{guards:{hasFileToDownload:(t,e)=>t.files.some(n=>n.getSnapshot().matches("idle"))||!!e.files,isAllUploaded:t=>t.files.every(e=>{var n;return(n=e.getSnapshot())==null?void 0:n.matches("uploaded")}),isAllUploadedOrError:t=>t.files.every(e=>{const n=e.getSnapshot();return(n==null?void 0:n.matches("error"))||(n==null?void 0:n.matches("uploaded"))})},actions:{incrementProgress:L((t,e)=>{const n=t.loaded+e.additions,r=Math.round(n*100/t.total);return{...t,loaded:n,progress:r}}),setUploaded:L({progress:t=>100,loaded:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>e.matches("uploaded")).reduce((e,n)=>{var r;return e+((r=n.context.file)==null?void 0:r.size)},0)}),resetTotal:L({total:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>!e.matches("uploaded")).reduce((e,n)=>{var r;return e+((r=n.context.file)==null?void 0:r.size)},0)}),resetLoaded:L({loaded:t=>0}),startProgress:L({progress:t=>0}),resetProgress:L({progress:t=>null}),addItem:L((t,{files:e,bucketId:n})=>{const r=e?Array.isArray(e)?e:"item"in e?Array.from(e):[e]:[],i=t.total+r.reduce((o,h)=>o+h.size,0),s=Math.round(t.loaded*100/i);return{files:[...t.files,...r.map(o=>Fs(li().withConfig({actions:{sendProgress:jt((h,{additions:d})=>({type:"UPLOAD_PROGRESS",additions:d})),sendDone:jt("UPLOAD_DONE"),sendError:jt("UPLOAD_ERROR"),sendDestroy:jt("REMOVE")}}).withContext({...Rn,file:o,bucketId:n}),{sync:!0}))],total:i,loaded:t.loaded,progress:s}}),removeItem:L({files:t=>t.files.filter(e=>{var n,r;const i=(n=e.getSnapshot())==null?void 0:n.matches("stopped");return i&&((r=e.stop)==null||r.call(e)),!i})}),clearList:Dn(t=>t.files.map(e=>se({type:"DESTROY"},{to:e.id}))),upload:Dn((t,e)=>t.files.map(n=>se(e,{to:n.id}))),cancel:Dn(t=>t.files.map(e=>se({type:"CANCEL"},{to:e.id})))}}),No=async(t,e)=>new Promise(n=>{e.send({type:"UPLOAD",...t}),e.subscribe(r=>{var i;r.matches("error")?n({error:r.context.error,isError:!0,isUploaded:!1}):r.matches("uploaded")&&n({error:null,isError:!1,isUploaded:!0,id:r.context.id,bucketId:r.context.id,name:(i=r.context.file)==null?void 0:i.name})})}),Ro=async(t,e)=>new Promise(n=>{e.send({type:"UPLOAD",...t,files:t.files}),e.onTransition(r=>{r.matches("error")?n({errors:r.context.files.filter(i=>{var s;return(s=i.getSnapshot())==null?void 0:s.context.error}),isError:!0,files:[]}):r.matches("uploaded")&&n({errors:[],isError:!1,files:r.context.files})})});function Do(t,e){return e=e||{},new Promise(function(n,r){var i=new XMLHttpRequest,s=[],o=[],h={},d=function(){return{ok:(i.status/100|0)==2,statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:d,headers:{keys:function(){return s},entries:function(){return o},get:function(u){return h[u.toLowerCase()]},has:function(u){return u.toLowerCase()in h}}}};for(var a in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(u,c,l){s.push(c=c.toLowerCase()),o.push([c,l]),h[c]=h[c]?h[c]+","+l:l}),n(d())},i.onerror=r,i.withCredentials=e.credentials=="include",e.headers)i.setRequestHeader(a,e.headers[a]);i.send(e.body||null)})}const di=Ys(Object.freeze(Object.defineProperty({__proto__:null,default:Do},Symbol.toStringTag,{value:"Module"})));var Po=self.fetch||(self.fetch=di.default||di);const hi=pn(Po);function Ft(t,e){if(!!!t)throw new Error(e)}function Co(t){return typeof t=="object"&&t!==null}function Lo(t,e){if(!!!t)throw new Error("Unexpected invariant triggered.")}const Uo=/\r\n|[\n\r]/g;function Pn(t,e){let n=0,r=1;for(const i of t.body.matchAll(Uo)){if(typeof i.index=="number"||Lo(!1),i.index>=e)break;n=i.index+i[0].length,r+=1}return{line:r,column:e+1-n}}function Mo(t){return fi(t.source,Pn(t.source,t.start))}function fi(t,e){const n=t.locationOffset.column-1,r="".padStart(n)+t.body,i=e.line-1,s=t.locationOffset.line-1,o=e.line+s,h=e.line===1?n:0,d=e.column+h,a=`${t.name}:${o}:${d}
`,u=r.split(/\r\n|[\n\r]/g),c=u[i];if(c.length>120){const l=Math.floor(d/80),f=d%80,p=[];for(let v=0;v<c.length;v+=80)p.push(c.slice(v,v+80));return a+pi([[`${o} |`,p[0]],...p.slice(1,l+1).map(v=>["|",v]),["|","^".padStart(f)],["|",p[l+1]]])}return a+pi([[`${o-1} |`,u[i-1]],[`${o} |`,c],["|","^".padStart(d)],[`${o+1} |`,u[i+1]]])}function pi(t){const e=t.filter(([r,i])=>i!==void 0),n=Math.max(...e.map(([r])=>r.length));return e.map(([r,i])=>r.padStart(n)+(i?" "+i:"")).join(`
`)}function jo(t){const e=t[0];return e==null||"kind"in e||"length"in e?{nodes:e,source:t[1],positions:t[2],path:t[3],originalError:t[4],extensions:t[5]}:e}class Cn extends Error{constructor(e,...n){var r,i,s;const{nodes:o,source:h,positions:d,path:a,originalError:u,extensions:c}=jo(n);super(e),this.name="GraphQLError",this.path=a!=null?a:void 0,this.originalError=u!=null?u:void 0,this.nodes=vi(Array.isArray(o)?o:o?[o]:void 0);const l=vi((r=this.nodes)===null||r===void 0?void 0:r.map(p=>p.loc).filter(p=>p!=null));this.source=h!=null?h:l==null||(i=l[0])===null||i===void 0?void 0:i.source,this.positions=d!=null?d:l==null?void 0:l.map(p=>p.start),this.locations=d&&h?d.map(p=>Pn(h,p)):l==null?void 0:l.map(p=>Pn(p.source,p.start));const f=Co(u==null?void 0:u.extensions)?u==null?void 0:u.extensions:void 0;this.extensions=(s=c!=null?c:f)!==null&&s!==void 0?s:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),u!=null&&u.stack?Object.defineProperty(this,"stack",{value:u.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,Cn):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const n of this.nodes)n.loc&&(e+=`

`+Mo(n.loc));else if(this.source&&this.locations)for(const n of this.locations)e+=`

`+fi(this.source,n);return e}toJSON(){const e={message:this.message};return this.locations!=null&&(e.locations=this.locations),this.path!=null&&(e.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function vi(t){return t===void 0||t.length===0?void 0:t}function oe(t,e,n){return new Cn(`Syntax Error: ${n}`,{source:t,positions:[e]})}class Fo{constructor(e,n,r){this.start=e.start,this.end=n.end,this.startToken=e,this.endToken=n,this.source=r}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class mi{constructor(e,n,r,i,s,o){this.kind=e,this.start=n,this.end=r,this.line=i,this.column=s,this.value=o,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const yi={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},Vo=new Set(Object.keys(yi));function gi(t){const e=t==null?void 0:t.kind;return typeof e=="string"&&Vo.has(e)}var $e;(function(t){t.QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription"})($e||($e={}));var Ln;(function(t){t.QUERY="QUERY",t.MUTATION="MUTATION",t.SUBSCRIPTION="SUBSCRIPTION",t.FIELD="FIELD",t.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",t.FRAGMENT_SPREAD="FRAGMENT_SPREAD",t.INLINE_FRAGMENT="INLINE_FRAGMENT",t.VARIABLE_DEFINITION="VARIABLE_DEFINITION",t.SCHEMA="SCHEMA",t.SCALAR="SCALAR",t.OBJECT="OBJECT",t.FIELD_DEFINITION="FIELD_DEFINITION",t.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",t.INTERFACE="INTERFACE",t.UNION="UNION",t.ENUM="ENUM",t.ENUM_VALUE="ENUM_VALUE",t.INPUT_OBJECT="INPUT_OBJECT",t.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(Ln||(Ln={}));var R;(function(t){t.NAME="Name",t.DOCUMENT="Document",t.OPERATION_DEFINITION="OperationDefinition",t.VARIABLE_DEFINITION="VariableDefinition",t.SELECTION_SET="SelectionSet",t.FIELD="Field",t.ARGUMENT="Argument",t.FRAGMENT_SPREAD="FragmentSpread",t.INLINE_FRAGMENT="InlineFragment",t.FRAGMENT_DEFINITION="FragmentDefinition",t.VARIABLE="Variable",t.INT="IntValue",t.FLOAT="FloatValue",t.STRING="StringValue",t.BOOLEAN="BooleanValue",t.NULL="NullValue",t.ENUM="EnumValue",t.LIST="ListValue",t.OBJECT="ObjectValue",t.OBJECT_FIELD="ObjectField",t.DIRECTIVE="Directive",t.NAMED_TYPE="NamedType",t.LIST_TYPE="ListType",t.NON_NULL_TYPE="NonNullType",t.SCHEMA_DEFINITION="SchemaDefinition",t.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",t.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",t.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",t.FIELD_DEFINITION="FieldDefinition",t.INPUT_VALUE_DEFINITION="InputValueDefinition",t.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",t.UNION_TYPE_DEFINITION="UnionTypeDefinition",t.ENUM_TYPE_DEFINITION="EnumTypeDefinition",t.ENUM_VALUE_DEFINITION="EnumValueDefinition",t.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",t.DIRECTIVE_DEFINITION="DirectiveDefinition",t.SCHEMA_EXTENSION="SchemaExtension",t.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",t.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",t.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",t.UNION_TYPE_EXTENSION="UnionTypeExtension",t.ENUM_TYPE_EXTENSION="EnumTypeExtension",t.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(R||(R={}));function Un(t){return t===9||t===32}function ut(t){return t>=48&&t<=57}function Ei(t){return t>=97&&t<=122||t>=65&&t<=90}function Ti(t){return Ei(t)||t===95}function Bo(t){return Ei(t)||ut(t)||t===95}function Go(t){var e;let n=Number.MAX_SAFE_INTEGER,r=null,i=-1;for(let o=0;o<t.length;++o){var s;const h=t[o],d=Ho(h);d!==h.length&&(r=(s=r)!==null&&s!==void 0?s:o,i=o,o!==0&&d<n&&(n=d))}return t.map((o,h)=>h===0?o:o.slice(n)).slice((e=r)!==null&&e!==void 0?e:0,i+1)}function Ho(t){let e=0;for(;e<t.length&&Un(t.charCodeAt(e));)++e;return e}function Ko(t,e){const n=t.replace(/"""/g,'\\"""'),r=n.split(/\r\n|[\n\r]/g),i=r.length===1,s=r.length>1&&r.slice(1).every(f=>f.length===0||Un(f.charCodeAt(0))),o=n.endsWith('\\"""'),h=t.endsWith('"')&&!o,d=t.endsWith("\\"),a=h||d,u=!i||t.length>70||a||s||o;let c="";const l=i&&Un(t.charCodeAt(0));return(u&&!l||s)&&(c+=`
`),c+=n,(u||a)&&(c+=`
`),'"""'+c+'"""'}var g;(function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"})(g||(g={}));class Yo{constructor(e){const n=new mi(g.SOF,0,0,0,0);this.source=e,this.lastToken=n,this.token=n,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==g.EOF)do if(e.next)e=e.next;else{const n=zo(this,e.end);e.next=n,n.prev=e,e=n}while(e.kind===g.COMMENT);return e}}function $o(t){return t===g.BANG||t===g.DOLLAR||t===g.AMP||t===g.PAREN_L||t===g.PAREN_R||t===g.SPREAD||t===g.COLON||t===g.EQUALS||t===g.AT||t===g.BRACKET_L||t===g.BRACKET_R||t===g.BRACE_L||t===g.PIPE||t===g.BRACE_R}function ze(t){return t>=0&&t<=55295||t>=57344&&t<=1114111}function Vt(t,e){return Si(t.charCodeAt(e))&&wi(t.charCodeAt(e+1))}function Si(t){return t>=55296&&t<=56319}function wi(t){return t>=56320&&t<=57343}function De(t,e){const n=t.source.body.codePointAt(e);if(n===void 0)return g.EOF;if(n>=32&&n<=126){const r=String.fromCodePoint(n);return r==='"'?`'"'`:`"${r}"`}return"U+"+n.toString(16).toUpperCase().padStart(4,"0")}function te(t,e,n,r,i){const s=t.line,o=1+n-t.lineStart;return new mi(e,n,r,s,o,i)}function zo(t,e){const n=t.source.body,r=n.length;let i=e;for(;i<r;){const s=n.charCodeAt(i);switch(s){case 65279:case 9:case 32:case 44:++i;continue;case 10:++i,++t.line,t.lineStart=i;continue;case 13:n.charCodeAt(i+1)===10?i+=2:++i,++t.line,t.lineStart=i;continue;case 35:return qo(t,i);case 33:return te(t,g.BANG,i,i+1);case 36:return te(t,g.DOLLAR,i,i+1);case 38:return te(t,g.AMP,i,i+1);case 40:return te(t,g.PAREN_L,i,i+1);case 41:return te(t,g.PAREN_R,i,i+1);case 46:if(n.charCodeAt(i+1)===46&&n.charCodeAt(i+2)===46)return te(t,g.SPREAD,i,i+3);break;case 58:return te(t,g.COLON,i,i+1);case 61:return te(t,g.EQUALS,i,i+1);case 64:return te(t,g.AT,i,i+1);case 91:return te(t,g.BRACKET_L,i,i+1);case 93:return te(t,g.BRACKET_R,i,i+1);case 123:return te(t,g.BRACE_L,i,i+1);case 124:return te(t,g.PIPE,i,i+1);case 125:return te(t,g.BRACE_R,i,i+1);case 34:return n.charCodeAt(i+1)===34&&n.charCodeAt(i+2)===34?ea(t,i):Wo(t,i)}if(ut(s)||s===45)return Jo(t,i,s);if(Ti(s))return ta(t,i);throw oe(t.source,i,s===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:ze(s)||Vt(n,i)?`Unexpected character: ${De(t,i)}.`:`Invalid character: ${De(t,i)}.`)}return te(t,g.EOF,r,r)}function qo(t,e){const n=t.source.body,r=n.length;let i=e+1;for(;i<r;){const s=n.charCodeAt(i);if(s===10||s===13)break;if(ze(s))++i;else if(Vt(n,i))i+=2;else break}return te(t,g.COMMENT,e,i,n.slice(e+1,i))}function Jo(t,e,n){const r=t.source.body;let i=e,s=n,o=!1;if(s===45&&(s=r.charCodeAt(++i)),s===48){if(s=r.charCodeAt(++i),ut(s))throw oe(t.source,i,`Invalid number, unexpected digit after 0: ${De(t,i)}.`)}else i=Mn(t,i,s),s=r.charCodeAt(i);if(s===46&&(o=!0,s=r.charCodeAt(++i),i=Mn(t,i,s),s=r.charCodeAt(i)),(s===69||s===101)&&(o=!0,s=r.charCodeAt(++i),(s===43||s===45)&&(s=r.charCodeAt(++i)),i=Mn(t,i,s),s=r.charCodeAt(i)),s===46||Ti(s))throw oe(t.source,i,`Invalid number, expected digit but got: ${De(t,i)}.`);return te(t,o?g.FLOAT:g.INT,e,i,r.slice(e,i))}function Mn(t,e,n){if(!ut(n))throw oe(t.source,e,`Invalid number, expected digit but got: ${De(t,e)}.`);const r=t.source.body;let i=e+1;for(;ut(r.charCodeAt(i));)++i;return i}function Wo(t,e){const n=t.source.body,r=n.length;let i=e+1,s=i,o="";for(;i<r;){const h=n.charCodeAt(i);if(h===34)return o+=n.slice(s,i),te(t,g.STRING,e,i+1,o);if(h===92){o+=n.slice(s,i);const d=n.charCodeAt(i+1)===117?n.charCodeAt(i+2)===123?Qo(t,i):Xo(t,i):Zo(t,i);o+=d.value,i+=d.size,s=i;continue}if(h===10||h===13)break;if(ze(h))++i;else if(Vt(n,i))i+=2;else throw oe(t.source,i,`Invalid character within String: ${De(t,i)}.`)}throw oe(t.source,i,"Unterminated string.")}function Qo(t,e){const n=t.source.body;let r=0,i=3;for(;i<12;){const s=n.charCodeAt(e+i++);if(s===125){if(i<5||!ze(r))break;return{value:String.fromCodePoint(r),size:i}}if(r=r<<4|lt(s),r<0)break}throw oe(t.source,e,`Invalid Unicode escape sequence: "${n.slice(e,e+i)}".`)}function Xo(t,e){const n=t.source.body,r=xi(n,e+2);if(ze(r))return{value:String.fromCodePoint(r),size:6};if(Si(r)&&n.charCodeAt(e+6)===92&&n.charCodeAt(e+7)===117){const i=xi(n,e+8);if(wi(i))return{value:String.fromCodePoint(r,i),size:12}}throw oe(t.source,e,`Invalid Unicode escape sequence: "${n.slice(e,e+6)}".`)}function xi(t,e){return lt(t.charCodeAt(e))<<12|lt(t.charCodeAt(e+1))<<8|lt(t.charCodeAt(e+2))<<4|lt(t.charCodeAt(e+3))}function lt(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:-1}function Zo(t,e){const n=t.source.body;switch(n.charCodeAt(e+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw oe(t.source,e,`Invalid character escape sequence: "${n.slice(e,e+2)}".`)}function ea(t,e){const n=t.source.body,r=n.length;let i=t.lineStart,s=e+3,o=s,h="";const d=[];for(;s<r;){const a=n.charCodeAt(s);if(a===34&&n.charCodeAt(s+1)===34&&n.charCodeAt(s+2)===34){h+=n.slice(o,s),d.push(h);const u=te(t,g.BLOCK_STRING,e,s+3,Go(d).join(`
`));return t.line+=d.length-1,t.lineStart=i,u}if(a===92&&n.charCodeAt(s+1)===34&&n.charCodeAt(s+2)===34&&n.charCodeAt(s+3)===34){h+=n.slice(o,s),o=s+1,s+=4;continue}if(a===10||a===13){h+=n.slice(o,s),d.push(h),a===13&&n.charCodeAt(s+1)===10?s+=2:++s,h="",o=s,i=s;continue}if(ze(a))++s;else if(Vt(n,s))s+=2;else throw oe(t.source,s,`Invalid character within String: ${De(t,s)}.`)}throw oe(t.source,s,"Unterminated string.")}function ta(t,e){const n=t.source.body,r=n.length;let i=e+1;for(;i<r;){const s=n.charCodeAt(i);if(Bo(s))++i;else break}return te(t,g.NAME,e,i,n.slice(e,i))}const na=10,Oi=2;function jn(t){return Bt(t,[])}function Bt(t,e){switch(typeof t){case"string":return JSON.stringify(t);case"function":return t.name?`[function ${t.name}]`:"[function]";case"object":return ra(t,e);default:return String(t)}}function ra(t,e){if(t===null)return"null";if(e.includes(t))return"[Circular]";const n=[...e,t];if(ia(t)){const r=t.toJSON();if(r!==t)return typeof r=="string"?r:Bt(r,n)}else if(Array.isArray(t))return oa(t,n);return sa(t,n)}function ia(t){return typeof t.toJSON=="function"}function sa(t,e){const n=Object.entries(t);return n.length===0?"{}":e.length>Oi?"["+aa(t)+"]":"{ "+n.map(([i,s])=>i+": "+Bt(s,e)).join(", ")+" }"}function oa(t,e){if(t.length===0)return"[]";if(e.length>Oi)return"[Array]";const n=Math.min(na,t.length),r=t.length-n,i=[];for(let s=0;s<n;++s)i.push(Bt(t[s],e));return r===1?i.push("... 1 more item"):r>1&&i.push(`... ${r} more items`),"["+i.join(", ")+"]"}function aa(t){const e=Object.prototype.toString.call(t).replace(/^\[object /,"").replace(/]$/,"");if(e==="Object"&&typeof t.constructor=="function"){const n=t.constructor.name;if(typeof n=="string"&&n!=="")return n}return e}const ca=globalThis.process&&globalThis.process.env.NODE_ENV==="production"?function(e,n){return e instanceof n}:function(e,n){if(e instanceof n)return!0;if(typeof e=="object"&&e!==null){var r;const i=n.prototype[Symbol.toStringTag],s=Symbol.toStringTag in e?e[Symbol.toStringTag]:(r=e.constructor)===null||r===void 0?void 0:r.name;if(i===s){const o=jn(e);throw new Error(`Cannot use ${i} "${o}" from another module or realm.

Ensure that there is only one instance of "graphql" in the node_modules
directory. If different versions of "graphql" are the dependencies of other
relied on modules, use "resolutions" to ensure only one version is installed.

https://yarnpkg.com/en/docs/selective-version-resolutions

Duplicate "graphql" modules cannot be used at the same time since different
versions may have different capabilities and behavior. The data from one
version used in the function from another could produce confusing and
spurious results.`)}}return!1};class ki{constructor(e,n="GraphQL request",r={line:1,column:1}){typeof e=="string"||Ft(!1,`Body must be a string. Received: ${jn(e)}.`),this.body=e,this.name=n,this.locationOffset=r,this.locationOffset.line>0||Ft(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||Ft(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function ua(t){return ca(t,ki)}function la(t,e){return new da(t,e).parseDocument()}class da{constructor(e,n={}){const r=ua(e)?e:new ki(e);this._lexer=new Yo(r),this._options=n,this._tokenCounter=0}parseName(){const e=this.expectToken(g.NAME);return this.node(e,{kind:R.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:R.DOCUMENT,definitions:this.many(g.SOF,this.parseDefinition,g.EOF)})}parseDefinition(){if(this.peek(g.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),n=e?this._lexer.lookahead():this._lexer.token;if(n.kind===g.NAME){switch(n.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw oe(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(n.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(n)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(g.BRACE_L))return this.node(e,{kind:R.OPERATION_DEFINITION,operation:$e.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const n=this.parseOperationType();let r;return this.peek(g.NAME)&&(r=this.parseName()),this.node(e,{kind:R.OPERATION_DEFINITION,operation:n,name:r,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(g.NAME);switch(e.value){case"query":return $e.QUERY;case"mutation":return $e.MUTATION;case"subscription":return $e.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(g.PAREN_L,this.parseVariableDefinition,g.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:R.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(g.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(g.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(g.DOLLAR),this.node(e,{kind:R.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:R.SELECTION_SET,selections:this.many(g.BRACE_L,this.parseSelection,g.BRACE_R)})}parseSelection(){return this.peek(g.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,n=this.parseName();let r,i;return this.expectOptionalToken(g.COLON)?(r=n,i=this.parseName()):i=n,this.node(e,{kind:R.FIELD,alias:r,name:i,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(g.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const n=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(g.PAREN_L,n,g.PAREN_R)}parseArgument(e=!1){const n=this._lexer.token,r=this.parseName();return this.expectToken(g.COLON),this.node(n,{kind:R.ARGUMENT,name:r,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(g.SPREAD);const n=this.expectOptionalKeyword("on");return!n&&this.peek(g.NAME)?this.node(e,{kind:R.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:R.INLINE_FRAGMENT,typeCondition:n?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(e,{kind:R.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:R.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(e){const n=this._lexer.token;switch(n.kind){case g.BRACKET_L:return this.parseList(e);case g.BRACE_L:return this.parseObject(e);case g.INT:return this.advanceLexer(),this.node(n,{kind:R.INT,value:n.value});case g.FLOAT:return this.advanceLexer(),this.node(n,{kind:R.FLOAT,value:n.value});case g.STRING:case g.BLOCK_STRING:return this.parseStringLiteral();case g.NAME:switch(this.advanceLexer(),n.value){case"true":return this.node(n,{kind:R.BOOLEAN,value:!0});case"false":return this.node(n,{kind:R.BOOLEAN,value:!1});case"null":return this.node(n,{kind:R.NULL});default:return this.node(n,{kind:R.ENUM,value:n.value})}case g.DOLLAR:if(e)if(this.expectToken(g.DOLLAR),this._lexer.token.kind===g.NAME){const r=this._lexer.token.value;throw oe(this._lexer.source,n.start,`Unexpected variable "$${r}" in constant value.`)}else throw this.unexpected(n);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:R.STRING,value:e.value,block:e.kind===g.BLOCK_STRING})}parseList(e){const n=()=>this.parseValueLiteral(e);return this.node(this._lexer.token,{kind:R.LIST,values:this.any(g.BRACKET_L,n,g.BRACKET_R)})}parseObject(e){const n=()=>this.parseObjectField(e);return this.node(this._lexer.token,{kind:R.OBJECT,fields:this.any(g.BRACE_L,n,g.BRACE_R)})}parseObjectField(e){const n=this._lexer.token,r=this.parseName();return this.expectToken(g.COLON),this.node(n,{kind:R.OBJECT_FIELD,name:r,value:this.parseValueLiteral(e)})}parseDirectives(e){const n=[];for(;this.peek(g.AT);)n.push(this.parseDirective(e));return n}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const n=this._lexer.token;return this.expectToken(g.AT),this.node(n,{kind:R.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let n;if(this.expectOptionalToken(g.BRACKET_L)){const r=this.parseTypeReference();this.expectToken(g.BRACKET_R),n=this.node(e,{kind:R.LIST_TYPE,type:r})}else n=this.parseNamedType();return this.expectOptionalToken(g.BANG)?this.node(e,{kind:R.NON_NULL_TYPE,type:n}):n}parseNamedType(){return this.node(this._lexer.token,{kind:R.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(g.STRING)||this.peek(g.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("schema");const r=this.parseConstDirectives(),i=this.many(g.BRACE_L,this.parseOperationTypeDefinition,g.BRACE_R);return this.node(e,{kind:R.SCHEMA_DEFINITION,description:n,directives:r,operationTypes:i})}parseOperationTypeDefinition(){const e=this._lexer.token,n=this.parseOperationType();this.expectToken(g.COLON);const r=this.parseNamedType();return this.node(e,{kind:R.OPERATION_TYPE_DEFINITION,operation:n,type:r})}parseScalarTypeDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("scalar");const r=this.parseName(),i=this.parseConstDirectives();return this.node(e,{kind:R.SCALAR_TYPE_DEFINITION,description:n,name:r,directives:i})}parseObjectTypeDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("type");const r=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();return this.node(e,{kind:R.OBJECT_TYPE_DEFINITION,description:n,name:r,interfaces:i,directives:s,fields:o})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(g.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(g.BRACE_L,this.parseFieldDefinition,g.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,n=this.parseDescription(),r=this.parseName(),i=this.parseArgumentDefs();this.expectToken(g.COLON);const s=this.parseTypeReference(),o=this.parseConstDirectives();return this.node(e,{kind:R.FIELD_DEFINITION,description:n,name:r,arguments:i,type:s,directives:o})}parseArgumentDefs(){return this.optionalMany(g.PAREN_L,this.parseInputValueDef,g.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,n=this.parseDescription(),r=this.parseName();this.expectToken(g.COLON);const i=this.parseTypeReference();let s;this.expectOptionalToken(g.EQUALS)&&(s=this.parseConstValueLiteral());const o=this.parseConstDirectives();return this.node(e,{kind:R.INPUT_VALUE_DEFINITION,description:n,name:r,type:i,defaultValue:s,directives:o})}parseInterfaceTypeDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("interface");const r=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();return this.node(e,{kind:R.INTERFACE_TYPE_DEFINITION,description:n,name:r,interfaces:i,directives:s,fields:o})}parseUnionTypeDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("union");const r=this.parseName(),i=this.parseConstDirectives(),s=this.parseUnionMemberTypes();return this.node(e,{kind:R.UNION_TYPE_DEFINITION,description:n,name:r,directives:i,types:s})}parseUnionMemberTypes(){return this.expectOptionalToken(g.EQUALS)?this.delimitedMany(g.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("enum");const r=this.parseName(),i=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();return this.node(e,{kind:R.ENUM_TYPE_DEFINITION,description:n,name:r,directives:i,values:s})}parseEnumValuesDefinition(){return this.optionalMany(g.BRACE_L,this.parseEnumValueDefinition,g.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,n=this.parseDescription(),r=this.parseEnumValueName(),i=this.parseConstDirectives();return this.node(e,{kind:R.ENUM_VALUE_DEFINITION,description:n,name:r,directives:i})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw oe(this._lexer.source,this._lexer.token.start,`${Gt(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("input");const r=this.parseName(),i=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();return this.node(e,{kind:R.INPUT_OBJECT_TYPE_DEFINITION,description:n,name:r,directives:i,fields:s})}parseInputFieldsDefinition(){return this.optionalMany(g.BRACE_L,this.parseInputValueDef,g.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===g.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const n=this.parseConstDirectives(),r=this.optionalMany(g.BRACE_L,this.parseOperationTypeDefinition,g.BRACE_R);if(n.length===0&&r.length===0)throw this.unexpected();return this.node(e,{kind:R.SCHEMA_EXTENSION,directives:n,operationTypes:r})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const n=this.parseName(),r=this.parseConstDirectives();if(r.length===0)throw this.unexpected();return this.node(e,{kind:R.SCALAR_TYPE_EXTENSION,name:n,directives:r})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const n=this.parseName(),r=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(r.length===0&&i.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:R.OBJECT_TYPE_EXTENSION,name:n,interfaces:r,directives:i,fields:s})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const n=this.parseName(),r=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(r.length===0&&i.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:R.INTERFACE_TYPE_EXTENSION,name:n,interfaces:r,directives:i,fields:s})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const n=this.parseName(),r=this.parseConstDirectives(),i=this.parseUnionMemberTypes();if(r.length===0&&i.length===0)throw this.unexpected();return this.node(e,{kind:R.UNION_TYPE_EXTENSION,name:n,directives:r,types:i})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const n=this.parseName(),r=this.parseConstDirectives(),i=this.parseEnumValuesDefinition();if(r.length===0&&i.length===0)throw this.unexpected();return this.node(e,{kind:R.ENUM_TYPE_EXTENSION,name:n,directives:r,values:i})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const n=this.parseName(),r=this.parseConstDirectives(),i=this.parseInputFieldsDefinition();if(r.length===0&&i.length===0)throw this.unexpected();return this.node(e,{kind:R.INPUT_OBJECT_TYPE_EXTENSION,name:n,directives:r,fields:i})}parseDirectiveDefinition(){const e=this._lexer.token,n=this.parseDescription();this.expectKeyword("directive"),this.expectToken(g.AT);const r=this.parseName(),i=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const o=this.parseDirectiveLocations();return this.node(e,{kind:R.DIRECTIVE_DEFINITION,description:n,name:r,arguments:i,repeatable:s,locations:o})}parseDirectiveLocations(){return this.delimitedMany(g.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,n=this.parseName();if(Object.prototype.hasOwnProperty.call(Ln,n.value))return n;throw this.unexpected(e)}node(e,n){return this._options.noLocation!==!0&&(n.loc=new Fo(e,this._lexer.lastToken,this._lexer.source)),n}peek(e){return this._lexer.token.kind===e}expectToken(e){const n=this._lexer.token;if(n.kind===e)return this.advanceLexer(),n;throw oe(this._lexer.source,n.start,`Expected ${Ai(e)}, found ${Gt(n)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e?(this.advanceLexer(),!0):!1}expectKeyword(e){const n=this._lexer.token;if(n.kind===g.NAME&&n.value===e)this.advanceLexer();else throw oe(this._lexer.source,n.start,`Expected "${e}", found ${Gt(n)}.`)}expectOptionalKeyword(e){const n=this._lexer.token;return n.kind===g.NAME&&n.value===e?(this.advanceLexer(),!0):!1}unexpected(e){const n=e!=null?e:this._lexer.token;return oe(this._lexer.source,n.start,`Unexpected ${Gt(n)}.`)}any(e,n,r){this.expectToken(e);const i=[];for(;!this.expectOptionalToken(r);)i.push(n.call(this));return i}optionalMany(e,n,r){if(this.expectOptionalToken(e)){const i=[];do i.push(n.call(this));while(!this.expectOptionalToken(r));return i}return[]}many(e,n,r){this.expectToken(e);const i=[];do i.push(n.call(this));while(!this.expectOptionalToken(r));return i}delimitedMany(e,n){this.expectOptionalToken(e);const r=[];do r.push(n.call(this));while(this.expectOptionalToken(e));return r}advanceLexer(){const{maxTokens:e}=this._options,n=this._lexer.advance();if(e!==void 0&&n.kind!==g.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw oe(this._lexer.source,n.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function Gt(t){const e=t.value;return Ai(t.kind)+(e!=null?` "${e}"`:"")}function Ai(t){return $o(t)?`"${t}"`:t}function ha(t){return`"${t.replace(fa,pa)}"`}const fa=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function pa(t){return va[t.charCodeAt(0)]}const va=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],ma=Object.freeze({});function ya(t,e,n=yi){const r=new Map;for(const E of Object.values(R))r.set(E,ga(e,E));let i,s=Array.isArray(t),o=[t],h=-1,d=[],a=t,u,c;const l=[],f=[];do{h++;const E=h===o.length,x=E&&d.length!==0;if(E){if(u=f.length===0?void 0:l[l.length-1],a=c,c=f.pop(),x)if(s){a=a.slice();let k=0;for(const[C,b]of d){const _=C-k;b===null?(a.splice(_,1),k++):a[_]=b}}else{a=Object.defineProperties({},Object.getOwnPropertyDescriptors(a));for(const[k,C]of d)a[k]=C}h=i.index,o=i.keys,d=i.edits,s=i.inArray,i=i.prev}else if(c){if(u=s?h:o[h],a=c[u],a==null)continue;l.push(u)}let O;if(!Array.isArray(a)){var p,v;gi(a)||Ft(!1,`Invalid AST Node: ${jn(a)}.`);const k=E?(p=r.get(a.kind))===null||p===void 0?void 0:p.leave:(v=r.get(a.kind))===null||v===void 0?void 0:v.enter;if(O=k==null?void 0:k.call(e,a,u,c,l,f),O===ma)break;if(O===!1){if(!E){l.pop();continue}}else if(O!==void 0&&(d.push([u,O]),!E))if(gi(O))a=O;else{l.pop();continue}}if(O===void 0&&x&&d.push([u,a]),E)l.pop();else{var T;i={inArray:s,index:h,keys:o,edits:d,prev:i},s=Array.isArray(a),o=s?a:(T=n[a.kind])!==null&&T!==void 0?T:[],h=-1,d=[],c&&f.push(c),c=a}}while(i!==void 0);return d.length!==0?d[d.length-1][1]:t}function ga(t,e){const n=t[e];return typeof n=="object"?n:typeof n=="function"?{enter:n,leave:void 0}:{enter:t.enter,leave:t.leave}}function Ea(t){return ya(t,Sa)}const Ta=80,Sa={Name:{leave:t=>t.value},Variable:{leave:t=>"$"+t.name},Document:{leave:t=>A(t.definitions,`

`)},OperationDefinition:{leave(t){const e=U("(",A(t.variableDefinitions,", "),")"),n=A([t.operation,A([t.name,e]),A(t.directives," ")]," ");return(n==="query"?"":n+" ")+t.selectionSet}},VariableDefinition:{leave:({variable:t,type:e,defaultValue:n,directives:r})=>t+": "+e+U(" = ",n)+U(" ",A(r," "))},SelectionSet:{leave:({selections:t})=>me(t)},Field:{leave({alias:t,name:e,arguments:n,directives:r,selectionSet:i}){const s=U("",t,": ")+e;let o=s+U("(",A(n,", "),")");return o.length>Ta&&(o=s+U(`(
`,Ht(A(n,`
`)),`
)`)),A([o,A(r," "),i]," ")}},Argument:{leave:({name:t,value:e})=>t+": "+e},FragmentSpread:{leave:({name:t,directives:e})=>"..."+t+U(" ",A(e," "))},InlineFragment:{leave:({typeCondition:t,directives:e,selectionSet:n})=>A(["...",U("on ",t),A(e," "),n]," ")},FragmentDefinition:{leave:({name:t,typeCondition:e,variableDefinitions:n,directives:r,selectionSet:i})=>`fragment ${t}${U("(",A(n,", "),")")} on ${e} ${U("",A(r," ")," ")}`+i},IntValue:{leave:({value:t})=>t},FloatValue:{leave:({value:t})=>t},StringValue:{leave:({value:t,block:e})=>e?Ko(t):ha(t)},BooleanValue:{leave:({value:t})=>t?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:t})=>t},ListValue:{leave:({values:t})=>"["+A(t,", ")+"]"},ObjectValue:{leave:({fields:t})=>"{"+A(t,", ")+"}"},ObjectField:{leave:({name:t,value:e})=>t+": "+e},Directive:{leave:({name:t,arguments:e})=>"@"+t+U("(",A(e,", "),")")},NamedType:{leave:({name:t})=>t},ListType:{leave:({type:t})=>"["+t+"]"},NonNullType:{leave:({type:t})=>t+"!"},SchemaDefinition:{leave:({description:t,directives:e,operationTypes:n})=>U("",t,`
`)+A(["schema",A(e," "),me(n)]," ")},OperationTypeDefinition:{leave:({operation:t,type:e})=>t+": "+e},ScalarTypeDefinition:{leave:({description:t,name:e,directives:n})=>U("",t,`
`)+A(["scalar",e,A(n," ")]," ")},ObjectTypeDefinition:{leave:({description:t,name:e,interfaces:n,directives:r,fields:i})=>U("",t,`
`)+A(["type",e,U("implements ",A(n," & ")),A(r," "),me(i)]," ")},FieldDefinition:{leave:({description:t,name:e,arguments:n,type:r,directives:i})=>U("",t,`
`)+e+(Ii(n)?U(`(
`,Ht(A(n,`
`)),`
)`):U("(",A(n,", "),")"))+": "+r+U(" ",A(i," "))},InputValueDefinition:{leave:({description:t,name:e,type:n,defaultValue:r,directives:i})=>U("",t,`
`)+A([e+": "+n,U("= ",r),A(i," ")]," ")},InterfaceTypeDefinition:{leave:({description:t,name:e,interfaces:n,directives:r,fields:i})=>U("",t,`
`)+A(["interface",e,U("implements ",A(n," & ")),A(r," "),me(i)]," ")},UnionTypeDefinition:{leave:({description:t,name:e,directives:n,types:r})=>U("",t,`
`)+A(["union",e,A(n," "),U("= ",A(r," | "))]," ")},EnumTypeDefinition:{leave:({description:t,name:e,directives:n,values:r})=>U("",t,`
`)+A(["enum",e,A(n," "),me(r)]," ")},EnumValueDefinition:{leave:({description:t,name:e,directives:n})=>U("",t,`
`)+A([e,A(n," ")]," ")},InputObjectTypeDefinition:{leave:({description:t,name:e,directives:n,fields:r})=>U("",t,`
`)+A(["input",e,A(n," "),me(r)]," ")},DirectiveDefinition:{leave:({description:t,name:e,arguments:n,repeatable:r,locations:i})=>U("",t,`
`)+"directive @"+e+(Ii(n)?U(`(
`,Ht(A(n,`
`)),`
)`):U("(",A(n,", "),")"))+(r?" repeatable":"")+" on "+A(i," | ")},SchemaExtension:{leave:({directives:t,operationTypes:e})=>A(["extend schema",A(t," "),me(e)]," ")},ScalarTypeExtension:{leave:({name:t,directives:e})=>A(["extend scalar",t,A(e," ")]," ")},ObjectTypeExtension:{leave:({name:t,interfaces:e,directives:n,fields:r})=>A(["extend type",t,U("implements ",A(e," & ")),A(n," "),me(r)]," ")},InterfaceTypeExtension:{leave:({name:t,interfaces:e,directives:n,fields:r})=>A(["extend interface",t,U("implements ",A(e," & ")),A(n," "),me(r)]," ")},UnionTypeExtension:{leave:({name:t,directives:e,types:n})=>A(["extend union",t,A(e," "),U("= ",A(n," | "))]," ")},EnumTypeExtension:{leave:({name:t,directives:e,values:n})=>A(["extend enum",t,A(e," "),me(n)]," ")},InputObjectTypeExtension:{leave:({name:t,directives:e,fields:n})=>A(["extend input",t,A(e," "),me(n)]," ")}};function A(t,e=""){var n;return(n=t==null?void 0:t.filter(r=>r).join(e))!==null&&n!==void 0?n:""}function me(t){return U(`{
`,Ht(A(t,`
`)),`
}`)}function U(t,e,n=""){return e!=null&&e!==""?t+e+n:""}function Ht(t){return U("  ",t.replace(/\n/g,`
  `))}function Ii(t){var e;return(e=t==null?void 0:t.some(n=>n.includes(`
`)))!==null&&e!==void 0?e:!1}function wa(t,e,n){return t.document?t:{document:t,variables:e,config:n}}function bi(t){var e;let n;const r=t.definitions.filter(i=>i.kind==="OperationDefinition");return r.length===1&&(n=(e=r[0].name)==null?void 0:e.value),n}function xa(t){if(typeof t=="string"){let n;try{const r=la(t);n=bi(r)}catch{}return{query:t,operationName:n}}const e=bi(t);return{query:Ea(t),operationName:e}}let Oa=class{constructor(e){this.headers={},this.isAccessTokenValidOrNull=()=>{if(!this.accessToken)return!0;try{const i=qt(this.accessToken);return i.exp!=null&&i.exp*1e3>Date.now()}catch(i){return console.error("Error decoding token:",i),!1}},this.awaitForValidAccessTokenOrNull=async()=>{if(this.isAccessTokenValidOrNull())return!0;const i=()=>this.isAccessTokenValidOrNull()?Promise.resolve(!0):new Promise(s=>{setTimeout(()=>i().then(s),100)});return i()};const{url:n,adminSecret:r}=e;this._url=n,this.accessToken=null,this.adminSecret=r}async request(e,...n){const[r,i]=n,s=wa(e,r,i),{headers:o,...h}=i||{},{query:d,operationName:a}=xa(s.document);typeof process!="undefined"&&!process.env.TEST_MODE&&await this.awaitForValidAccessTokenOrNull();try{const u=await hi(this.httpUrl,{method:"POST",body:JSON.stringify({operationName:a,query:d,variables:r}),headers:{"Content-Type":"application/json",...this.generateAccessTokenHeaders(),...this.headers,...o},...h});if(!u.ok)return{data:null,error:{error:u.statusText,message:u.statusText,status:u.status}};const{data:c,errors:l}=await u.json();return l?{data:null,error:l}:typeof c!="object"||Array.isArray(c)||c===null?{data:null,error:{error:"invalid-response",message:"incorrect response data from GraphQL server",status:0}}:{data:c,error:null}}catch(u){const c=u;return{data:null,error:{message:c.message,status:c.name==="AbortError"?0:500,error:c.name==="AbortError"?"abort-error":"unknown"}}}}get httpUrl(){return this._url}get wsUrl(){return this._url.replace(/^(http)(s?):\/\//,"ws$2://")}get url(){return this._url}getUrl(){return this._url}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}getHeaders(){return this.headers}setHeaders(e){e&&(this.headers={...this.headers,...e})}unsetHeaders(){const e=this.headers["x-hasura-role"];this.headers=e?{"x-hasura-role":e}:{}}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}};const ka=/^((?<protocol>http[s]?):\/\/)?(?<host>(localhost|local))(:(?<port>(\d+|__\w+__)))?$/;function Kt(t,e){const{subdomain:n,region:r}=t;if(!n)throw new Error("A `subdomain` must be set.");const i=n.match(ka);if(i!=null&&i.groups){const{protocol:s,host:o,port:h}=i.groups;return ba(e)||(o==="localhost"?(console.warn('The `subdomain` is set to "localhost". Support for this will be removed in a future release. Please use "local" instead.'),`${s||"http"}://localhost:${h||1337}/v1/${e}`):h?`${s||"https"}://local.${e}.local.nhost.run:${h}/v1`:`${s||"https"}://local.${e}.local.nhost.run/v1`)}if(!r)throw new Error('`region` must be set when using a `subdomain` other than "local".');return`https://${n}.${e}.${r}.nhost.run/v1`}function Aa(){return typeof window!="undefined"}function Ia(){return typeof process!="undefined"&&process.env}function ba(t){return Aa()||!Ia()?null:process.env[`NHOST_${t.toUpperCase()}_URL`]}function _a(t,e){const n=e.startsWith("/")?e:`/${e}`;return t+n}function Na(t){const e="subdomain"in t?Kt(t,"auth"):t.authUrl,{subdomain:n,region:r}=t;if(!e)throw new Error("Please provide `subdomain` or `authUrl`.");return new ko({url:e,broadcastKey:`${n}${r!=null?r:"local"}`,...t})}function Ra(t){const e="subdomain"in t?Kt(t,"functions"):t.functionsUrl;if(!e)throw new Error("Please provide `subdomain` or `functionsUrl`.");return new Da({url:e,...t})}class Da{constructor(e){this.headers={};const{url:n,adminSecret:r}=e;this.url=n,this.accessToken=null,this.adminSecret=r}async call(e,n,r){var i,s;const o={"Content-Type":"application/json",...this.generateAccessTokenHeaders(),...r==null?void 0:r.headers,...this.headers},h=_a(this.url,e);try{const d=await hi(h,{body:n?JSON.stringify(n):null,headers:o,method:"POST"});if(!d.ok){let u;return(i=d.headers.get("content-type"))!=null&&i.includes("application/json")?u=await d.json():u=await d.text(),{res:null,error:{message:u,error:d.statusText,status:d.status}}}let a;return(s=d.headers.get("content-type"))!=null&&s.includes("application/json")?a=await d.json():a=await d.text(),{res:{data:a,status:d.status,statusText:d.statusText},error:null}}catch(d){const a=d;return{res:null,error:{message:a.message,status:a.name==="AbortError"?0:500,error:a.name==="AbortError"?"abort-error":"unknown"}}}}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}getHeaders(){return this.headers}setHeaders(e){e&&(this.headers={...this.headers,...e})}unsetHeaders(){const e=this.headers["x-hasura-role"];this.headers=e?{"x-hasura-role":e}:{}}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}}function Pa(t){const e="subdomain"in t?Kt(t,"graphql"):t.graphqlUrl;if(!e)throw new Error("Please provide `subdomain` or `graphqlUrl`.");return new Oa({url:e,...t})}function Ca(t){const e="subdomain"in t?Kt(t,"storage"):t.storageUrl;if(!e)throw new Error("Please provide `subdomain` or `storageUrl`.");return new bo({url:e,...t})}class La{constructor({refreshIntervalTime:e,clientStorage:n,clientStorageType:r,autoRefreshToken:i,autoSignIn:s,adminSecret:o,devTools:h,start:d=!0,...a}){this.auth=Na({refreshIntervalTime:e,clientStorage:n,clientStorageType:r,autoRefreshToken:i,autoSignIn:s,start:d,...a}),this.storage=Ca({adminSecret:o,...a}),this.functions=Ra({adminSecret:o,...a}),this.graphql=Pa({adminSecret:o,...a}),this.auth.onAuthStateChanged((u,c)=>{if(u==="SIGNED_OUT"){this.storage.setAccessToken(void 0),this.functions.setAccessToken(void 0),this.graphql.setAccessToken(void 0);return}const l=c==null?void 0:c.accessToken;this.storage.setAccessToken(l),this.functions.setAccessToken(l),this.graphql.setAccessToken(l)}),this.auth.onTokenChanged(u=>{const c=u==null?void 0:u.accessToken;this.storage.setAccessToken(c),this.functions.setAccessToken(c),this.graphql.setAccessToken(c)}),this._adminSecret=o,this.devTools=h}get adminSecret(){return this._adminSecret}set adminSecret(e){this._adminSecret=e,this.storage.setAdminSecret(e)}setRole(e){this.graphql.setHeaders({"x-hasura-role":e}),this.storage.setHeaders({"x-hasura-role":e}),this.functions.setHeaders({"x-hasura-role":e})}unsetRole(){this.graphql.setHeaders((({"x-hasura-role":e,...n})=>n)(this.graphql.getHeaders())),this.storage.setHeaders((({"x-hasura-role":e,...n})=>n)(this.storage.getHeaders())),this.functions.setHeaders((({"x-hasura-role":e,...n})=>n)(this.functions.getHeaders()))}}const _i=La;class Ua extends _i{constructor(e){super({...e,start:!1})}}var Fn={exports:{}},Vn={},Yt={exports:{}},Bn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ni;function Ma(){if(Ni)return Bn;Ni=1;var t=P;function e(c,l){return c===l&&(c!==0||1/c===1/l)||c!==c&&l!==l}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,i=t.useEffect,s=t.useLayoutEffect,o=t.useDebugValue;function h(c,l){var f=l(),p=r({inst:{value:f,getSnapshot:l}}),v=p[0].inst,T=p[1];return s(function(){v.value=f,v.getSnapshot=l,d(v)&&T({inst:v})},[c,f,l]),i(function(){return d(v)&&T({inst:v}),c(function(){d(v)&&T({inst:v})})},[c]),o(f),f}function d(c){var l=c.getSnapshot;c=c.value;try{var f=l();return!n(c,f)}catch{return!0}}function a(c,l){return l()}var u=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?a:h;return Bn.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Bn}var Gn={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ri;function ja(){return Ri||(Ri=1,process.env.NODE_ENV!=="production"&&function(){function t(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}function e(f,p){u||i.startTransition===void 0||(u=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var v=p();if(!c){var T=p();s(v,T)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),c=!0)}T=o({inst:{value:v,getSnapshot:p}});var E=T[0].inst,x=T[1];return d(function(){E.value=v,E.getSnapshot=p,n(E)&&x({inst:E})},[f,v,p]),h(function(){return n(E)&&x({inst:E}),f(function(){n(E)&&x({inst:E})})},[f]),a(v),v}function n(f){var p=f.getSnapshot;f=f.value;try{var v=p();return!s(f,v)}catch{return!0}}function r(f,p){return p()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var i=P,s=typeof Object.is=="function"?Object.is:t,o=i.useState,h=i.useEffect,d=i.useLayoutEffect,a=i.useDebugValue,u=!1,c=!1,l=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?r:e;Gn.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:l,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),Gn}var Di;function Pi(){return Di||(Di=1,process.env.NODE_ENV==="production"?Yt.exports=Ma():Yt.exports=ja()),Yt.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ci;function Fa(){if(Ci)return Vn;Ci=1;var t=P,e=Pi();function n(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}var r=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,s=t.useRef,o=t.useEffect,h=t.useMemo,d=t.useDebugValue;return Vn.useSyncExternalStoreWithSelector=function(a,u,c,l,f){var p=s(null);if(p.current===null){var v={hasValue:!1,value:null};p.current=v}else v=p.current;p=h(function(){function E(b){if(!x){if(x=!0,O=b,b=l(b),f!==void 0&&v.hasValue){var _=v.value;if(f(_,b))return k=_}return k=b}if(_=k,r(O,b))return _;var M=l(b);return f!==void 0&&f(_,M)?(O=b,_):(O=b,k=M)}var x=!1,O,k,C=c===void 0?null:c;return[function(){return E(u())},C===null?void 0:function(){return E(C())}]},[u,c,l,f]);var T=i(a,p[0],p[1]);return o(function(){v.hasValue=!0,v.value=T},[T]),d(T),T},Vn}var Hn={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Li;function Va(){return Li||(Li=1,process.env.NODE_ENV!=="production"&&function(){function t(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=P,n=Pi(),r=typeof Object.is=="function"?Object.is:t,i=n.useSyncExternalStore,s=e.useRef,o=e.useEffect,h=e.useMemo,d=e.useDebugValue;Hn.useSyncExternalStoreWithSelector=function(a,u,c,l,f){var p=s(null);if(p.current===null){var v={hasValue:!1,value:null};p.current=v}else v=p.current;p=h(function(){function E(b){if(!x){if(x=!0,O=b,b=l(b),f!==void 0&&v.hasValue){var _=v.value;if(f(_,b))return k=_}return k=b}if(_=k,r(O,b))return _;var M=l(b);return f!==void 0&&f(_,M)?(O=b,_):(O=b,k=M)}var x=!1,O,k,C=c===void 0?null:c;return[function(){return E(u())},C===null?void 0:function(){return E(C())}]},[u,c,l,f]);var T=i(a,p[0],p[1]);return o(function(){v.hasValue=!0,v.value=T},[T]),d(T),T},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),Hn}process.env.NODE_ENV==="production"?Fn.exports=Fa():Fn.exports=Va();var Ba=Fn.exports,Ga=P.useLayoutEffect;function Ui(t){var e=Ki.useRef();return e.current||(e.current={v:t()}),e.current.v}var $t=function(){return $t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},$t.apply(this,arguments)},Ha=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n},Mi=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(h){o={error:h}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function Ka(t,e){var n=Ui(function(){return typeof t=="function"?t():t});if(process.env.NODE_ENV!=="production"&&typeof t!="function"){var r=Mi(P.useState(n),1),i=r[0];t!==i&&console.warn("Machine given to `useMachine` has changed between renders. This is not supported and might lead to unexpected results.\nPlease make sure that you pass the same Machine as argument each time.")}var s=e.context,o=e.guards,h=e.actions,d=e.activities,a=e.services,u=e.delays;e.state;var c=Ha(e,["context","guards","actions","activities","services","delays","state"]),l=Ui(function(){var f={context:s,guards:o,actions:h,activities:d,services:a,delays:u},p=n.withConfig(f,function(){return $t($t({},n.context),s)});return Ne(p,c)});return Ga(function(){Object.assign(l.machine.options.actions,h),Object.assign(l.machine.options.guards,o),Object.assign(l.machine.options.activities,d),Object.assign(l.machine.options.services,a),Object.assign(l.machine.options.delays,u)},[h,o,d,a,u]),l}function Ie(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=Mi(e,2),i=r[0],s=i===void 0?{}:i,o=r[1],h=Ka(t,s);return P.useEffect(function(){if(o){var d=h.subscribe(Ze(o));return function(){d.unsubscribe()}}},[o]),P.useEffect(function(){var d=s.state;return h.start(d?pe.create(d):void 0),function(){h.stop(),h.status=ee.NotStarted}},[]),h}function Ya(t){return t.status!==0?t.getSnapshot():t.machine.initialState}function $a(t){return"state"in t&&"machine"in t}function za(t){return"state"in t}var qa=function(t,e){return t===e},Ja=function(t,e){if($a(t)){if(t.status===0&&e.current)return e.current;var n=Ya(t);return e.current=t.status===0?n:null,n}return za(t)?t.state:void 0};function y(t,e,n,r){n===void 0&&(n=qa);var i=P.useRef(null),s=P.useCallback(function(d){var a=t.subscribe(d).unsubscribe;return a},[t]),o=P.useCallback(function(){return Ja(t,i)},[t,r]),h=Ba.useSyncExternalStoreWithSelector(s,o,o,e,n);return h}const dt=P.createContext({}),ji=({nhost:t,initial:e,...n})=>{const r=Ie(t.auth.client.machine,{devTools:t.devTools});t.auth.client.start({interpreter:r,initialSession:e,devTools:t.devTools});const i=P.useRef(!0);return P.useEffect(()=>{i.current?i.current=!1:e&&r.send("SESSION_UPDATE",{data:{session:e}})},[e,r]),Gi.jsx(dt.Provider,{value:t,children:n.children})},Wa=ji,J=()=>{var n;const e=(n=P.useContext(dt).auth)==null?void 0:n.client.interpreter;if(!e)throw Error("Could not find the Nhost auth client. Did you wrap your app in <NhostProvider />?");return e},Kn=()=>{const t=J();return y(t,e=>({isAuthenticated:e.matches({authentication:"signedIn"}),isLoading:e.hasTag("loading"),error:e.context.errors.authentication||null,isError:e.matches({authentication:{signedOut:"failed"}}),connectionAttempts:e.context.importTokenAttempts}),(e,n)=>e.isAuthenticated===n.isAuthenticated&&e.isLoading===n.isLoading&&e.connectionAttempts===n.connectionAttempts)};function Qa({children:t}){const{isAuthenticated:e}=Kn();return e?P.createElement(P.Fragment,null,t):null}function Xa({children:t}){const{isAuthenticated:e}=Kn();return e?null:P.createElement(P.Fragment,null,t)}const Yn=()=>{const t=J();return y(t,e=>e.context.accessToken.value)},ye=()=>P.useContext(dt),Za=()=>{const t=ye(),[e,n]=P.useState(null),r=!e,i=!!e,[s,o]=P.useState(!1);return{add:async d=>{o(!0);const a=await Yr(t.auth.client,d),{error:u}=a;return u&&n(u),o(!1),a},isLoading:s,isSuccess:r,isError:i,error:e}},ec=()=>{const t=J(),[e,n]=P.useState(!!t.status&&t.getSnapshot().matches({authentication:"signedIn"}));return P.useEffect(()=>t.subscribe(i=>{const s=i.matches({authentication:"signedIn"});n(s)}).unsubscribe,[t]),e};function tc(t){const e=ye(),n=P.useMemo(()=>Br(e.auth.client),[e]),r=Ie(n),i=y(r,a=>a.matches("requesting")),s=y(r,a=>a.context.error),o=y(r,a=>a.matches("idle.error")),h=y(r,a=>a.matches("idle.success"));return{changeEmail:P.useCallback(async(a,u=t)=>$r(r,a,u),[r,t]),isLoading:i,needsEmailVerification:h,isError:o,error:s}}const nc=()=>{const t=ye(),e=P.useMemo(()=>Gr(t.auth.client),[t]),n=Ie(e),r=y(n,d=>d.matches({idle:"error"})),i=y(n,d=>d.matches({idle:"success"})),s=y(n,d=>d.context.error),o=y(n,d=>d.matches("requesting"));return{changePassword:d=>zr(n,d),isLoading:o,isSuccess:i,isError:r,error:s}},rc=()=>{const t=ye(),e=P.useMemo(()=>To(t.auth.client),[t]),n=Ie(e),r=y(n,l=>l.matches({idle:"error"})||l.matches({generated:{idle:"error"}})),i=y(n,l=>l.matches("generating")),s=y(n,l=>l.matches("generated")),o=y(n,l=>l.matches({generated:"activating"})),h=y(n,l=>l.matches({generated:"activated"})),d=y(n,l=>l.context.error),a=y(n,l=>l.context.imageUrl||"");return{generateQrCode:()=>wo(n),isGenerating:i,qrCodeDataUrl:a,isGenerated:s,activateMfa:l=>xo(n,l),isActivating:o,isActivated:h,isError:r,error:d}},Fi=()=>{const t=Yn();return t?qt(t):null},Vi=t=>{const e=ye(),n=p=>{t.send({type:"ADD",file:p.file,bucketId:p.bucketId||l})},r=p=>No({url:e.storage.url,accessToken:e.auth.getAccessToken(),adminSecret:e.adminSecret,...p},t),i=()=>{t.send("CANCEL")},s=()=>{t.send("DESTROY")},o=y(t,p=>p.matches("uploading")),h=y(t,p=>p.matches("uploaded")),d=y(t,p=>p.matches("error")),a=y(t,p=>p.context.error||null),u=y(t,p=>p.context.progress),c=y(t,p=>p.context.id),l=y(t,p=>p.context.bucketId),f=y(t,p=>{var v;return(v=p.context.file)==null?void 0:v.name});return{add:n,upload:r,cancel:i,destroy:s,isUploaded:h,isUploading:o,isError:d,error:a,progress:u,id:c,bucketId:l,name:f}},ic=()=>{const t=Ie(li);return Vi(t)},$n=()=>{const t=Fi();return(t==null?void 0:t["https://hasura.io/jwt/claims"])||null},sc=t=>{const e=$n();return(e==null?void 0:e[t.startsWith("x-hasura-")?t:`x-hasura-${t}`])||null},oc=()=>{const t=ye(),[e,n]=P.useState([]),r=Ie(_o,{},f=>{f.event.type==="UPLOAD_ERROR"?n(f.context.files.filter(p=>{var v;return(v=p.getSnapshot())==null?void 0:v.context.error})):(f.matches("uploaded")||f.event.type==="CLEAR")&&e.length>0&&n([])}),i=f=>{r.send({type:"ADD",...f})},s=f=>Ro({url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,...f},r),o=()=>{r.send("CANCEL")},h=()=>{r.send("CLEAR")},d=y(r,f=>f.matches("uploading")),a=y(r,f=>f.matches("uploaded")),u=y(r,f=>f.matches("error")),c=y(r,f=>f.context.progress),l=y(r,f=>f.context.files);return{upload:s,add:i,clear:h,cancel:o,progress:c,isUploaded:a,isUploading:d,files:l,isError:u,errors:e}},ac=t=>{const[e,n]=P.useState(!0),r=Yn();P.useEffect(()=>{n(!1)},[]);const i=P.useContext(dt);return new Proxy({},{get(s,o){let h=`${i.auth.client.backendUrl}/signin/provider/${o}`;const d=t!=null&&t.connect?{connect:r}:{};return Ut(h,le(e?void 0:i.auth.client.clientUrl,{...t,...d}))}})},cc=t=>{const e=ye(),n=P.useMemo(()=>Hr(e.auth.client),[e]),r=Ie(n),i=y(r,a=>a.matches("requesting")),s=y(r,a=>a.context.error),o=y(r,a=>a.matches("idle.error")),h=y(r,a=>a.matches("idle.success"));return{resetPassword:(a,u=t)=>qr(r,a,u),isLoading:i,isSent:h,isError:o,error:s}},uc=t=>{const e=ye(),n=P.useMemo(()=>Kr(e.auth.client),[e]),r=Ie(n),i=y(r,a=>a.matches({idle:"error"})),s=y(r,a=>a.matches({idle:"success"})),o=y(r,a=>a.context.error),h=y(r,a=>a.matches("requesting"));return{sendEmail:(a,u=t)=>Jr(r,a,u),isLoading:h,isSent:s,isError:i,error:o}},lc=()=>{const t=J(),e=()=>Wr(t),n=y(t,d=>d.context.errors.authentication||null,(d,a)=>(d==null?void 0:d.error)===(a==null?void 0:a.error)),r=y(t,d=>d.matches({authentication:{authenticating:"anonymous"}})),i=y(t,d=>d.matches({authentication:"signedIn"})),s=y(t,d=>d.matches({authentication:{signedOut:"failed"}})),o=y(t,d=>d.context.user,(d,a)=>(d==null?void 0:d.id)===(a==null?void 0:a.id));return{accessToken:y(t,d=>d.context.accessToken.value),error:n,isError:s,isLoading:r,isSuccess:i,signInAnonymous:e,user:o}},dc=()=>{const t=J(),e=(f,p)=>Qr(t,f,p),n=f=>ei(t,f),r=y(t,f=>f.context.user,(f,p)=>(f==null?void 0:f.id)===(p==null?void 0:p.id)),i=y(t,f=>f.context.accessToken.value),s=y(t,f=>f.context.refreshToken.value),o=y(t,f=>f.context.errors.authentication||null,(f,p)=>(f==null?void 0:f.error)===(p==null?void 0:p.error)),h=y(t,f=>f.matches({authentication:"signedIn"})),d=y(t,f=>f.matches({authentication:{authenticating:"password"}}),(f,p)=>f===p),a=y(t,f=>f.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(f,p)=>f===p),u=y(t,f=>f.matches({authentication:{signedOut:"needsMfa"}}),(f,p)=>f===p),c=y(t,f=>f.matches({authentication:{signedOut:"failed"}}),(f,p)=>f===p),l=y(t,f=>f.context.mfa);return{accessToken:i,refreshToken:s,error:o,isError:c,isLoading:d,isSuccess:h,needsEmailVerification:a,needsMfaOtp:u,mfa:l,sendMfaOtp:n,signInEmailPassword:e,user:r}};function hc(t){const e=J(),n=(h,d=t)=>xn(e,h,d),r=y(e,h=>h.context.errors.registration||null,(h,d)=>(h==null?void 0:h.error)===(d==null?void 0:d.error)),i=y(e,h=>h.matches("registration.passwordlessEmail")),s=y(e,h=>h.matches("registration.incomplete.needsEmailVerification")),o=y(e,h=>h.matches("registration.incomplete.failed"));return{signInEmailPasswordless:n,isLoading:i,isSuccess:s,isError:o,error:r}}const fc=()=>{const t=J(),e=u=>Xr(t,u),n=y(t,u=>u.context.user,(u,c)=>(u==null?void 0:u.id)===(c==null?void 0:c.id)),r=y(t,u=>u.context.accessToken.value),i=y(t,u=>u.context.refreshToken.value),s=y(t,u=>u.context.errors.authentication||null,(u,c)=>(u==null?void 0:u.error)===(c==null?void 0:c.error)),o=y(t,u=>u.matches({authentication:"signedIn"})),h=y(t,u=>u.matches({authentication:{authenticating:"securityKeyEmail"}}),(u,c)=>u===c),d=y(t,u=>u.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(u,c)=>u===c),a=y(t,u=>u.matches({authentication:{signedOut:"failed"}}),(u,c)=>u===c);return{accessToken:r,refreshToken:i,error:s,isError:a,isLoading:h,isSuccess:o,needsEmailVerification:d,signInEmailSecurityKey:e,user:n}},Bi=()=>{const t=J();return y(t,e=>e.context.user,(e,n)=>(e&&JSON.stringify(e))===(n&&JSON.stringify(n)))},pc=()=>{const t=Bi(),e=ye(),n=$n(),r=t?(n==null?void 0:n["x-hasura-auth-elevated"])===(t==null?void 0:t.id):!1,[i,s]=P.useState(!!r),o=h=>Zr(e.auth.client,h);return P.useEffect(()=>{s(!!r)},[r]),{elevated:i,elevateEmailSecurityKey:o}},vc=()=>{const t=J(),e=a=>ti(t,a),n=y(t,a=>a.context.user,(a,u)=>(a==null?void 0:a.id)===(u==null?void 0:u.id)),r=y(t,a=>a.context.accessToken.value),i=y(t,a=>a.context.refreshToken.value),s=y(t,a=>a.context.errors.authentication||null,(a,u)=>(a==null?void 0:a.error)===(u==null?void 0:u.error)),o=y(t,a=>a.matches({authentication:"signedIn"})),h=y(t,a=>a.matches({authentication:{authenticating:"password"}}),(a,u)=>a===u),d=y(t,a=>a.matches({authentication:{signedOut:"failed"}}),(a,u)=>a===u);return{accessToken:r,refreshToken:i,error:s,isError:d,isLoading:h,isSuccess:o,signInPAT:e,user:n}};function mc(t){const e=J(),[n,r]=P.useState(""),i=(c,l=t)=>(r(c),On(e,c,l)),s=async(...c)=>{if(c.length===2){const[f,p]=c;return kn(e,f,p)}const[l]=c;return kn(e,n,l)},o=y(e,c=>c.context.errors.registration||null,(c,l)=>(c==null?void 0:c.error)===(l==null?void 0:l.error)),h=y(e,c=>c.matches("registration.passwordlessSms")||c.matches("registration.passwordlessSmsOtp")),d=y(e,c=>c.matches("authentication.signedIn")),a=y(e,c=>c.matches("registration.incomplete.needsOtp")),u=y(e,c=>c.matches("registration.incomplete.failed"));return{signInSmsPasswordless:i,sendOtp:s,isLoading:h,isSuccess:d,needsOtp:a,isError:u,error:o}}const yc=(t=!1)=>{const e=J(),n=s=>ni(e,typeof s=="boolean"?s:t),r=y(e,s=>s.matches({authentication:{signedOut:"success"}}),(s,o)=>s===o),i=y(e,s=>s.context.errors.signout||null,(s,o)=>(s==null?void 0:s.error)===(o==null?void 0:o.error));return{signOut:n,isSuccess:r,error:i}},gc=t=>{const e=J(),n=y(e,c=>!!c.context.errors.registration),r=y(e,c=>c.context.errors.registration||null,(c,l)=>(c==null?void 0:c.error)===(l==null?void 0:l.error)),i=y(e,c=>c.matches("registration.emailPassword")),s=y(e,c=>c.matches("registration.incomplete.needsEmailVerification")),o=y(e,c=>c.matches({authentication:"signedIn",registration:"complete"})),h=(c,l,f=t,p)=>An(e,c,l,f,p),d=y(e,c=>c.context.user,(c,l)=>(c==null?void 0:c.id)===(l==null?void 0:l.id)),a=y(e,c=>c.context.accessToken.value),u=y(e,c=>c.context.refreshToken.value);return{accessToken:a,refreshToken:u,error:r,isError:n,isLoading:i,isSuccess:o,needsEmailVerification:s,signUpEmailPassword:h,user:d}},Ec=t=>{const e=J(),n=y(e,c=>!!c.context.errors.registration),r=y(e,c=>c.context.errors.registration||null,(c,l)=>(c==null?void 0:c.error)===(l==null?void 0:l.error)),i=y(e,c=>c.matches("registration.securityKey")),s=y(e,c=>c.matches("registration.incomplete.needsEmailVerification")),o=y(e,c=>c.matches({authentication:"signedIn",registration:"complete"})),h=(c,l=t)=>ri(e,c,l),d=y(e,c=>c.context.user,(c,l)=>(c==null?void 0:c.id)===(l==null?void 0:l.id)),a=y(e,c=>c.context.accessToken.value),u=y(e,c=>c.context.refreshToken.value);return{accessToken:a,refreshToken:u,error:r,isError:n,isLoading:i,isSuccess:o,needsEmailVerification:s,signUpEmailSecurityKey:h,user:d}},Tc=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.avatarUrl},(e,n)=>e===n)},Sc=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.defaultRole},(e,n)=>e===n)},wc=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.displayName},(e,n)=>e===n)},xc=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.email},(e,n)=>e===n)},Oc=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.id},(e,n)=>e===n)},kc=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.isAnonymous},(e,n)=>e===n)},Ac=()=>{const t=J();return y(t,e=>{var n;return(n=e.context.user)==null?void 0:n.locale},(e,n)=>e===n)},Ic=()=>{const t=J();return y(t,e=>{var n;return e.matches("authentication.signedIn")?((n=e.context.user)==null?void 0:n.roles)||[]:[]})};function bc(t){const e=J(),n=(a,u=t)=>ii(e,a,u),r=async(a,u)=>si(e,a,u),i=y(e,a=>a.context.errors.registration||null,(a,u)=>(a==null?void 0:a.error)===(u==null?void 0:u.error)),s=y(e,a=>a.matches("registration.signInEmailOTP")||a.matches("registration.verifyEmailOTP")),o=y(e,a=>a.matches("authentication.signedIn")),h=y(e,a=>a.matches("registration.incomplete.needsOtp")),d=y(e,a=>a.matches("registration.incomplete.failed"));return{signInEmailOTP:n,verifyEmailOTP:r,isLoading:s,isSuccess:o,isError:d,error:i,needsOtp:h}}const _c=()=>{const t=J(),e=(a,u,c)=>oi(t,{provider:a,idToken:u,nonce:c}),n=y(t,a=>a.context.user,(a,u)=>(a==null?void 0:a.id)===(u==null?void 0:u.id)),r=y(t,a=>a.context.accessToken.value),i=y(t,a=>a.context.refreshToken.value),s=y(t,a=>a.context.errors.authentication||null,(a,u)=>(a==null?void 0:a.error)===(u==null?void 0:u.error)),o=y(t,a=>a.matches({authentication:"signedIn"})),h=y(t,a=>a.matches({authentication:{authenticating:"idToken"}}),(a,u)=>a===u),d=y(t,a=>a.matches({authentication:{signedOut:"failed"}}),(a,u)=>a===u);return{accessToken:r,refreshToken:i,error:s,isError:d,isLoading:h,isSuccess:o,signInIdToken:e,user:n}},Nc=()=>{const t=ye(),[e,n]=P.useState(null),r=!e,i=!!e,[s,o]=P.useState(!1);return{linkIdToken:async({provider:d,idToken:a,nonce:u})=>{o(!0);const c=await ai(t.auth.client,{provider:d,idToken:a,...u&&{nonce:u}}),{error:l}=c;return l&&n(l),o(!1),c},isLoading:s,isSuccess:r,isError:i,error:e}},Rc=()=>{const t=J(),e=()=>ci(t),n=y(t,u=>u.context.user,(u,c)=>(u==null?void 0:u.id)===(c==null?void 0:c.id)),r=y(t,u=>u.context.accessToken.value),i=y(t,u=>u.context.refreshToken.value),s=y(t,u=>u.context.errors.authentication||null,(u,c)=>(u==null?void 0:u.error)===(c==null?void 0:c.error)),o=y(t,u=>u.matches({authentication:"signedIn"})),h=y(t,u=>u.matches({authentication:{authenticating:"securityKeyEmail"}}),(u,c)=>u===c),d=y(t,u=>u.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(u,c)=>u===c),a=y(t,u=>u.matches({authentication:{signedOut:"failed"}}),(u,c)=>u===c);return{accessToken:r,refreshToken:i,error:s,isError:a,isLoading:h,isSuccess:o,needsEmailVerification:d,signInSecurityKey:e,user:n}};I.NHOST_REFRESH_TOKEN_KEY=Ke,I.NhostClient=Ua,I.NhostProvider=ji,I.NhostReactContext=dt,I.NhostReactProvider=Wa,I.SignedIn=Qa,I.SignedOut=Xa,I.VanillaNhostClient=_i,I.useAccessToken=Yn,I.useAddSecurityKey=Za,I.useAuthInterpreter=J,I.useAuthenticated=ec,I.useAuthenticationStatus=Kn,I.useChangeEmail=tc,I.useChangePassword=nc,I.useConfigMfa=rc,I.useDecodedAccessToken=Fi,I.useElevateSecurityKeyEmail=pc,I.useFileUpload=ic,I.useFileUploadItem=Vi,I.useHasuraClaim=sc,I.useHasuraClaims=$n,I.useLinkIdToken=Nc,I.useMultipleFilesUpload=oc,I.useNhostClient=ye,I.useProviderLink=ac,I.useResetPassword=cc,I.useSendVerificationEmail=uc,I.useSignInAnonymous=lc,I.useSignInEmailOTP=bc,I.useSignInEmailPassword=dc,I.useSignInEmailPasswordless=hc,I.useSignInEmailSecurityKey=fc,I.useSignInIdToken=_c,I.useSignInPAT=vc,I.useSignInSecurityKey=Rc,I.useSignInSmsPasswordless=mc,I.useSignOut=yc,I.useSignUpEmailPassword=gc,I.useSignUpEmailSecurityKeyEmail=Ec,I.useUserAvatarUrl=Tc,I.useUserData=Bi,I.useUserDefaultRole=Sc,I.useUserDisplayName=wc,I.useUserEmail=xc,I.useUserId=Oc,I.useUserIsAnonymous=kc,I.useUserLocale=Ac,I.useUserRoles=Ic,Object.defineProperty(I,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=react.umd.js.map
